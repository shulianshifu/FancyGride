Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig:function(a,b){var c=this;return a._plugins=a._plugins||[],a=c.copyColumns(a,b),a=c.prepareConfigScroll(a,b),a=c.prepareConfigData(a,b),a=c.prepareConfigTheme(a,b),a=c.prepareConfigLang(a,b),a=c.prepareConfigSpark(a,b),a=c.prepareConfigPaging(a,b),a=c.prepareConfigTBar(a),a=c.prepareConfigExpander(a),a=c.prepareConfigColumnMinMaxWidth(a),a=c.prepareConfigGrouping(a),a=c.prepareConfigGroupHeader(a),a=c.prepareConfigSorting(a),a=c.prepareConfigEdit(a),a=c.prepareConfigSelection(a),a=c.prepareConfigLoadMask(a,b),a=c.prepareConfigDefaults(a),a=c.prepareConfigFilter(a),a=c.prepareConfigSearch(a),a=c.prepareConfigSummary(a),a=c.prepareConfigExporter(a),a=c.prepareConfigSmartIndex(a),a=c.prepareConfigActionColumn(a),a=c.prepareConfigWidgetColumn(a),a=c.prepareConfigChart(a,b),a=c.prepareConfigCellTip(a),a=c.prepareConfigColumnsWidth(a),a=c.prepareConfigSize(a,b),a=c.prepareConfigColumns(a),a=c.prepareConfigColumnsResizer(a),a=c.prepareConfigFooter(a),a=c.prepareConfigDD(a)},copyColumns:function(a,b){return a.columns&&(a.columns=Fancy.Array.copy(a.columns,!0)),b.columns&&(b.columns=Fancy.Array.copy(b.columns)),a},prepareConfigScroll:function(a,b){return Fancy.isIE&&!1!==b.nativeScroller&&(a.nativeScroller=!0),a},prepareConfigSpark:function(a,b){var c=this;return Fancy.each(a.columns,function(b){var d=b.sparkConfig;if(d&&d.legend)switch(d.legend.type){case"tbar":case"bbar":case"buttons":var e=d.legend.type,f=b.index;a[e]=a[e]||[],a[e]=a[e].concat(c._generateLegendBar(d.title,f,d.legend.style,b))}}),a},_generateLegendBar:function(a,b,c,d){for(var e=0,f=a.length,g=[],h=this,i={length:0},j=function(b){var c,d=h;Fancy.each(h.columns,function(a,b){a.index===h.columns[b].index&&(c=b)}),(b.hasCls("fancy-legend-item-disabled")||a.length-1!==i.length)&&(b.toggleCls("fancy-legend-item-disabled"),b.hasCls("fancy-legend-item-disabled")?(i[b.index]=!0,d.disableLegend(c,b.index),i.length++):(d.enableLegend(c,b.index),delete i[b.index],i.length--))};e<f;e++){var k=b[e];Fancy.isString(d.index)&&(k=d.index+"."+e);var l={handler:j,index:k,imageColor:Fancy.COLORS[e],text:a[e]};0===e&&c&&(l.style=c),g.push(l)}return g},prepareConfigData:function(a,b){if(Fancy.isArray(a.data)&&0===a.data.length&&a.columns){var c=[];Fancy.each(a.columns,function(a){a.index&&c.push(a.index||a.key)}),a.data={fields:c,items:[]}}return a},prepareConfigLoadMask:function(a){return a._plugins.push({type:"grid.loadmask"}),a},reConfigStore:function(a){var b=this,c=b.store,d=b.getFieldsFromData(a),e="Fancy.model."+Fancy.id();Fancy.define(e,{extend:Fancy.Model,fields:d}),b.model=e,c.model=e,b.fields=d,c.fields=d,c.setModel()},prepareConfigDefaults:function(a){return a.defaults=a.defaults||{},void 0===a.defaults.type&&(a.defaults.type="string"),Fancy.each(a.defaults,function(b,c){Fancy.each(a.columns,function(b){switch(b.type){case"select":case"order":case"expand":return}void 0===b[c]&&(b[c]=a.defaults[c])})}),a},prepareConfigColumnMinMaxWidth:function(a){return Fancy.each(a.columns,function(a){void 0===a.width&&a.minWidth&&(a.width=a.minWidth)}),a},prepareConfigCellTip:function(a){return Fancy.each(a.columns,function(b){if(b.cellTip)return a._plugins.push({type:"grid.celltip"}),!0}),a},prepareConfigDD:function(a){if(a.gridToGrid){var b={type:"grid.dragdrop"};Fancy.apply(b,a.gridToGrid),a._plugins.push(b)}return a},prepareConfigColumns:function(a){for(var b=a.columns,c=[],d=[],e=0,f=b.length;e<f;e++){var g=b[e];switch(g.type){case"select":this.checkboxRowSelection=!0,this.multiSelect=!0,b[e].index="$selected",b[e].editable=!0;break;case"order":b[e].editable=!1,b[e].sortable=!1,b[e].cellAlign="right";break;case"checkbox":void 0===g.cellAlign&&(g.cellAlign="center");break;case"currency":void 0===g.format&&(g.format="number")}g.locked?(c.push(g),b.splice(e,1),e--,f--):g.rightLocked&&(d.push(g),b.splice(e,1),e--,f--)}return a.leftColumns=c,a.rightColumns=d,a},prepareConfigColumnsWidth:function(a){var b,c=a.columns,d=a.width,e=[],f=[],g=100,h=50,i=g,j=0,k=!1,l=!1;void 0===d&&a.renderTo&&(d=Fancy.get(a.renderTo).width()),!1!==a.flexScrollSensitive?(d-=a.bottomScrollHeight,d-=2*a.panelBorderWidth):d-=1,Fancy.each(c,function(b,c){switch(b.flex&&(a.hasFlexColumns=!0),b.type){case"select":void 0===b.width&&(b.width=35);break;case"order":void 0===b.width&&(b.width=40);break;case"expand":void 0===b.width&&(b.width=38)}b.locked&&(k=!0),b.rightLocked&&(l=!0),void 0===b.width?(b.flex&&(j+=b.flex,f.push(c)),e.push(c)):Fancy.isNumber(b.width)&&(d-=b.width)}),a.hasFlexColumns&&a._plugins.push({type:"grid.columnresizer"}),k&&l&&(d-=2);var m=d/e.length;m<h&&(m=h),m>g&&(i=g),m<h&&(i=h);var n=!1,o=d;return Fancy.each(e,function(a){b=c[a],void 0===b.flex&&(o-=i)}),j&&Fancy.each(f,function(a){o-=o/j*a.flex}),o<0&&(n=!0),Fancy.each(e,function(a){b=c[a],void 0===b.flex&&(b.width=i,d-=i)}),j&&Fancy.each(f,function(a){b=c[a],b.width=n?i*b.flex:d/j*b.flex}),a},prepareConfigActionRender:function(a){return function(b){return Fancy.each(a.items,function(a){var c=a.text||"",d=Fancy.styleToString(a.style),e=a.cls||"";b.value+=['<div class="fancy-grid-column-action-item '+e+'" style="'+d+'">',c,"</div>"].join(" ")}),b}},prepareConfigSmartIndex:function(a){return Fancy.each(a.columns,function(a){if(/\+|\-|\/|\*|\[|\./.test(a.index)){var b=a.index;switch(b){case"xAxis.categories":case"yAxis.categories":case"zAxis.categories":return}b=b.replace(/(\w+)/g,function(a,a,b,c){return"."===c[b-1]?a:isNaN(Number(a))?"data."+a:a}),b="return "+b+";",a.smartIndexFn=new Function("data",b)}}),a},prepareConfigActionColumn:function(a){for(var b=this,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];if("action"===f.type){f.sortable=!1,f.editable=!1,f.render=b.prepareConfigActionRender(f);var g=f.items;if(void 0!==g&&0!==g.length)for(var h,i=0,j=g.length;i<j;i++)switch(h=g[i],h.action){case"remove":void 0===h.handler&&(h.handler=function(a,b){a.remove(b)});break;case"dialog":!function(a){if(void 0===a.handler){for(var d=[],e=0,f=c.length,g=87;e<f;e++){var h=c[e];switch(h.type){case"action":continue}d.push({label:h.title||"",type:h.type,name:h.index}),g+=38}a.handler=function(c,e){a.dialog?(a.dialog.show(),a.dialog.set(e.data)):a.dialog=new FancyForm({window:!0,draggable:!0,modal:!0,title:{text:"Edit",tools:[{text:"Close",handler:function(){this.hide()}}]},width:300,height:g,items:d,buttons:["side",{text:"Clear",handler:function(){this.clear()}},{text:"Save",handler:function(){var a=this.get();a.id&&(b.getById(a.id).set(a),b.update())}}],events:[{init:function(){this.show(),this.set(e.data)}}]})}}}(h)}}}return a},prepareConfigWidgetColumn:function(a){for(var b=a.columns,c=0,d=b.length;c<d;c++){var e=b[c];e.widget&&(e.render=function(a){var b,c=a.cell.select("."+Fancy.FIELD_CLS),d=a.cell.dom,e=a.column,f={vtype:e.vtype,style:{padding:"0px","margin-top":"-10px","margin-left":"-1px"},label:!1,renderTo:d,value:a.value,emptyText:e.emptyText};if(c.length)b=Fancy.getWidget(c.dom.id),b.get()!=a.value&&b.set(a.value);else{var g=a.column.width,e=a.column,h=e.index;switch(a.column.type){case"number":case"currency":Fancy.apply(f,{spin:e.spin,min:e.min,max:e.max,events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.NumberField(f);break;case"string":case"image":Fancy.apply(f,{events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.StringField(f);break;case"combo":Fancy.apply(f,{displayKey:a.column.displayKey,valueKey:a.column.displayKey,padding:!1,checkValidOnTyping:!0,data:a.column.data,events:[{change:function(b,c){grid.set(a.rowIndex,h,c),grid.updater.updateRow()}}]}),b=new Fancy.Combo(f)}switch(a.column.type){case"number":case"string":case"currency":case"image":b.setInputSize({width:g+1,height:33});break;case"combo":b.size({width:g+1,height:33})}}return a})}return a},prepareConfigSorting:function(a){return(a.defaults||{}).sortable?(a._plugins.push({type:"grid.sorter"}),a):(Fancy.each(a.columns,function(b){b.sortable&&a._plugins.push({type:"grid.sorter"})}),a)},prepareConfigSelection:function(a){var b=!1,c={type:"grid.selection"};if((a.trackOver||a.columnTrackOver||a.cellTrackOver)&&(b=!0),a.selModel){b=!0;var d=!1,e=!1;if(Fancy.isObject(a.selModel)){if(d=!!a.selModel.checkOnly,!a.selModel.type)throw new Error("FancyGrid Error 5: Type for selection is not set");e=!0===a.selModel.memory,a.selModel=a.selModel.type}"rows"===a.selModel&&(a.multiSelect=!0),a.selection=a.selection||{},a.selection.selModel=a.selModel,a.selection[a.selModel]=!0,a.selection.checkOnly=d,a.selection.memory=e}return a.selection&&(b=!0,Fancy.isObject(a.selection)&&Fancy.apply(c,a.selection)),!0===b&&a._plugins.push(c),a},prepareConfigEdit:function(a){var b=a.defaults||{},c={type:"grid.edit"},d=!1,e=b.editable;return a.clicksToEdit&&(c.clicksToEdit=a.clicksToEdit),e&&(d||a._plugins.push(c),a._plugins.push({type:"grid.celledit"}),d=!0),a.rowEdit&&a._plugins.push({type:"grid.rowedit"}),Fancy.each(a.columns,function(b){switch(void 0===b.index&&void 0===b.key&&(b.editable=!1),b.type){case"image":b.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":b.editable=!1,b.sortable=!1}b.editable&&!1===d&&(a._plugins.push(c),a._plugins.push({type:"grid.celledit"}))}),a},prepareConfigExpander:function(a){if(a.expander){var b=a.expander;Fancy.apply(b,{type:"grid.expander"}),a.expanded={},a.grouping&&(b.expanded=!1),a._plugins.push(b)}return a},prepareConfigGrouping:function(a){if(a.grouping){var b=a.grouping;Fancy.apply(b,{type:"grid.grouping"}),a.expanded={},a._plugins.push(b)}return a},prepareConfigSummary:function(a){if(a.summary){var b=a.summary;!0===b&&(b={}),Fancy.apply(b,{type:"grid.summary"}),a._plugins.push(b)}return a},prepareConfigExporter:function(a){if(a.exporter){var b=a.exporter;!0===b&&(b={}),Fancy.apply(b,{type:"grid.exporter"}),a._plugins.push(b)}return a},prepareConfigFilter:function(a){var b=a.columns,c=!1,d=!1,e=!1,f={type:"grid.filter"};return a.filter&&(!0===a.filter&&(c=!0,a.filter={}),Fancy.apply(f,a.filter)),Fancy.each(b,function(a){a.filter&&(c=!0,a.filter.header&&(d=!0,a.grouping&&(e=!0)))}),f.header=d,f.groupHeader=e,c&&a._plugins.push(f),a},prepareConfigSearch:function(a){var b={type:"grid.search"},c=!1;return a.searching&&(c=!0),c&&a._plugins.push(b),a},prepareConfigGroupHeader:function(a){var b=a.columns,c=0,d=b.length,e=[],f=!1,g=[];if(Fancy.each(b,function(a){a.columns&&(f=!0,e.push(a))}),f){for(c=0;c<d;c++){var h=b[c];if(h.columns){for(var i=0,j=h.columns.length,k=h.text||h.title||"  ";i<j;i++)h.locked&&(h.columns[i].locked=!0),h.rightLocked&&(h.columns[i].rightLocked=!0),h.columns[i].grouping=k,h.defaults&&Fancy.applyIf(h.columns[i],h.defaults);g=g.concat(h.columns),f=!0,e.push(h)}else g=g.concat(b.slice(c,c+1))}a.columns=g,a._plugins.push({type:"grid.groupheader",groups:e}),a.isGroupedHeader=!0}return a},prepareConfigPaging:function(a,b){var c=this,d=a.lang,e=a.paging,f="bbar";if(!e)return a;if(void 0!==e.barType)switch(e.barType){case"bbar":case"tbar":case"both":f=e.barType;break;case!1:case"none":f="none";break;default:throw new Error("[FancyGrid Error]: - not supported bar type for paging")}return a._plugins.push({i18n:b.i18n,type:"grid.paging",barType:f}),"both"===f?(a.tbar=c.generatePagingBar(e,d),a.bbar=c.generatePagingBar(e,d)):"none"===f||(a[f]=c.generatePagingBar(e,d)),a},generatePagingBar:function(a,b){var c=this,d=[],e="fancy-bar-button-disabled",f={float:"left","margin-right":"5px","margin-top":"3px"};if(d.push({imageCls:"fancy-paging-first",disabledCls:e,role:"first",handler:function(a){c.paging.firstPage()},style:{float:"left","margin-left":"5px","margin-right":"5px","margin-top":"3px"}}),d.push({imageCls:"fancy-paging-prev",disabledCls:e,role:"prev",handler:function(){c.paging.prevPage()},style:f}),d.push("|"),d.push({type:"text",text:b.paging.page}),d.push({type:"number",label:!1,padding:!1,style:{float:"left","margin-left":"-1px","margin-right":"8px","margin-top":"4px"},role:"pagenumber",min:1,width:30,listeners:[{enter:function(a){0===parseInt(a.getValue())&&a.set(1);var b=parseInt(a.getValue())-1,d=c.paging.setPage(b);b!==d&&a.set(d)}},{up:function(a,b){var d=c.store.pages;Number(b)>d&&a.set(d)}}]}),d.push({type:"text",text:"",role:"ofText"}),d.push("|"),d.push({imageCls:"fancy-paging-next",disabledCls:e,role:"next",style:f,handler:function(){c.paging.nextPage()}}),d.push({imageCls:"fancy-paging-last",disabledCls:e,role:"last",style:f,handler:function(){c.paging.lastPage()}}),Fancy.isObject(a)&&!0===a.refreshButton&&(d.push("|"),d.push({imageCls:"fancy-paging-refresh",disabledCls:e,role:"refresh",style:f,handler:function(){c.paging.refresh()}})),a&&Fancy.isArray(a.pageSizeData)){for(var g=a.pageSizeData,h=[],i=0,j=g.length,k=0;i<j;i++)h.push({index:i,value:g[i]}),a.pageSize===g[i]&&(k=i);var l=Fancy.Object.copy(f);l["margin-top"]="4px",d.push({editable:!1,width:50,type:"combo",role:"size",style:l,data:h,displayKey:"value",valueKey:"index",value:k,events:[{change:function(a,b){c.paging.setPageSize(g[b])}}]})}return d.push("side"),d.push({type:"text",role:"info",text:""}),d},prepareConfigColumnsResizer:function(a){if((a.defaults||{}).resizable)return a._plugins.push({type:"grid.columnresizer"}),a;var b=[].concat(a.columns).concat(a.leftColumns).concat(a.rightColumns);return Fancy.each(b,function(b){b.resizable&&a._plugins.push({type:"grid.columnresizer"})}),a},prepareConfigTBar:function(a){var b=this,c=a.tbar;if(c)for(var d=0,e=c.length;d<e;d++)switch("search"===c[d].type&&(a.searching=!0,a.filter=!0),c[d].action){case"add":void 0===c[d].handler&&(c[d].handler=function(){b.insert(0,{})});break;case"remove":void 0===c[d].handler&&(c[d].disabled=!0,c[d].handler=function(){Fancy.each(b.getSelection(),function(a){b.remove(a)}),b.selection.clearSelection()},c[d].events=[{render:function(){var a=this;setTimeout(function(){var b=Fancy.getWidget(a.el.parent().parent().parent().select("."+Fancy.GRID_CLS).dom.id);b.on("select",function(){0===b.getSelection().length?a.disable():a.enable()}),b.on("clearselect",function(){a.disable()})},10)}}])}return a},prepareConfigChart:function(a){var b=a.data,c=b.chart;return Fancy.isObject(c)&&(c=[c]),b&&b.chart&&(a._plugins.push({type:"grid.chartintegration",chart:c,toChart:!!b.items||!!b.proxy}),Fancy.each(c,function(b){var c=b.type;switch(c){case"highchart":case"highcharts":a._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+c+" does not exist")}})),a},prepareConfigSize:function(a,b){var c,d=a.renderTo,e=!!(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel),f=a.panelBodyBorders,g=a.gridBorders;if(void 0===a.width)d&&(a.responsive=!0,c=Fancy.get(d),a.width=parseInt(c.width()));else if("fit"===a.width){var h=0,i=!1;Fancy.each(a.columns,function(a){h+=a.width,a.locked&&(i=!0)}),a.title||a.subTitle?h+=f[1]+f[3]+g[1]+g[3]:h+=g[1]+g[3],i&&h--,a.width=h}if("fit"===a.height){var j=0;Fancy.isArray(a.data)?j=a.data.length:a.data&&Fancy.isArray(a.data.items)&&(j=a.data.items.length),height=j*a.cellHeight,a.title&&(height+=a.titleHeight),(a.tbar||a.tabs)&&(height+=a.barHeight),a.bbar&&(height+=a.barHeight),a.buttons&&(height+=a.barHeight),a.subTBar&&(height+=a.barHeight),a.footer&&(height+=a.barHeight),!1!==a.header&&(height+=a.cellHeaderHeight),height+=e?f[0]+f[2]+g[0]+g[2]:g[0]+g[2],a.minHeight&&height<a.minHeight&&(height=a.minHeight),a.heightFit=!0,a.height=height}return a}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler:function(){var a=this;a.on("cellclick",a.onCellClickColumnAction,a)},onCellClickColumnAction:function(a,b){var c,d,e=this,f=b.column,g=f.items;"action"===f.type&&(c=e.getActiveActionColumnItem(b),g&&void 0!==c&&(d=g[c],d.handler&&d.handler(e,b)))},getActiveActionColumnItem:function(a){for(var b=Fancy.get(a.cell),c=a.e.target,d=b.select(".fancy-grid-column-action-item"),e=0,f=d.length;e<f;e++)if(d.item(e).within(c))return e}}),Fancy.Mixin("Fancy.grid.mixin.Grid",{tpl:['<div class="{leftCls} {leftEmptyCls}"></div>','<div class="{centerCls}"></div>','<div class="{rightCls} {rightEmptyCls}"></div>','<div class="fancy-grid-editors"></div>'],initStore:function(){var a,b,c=this,d=c.getFieldsFromData(c.data),e="Fancy.model."+Fancy.id(),f=c.data,g=!1,h=c.state;c.data.items&&(f=c.data.items),a=c.data.remoteSort,b=c.data.remoteFilter,Fancy.define(e,{extend:Fancy.Model,fields:d}),c.grouping&&void 0!==c.grouping.collapsed&&(g=c.grouping.collapsed);var i={widget:c,model:e,data:f,paging:c.paging,remoteSort:a,remoteFilter:b,collapsed:g,multiSort:c.multiSort};h&&h.filters&&(i.filters=h.filters),f.pageSize&&(i.pageSize=f.pageSize),c.store=new Fancy.Store(i),c.model=e,c.fields=d,c.store.filters&&setTimeout(function(){c.filter.filters=c.store.filters,c.filter.updateStoreFilters()},1)},initTouch:function(){var a=this,b=Fancy.TOUCH_CLS;Fancy.isTouch&&window.FastClick&&(a.panel?(FastClick.attach(a.panel.el.dom),a.panel.addCls(b)):(FastClick.attach(a.el.dom),a.addCls(b)))},initElements:function(){var a=this;!1!==a.header&&(a.leftHeader=new Fancy.grid.Header({widget:a,side:"left"}),a.header=new Fancy.grid.Header({widget:a,side:"center"}),a.rightHeader=new Fancy.grid.Header({widget:a,side:"right"})),a.leftBody=new Fancy.grid.Body({widget:a,side:"left"}),a.body=new Fancy.grid.Body({widget:a,side:"center"}),a.rightBody=new Fancy.grid.Body({widget:a,side:"right"}),a.leftEl=a.el.select("."+a.leftCls),a.centerEl=a.el.select("."+a.centerCls),a.rightEl=a.el.select("."+a.rightCls)},getFieldsFromData:function(a){var b=a.items||a;if(a.fields)return a.fields;if(!b)throw new Error("FancyGrid Error 4: Data is empty and not set fields of data to build model");var c=b[0],d=[];for(var e in c)d.push(e);return d},render:function(){var a=this,b=a.renderTo||document.body,c=Fancy.get(document.createElement("div")),d=a.panelBodyBorders;c.addCls(Fancy.cls,a.widgetCls,a.cls),c.attr("id",a.id),void 0===a.panel&&a.shadow&&c.addCls("fancy-panel-shadow"),!1===a.columnLines&&c.addCls("fancy-grid-disable-column-lines"),"default"===a.theme||a.panel||c.addCls("fancy-theme-"+a.theme);var e=0;a.panel&&(e=d[1]+d[3]),c.css({width:a.width-e+"px",height:a.height-0+"px"}),a.initTpl(),c.update(a.tpl.getHTML({leftEmptyCls:a.leftEmptyCls,rightEmptyCls:a.rightEmptyCls,centerCls:a.centerCls,leftCls:a.leftCls,rightCls:a.rightCls})),a.el=Fancy.get(Fancy.get(b).dom.appendChild(c.dom)),a.setHardBordersWidth(),a.rendered=!0},setHardBordersWidth:function(){var a=this,b=a.panel?a.gridBorders:a.gridWithoutPanelBorders;a.wrapped&&(b=a.gridBorders),a.css({"border-top-width":b[0],"border-right-width":b[1],"border-bottom-width":b[2],"border-left-width":b[3]})},update:function(){var a=this;a.store.loading||(a.updater.update(),a.fire("update"),a.heightFit&&a.fitHeight(),a.setBodysHeight())},getColumnsWidth:function(a){var b=this;switch(a){case"center":return b.getCenterFullWidth();case"left":return b.getLeftFullWidth();case"right":return b.getRightFullWidth()}},setSides:function(){var a=this,b=a.centerCls,c=a.leftCls,d=a.rightCls,e=a.headerCls,f=a.leftColumns,g=a.rightColumns,h=a.getLeftFullWidth(),i=a.getCenterFullWidth(),j=a.getRightFullWidth(),k=a.gridBorders,l=a.panelBodyBorders,m=a.gridWithoutPanelBorders;f.length>0&&a.leftEl.removeCls(a.leftEmptyCls),g.length>0&&a.rightEl.removeCls(a.rightEmptyCls),i=a.wrapped?a.width-k[1]-k[3]:a.panel?a.width-k[1]-k[3]-l[1]-l[3]:a.width-m[1]-m[3],0===h&&0===j||(0===j?i-=h:0===h?i-=j:a.width>h+i+j?i-=h:i-=h+j),a.leftEl.css({width:h+"px"}),a.centerEl.css({left:h+"px",width:i+"px"}),a.header&&(a.el.select("."+c+" ."+e).css({width:h+"px"}),a.el.select("."+b+" ."+e).css({width:i+"px"})),a.el.select("."+b+" .fancy-grid-body").css({width:i+"px"}),a.width>h+i+j?a.rightEl.css({right:"0px"}):a.rightEl.css({left:"",right:"0px"}),a.rightEl.css({width:j}),a.header&&a.el.select("."+d+" ."+e).css({width:j+"px"}),a.startWidths={center:i,left:h,right:j}},setColumnsPosition:function(){var a=this;a.body.setColumnsPosition(),a.leftBody.setColumnsPosition(),a.rightBody.setColumnsPosition()},setSidesHeight:function(){var a=this,b=a.store,c=1,d=a.cellHeaderHeight;!1!==a.header&&(c+=d,a.filter&&a.filter.header&&(a.groupheader?a.filter.groupHeader&&(c+=d):c+=d),a.groupheader&&(a.filter&&a.filter.header,c+=d)),a.grouping&&(c+=a.grouping.groups.length*a.groupRowHeight),a.expander&&(c+=a.expander.plusHeight),a.summary&&(c+=a.summary.topOffSet),c+=b.getLength()*a.cellHeight-1,a.paging&&a.summary&&"bottom"===a.summary.position&&(c=a.height),a.leftEl.css({height:c+"px"}),a.centerEl.css({height:c+"px"}),a.rightEl.css({height:c+"px"})},setBodysHeight:function(){var a=this;a.body.setHeight(),a.leftBody.setHeight(),a.rightBody.setHeight()},preRender:function(){var a=this;(a.title||a.subTitle||a.tbar||a.bbar||a.buttons||a.panel)&&a.renderPanel()},renderPanel:function(){var a=this,b={renderTo:a.renderTo,title:a.title,subTitle:a.subTitle,width:a.width,height:a.height,titleHeight:a.titleHeight,subTitleHeight:a.subTitleHeight,barHeight:a.barHeight,theme:a.theme,shadow:a.shadow,style:a.style||{},window:a.window,modal:a.modal,frame:a.frame,items:[a],draggable:a.draggable,resizable:a.resizable,minWidth:a.minWidth,minHeight:a.minHeight,panelBodyBorders:a.panelBodyBorders,barContainer:a.barContainer,barScrollEnabled:a.barScrollEnabled},c=a.panelBodyBorders;a.bbar&&(b.bbar=a.bbar,a.height-=a.barHeight),a.tbar&&(b.tbar=a.tbar,a.height-=a.barHeight),a.subTBar&&(b.subTBar=a.subTBar,a.height-=a.barHeight),a.buttons&&(b.buttons=a.buttons,a.height-=a.barHeight),a.footer&&(b.footer=a.footer,a.height-=a.barHeight),a.panel=new Fancy.Panel(b),a.bbar=a.panel.bbar,a.tbar=a.panel.tbar,a.subTBar=a.panel.subTBar,a.buttons=a.panel.buttons,a.wrapped||a.panel.addCls("fancy-panel-grid-inside"),a.title&&(a.height-=a.titleHeight),a.subTitle&&(a.height-=a.subTitleHeight,a.height+=c[2]),a.height-=c[0]+c[2],a.renderTo=a.panel.el.select(".fancy-panel-body-inner").dom},getBodyHeight:function(){var a=this,b=a.height,c=1,d=a.gridBorders,e=a.gridWithoutPanelBorders;return a.groupheader&&(c=2),a.filter&&a.filter.header&&(a.groupheader?a.filter.groupHeader&&c++:c++),!1!==a.header&&(b-=a.cellHeaderHeight*c),a.panel?b-=d[0]+d[2]:b-=e[0]+e[2],a.summary&&(b-=a.summary.topOffSet,b-=a.summary.bottomOffSet),b},ons:function(){var a=this,b=a.store,c=Fancy.get(document);b.on("change",a.onChangeStore,a),b.on("set",a.onSetStore,a),b.on("remove",a.onRemoveStore,a),b.on("beforesort",a.onBeforeSortStore,a),b.on("sort",a.onSortStore,a),b.on("beforeload",a.onBeforeLoadStore,a),b.on("load",a.onLoadStore,a),c.on("mouseup",a.onDocMouseUp,a),c.on("click",a.onDocClick,a),c.on("mousemove",a.onDocMove,a),b.on("servererror",a.onServerError,a),b.on("serversuccess",a.onServerSuccess,a),a.responsive&&Fancy.$(window).bind("resize",function(){a.onWindowResize()}),a.on("activate",a.onActivate,a),a.on("deactivate",a.onDeActivate,a)},onServerError:function(a,b,c,d){this.fire("servererror",b,c,d)},onServerSuccess:function(a,b,c){this.fire("serversuccess",b,c)},onChangeStore:function(){this.update()},onBeforeLoadStore:function(a){this.fire("beforeload")},onRemoveStore:function(a,b,c){this.fire("remove",b,c)},onLoadStore:function(a){this.fire("load")},onSetStore:function(a,b){this.fire("set",b)},onBeforeSortStore:function(a,b){this.fire("beforesort",b)},onSortStore:function(a,b){this.fire("sort",b)},getCellsViewHeight:function(){var a=this,b=a.store,c=0,d=0;return a.grouping&&(c+=a.grouping.plusScroll),a.expander&&(c+=a.expander.plusScroll),!a.scroller.scrollBottomEl||a.scroller.scrollBottomEl.hasCls(Fancy.HIDDEN_CLS)||(d=a.scroller.cornerSize),a.cellHeight*b.dataView.length+d+c},onDocMouseUp:function(a){this.fire("docmouseup")},onDocClick:function(a){this.fire("docclick",a)},onDocMove:function(a){this.fire("docmove",a)},getCenterViewWidth:function(){var a=this,b=a.centerEl.width();if(0===b){for(var c=0,d=a.columns,e=0,f=d.length;e<f;e++){var g=d[e];g.hidden||(c+=g.width)}return c}return b},getCenterFullWidth:function(){for(var a=this,b=0,c=a.columns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getLeftFullWidth:function(){for(var a=this,b=0,c=a.leftColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getRightFullWidth:function(){for(var a=this,b=0,c=a.rightColumns,d=0,e=c.length;d<e;d++){var f=c[d];f.hidden||(b+=f.width)}return b},getColumns:function(a){var b,c=this;switch(a){case"left":b=c.leftColumns;break;case"center":b=c.columns;break;case"right":b=c.rightColumns}return b},getBody:function(a){var b,c=this;switch(a){case"left":b=c.leftBody;break;case"center":b=c.body;break;case"right":b=c.rightBody}return b},getHeader:function(a){var b,c=this;switch(a){case"left":b=c.leftHeader;break;case"center":b=c.header;break;case"right":b=c.rightHeader}return b},getDomRow:function(a){for(var b=this,c=b.leftBody,d=b.body,e=b.rightBody,f=b.leftColumns,g=b.columns,h=b.rightColumns,i=0,j=f.length,k=[];i<j;i++)k.push(c.getDomCell(a,i));for(i=0,j=g.length;i<j;i++)k.push(d.getDomCell(a,i));for(i=0,j=h.length;i<j;i++)k.push(e.getDomCell(a,i));return k},initTextSelection:function(){var a=this,b=a.body,c=a.leftBody,d=a.rightBody;if(!1===a.textSelection){a.addCls("fancy-grid-unselectable");var e=function(a){var b=Fancy.get(a.target);b.hasCls("fancy-field-text-input")||b.hasCls("fancy-textarea-text-input")||a.preventDefault()};b.el.on("mousedown",e),c.el.on("mousedown",e),d.el.on("mousedown",e)}},setTrackOver:function(a,b){var c=this;switch(a){case"cell":c.cellTrackOver=b;break;case"column":c.columnTrackOver=b;break;case"row":c.trackOver=b}},setSelModel:function(a){var b=this,c=b.selection;c.cell=!1,c.cells=!1,c.row=!1,c.rows=!1,c.column=!1,c.columns=!1,c[a]=!0,b.multiSelect="rows"===a,c.clearSelection()},getSelection:function(a){return this.selection.getSelection(a)},clearSelection:function(){this.selection.clearSelection()},destroy:function(){var a=this,b=Fancy.get(document);b.un("mouseup",a.onDocMouseUp,a),b.un("click",a.onDocClick,a),b.un("mousemove",a.onDocMove,a),a.body.destroy(),a.leftBody.destroy(),a.rightBody.destroy(),a.header.destroy(),a.leftHeader.destroy(),a.rightHeader.destroy(),a.scroller.destroy(),a.el.destroy(),a.panel&&a.panel.el.destroy()},showAt:function(){var a=this;a.panel&&a.panel.showAt.apply(a.panel,arguments)},show:function(){var a=this;a.panel?a.panel.show.apply(a.panel,arguments):a.el.show()},hide:function(){var a=this;a.panel?a.panel.hide.apply(a.panel,arguments):a.el.hide()},initDateColumn:function(){var a=this,b=function(b){for(var c=0,d=b.length;c<d;c++){var e=b[c];if("date"===e.type){e.format=e.format||{};var f={type:"date"};Fancy.applyIf(f,a.lang.date),Fancy.applyIf(e.format,f)}}return b};a.columns=b(a.columns),a.leftColumns=b(a.leftColumns),a.rightColumns=b(a.rightColumns)},stopEditor:function(){this.edit.stopEditor()},getById:function(a){return this.store.getById(a)},get:function(a,b){var c=this,d=c.store;return void 0!==b?d.get(a,b):void 0===a?d.get():d.getItem(a)},getTotal:function(){return this.store.getTotal()},getViewTotal:function(){return this.store.getLength()},getDataView:function(){return this.store.getDataView()},getData:function(){return this.store.getData()},selectRow:function(a){this.selection.selectRow(a)},selectColumn:function(a){var b,c,d=this,e=d.leftColumns||[],f=d.columns||[],g=d.rightColumns||[],h=function(b){for(var d=0,e=b.length;d<e;d++){var f=b[d];if(f.index===a||f.key===a)return c=d,!0}return!1};h(e)?b="left":h(f)?b="center":h(g)&&(b="right"),b&&d.selection.selectColumns(c,b)},getColumnByIndex:function(a){for(var b=this,c=b.leftColumns||[],d=b.columns||[],e=b.rightColumns||[],f=c.concat(d).concat(e),g=0,h=f.length;g<h;g++){var i=f[g];if(i.index===a||i.key===a)return i}},load:function(){this.store.loadData()},save:function(){this.store.save()},onWindowResize:function(){var a,b=this,c=b.renderTo;b.panel&&(c=b.panel.renderTo,a=Fancy.get(c),b.setWidth(parseInt(a.width()))),b.setBodysHeight()},setWidth:function(a){var b=this,c=b.el,d=b.gridBorders,e=b.gridWithoutPanelBorders,f=b.panelBodyBorders,g=b.body,h=b.header;b.scroller.scroll(0,0);var i,j=function(a){for(var b=0,c=a.length,d=0;b<c;b++){a[b].hidden||(d+=a[b].width)}return d},k=j(b.leftColumns),l=j(b.rightColumns),m=a-k-l-f[1]-f[3];b.wrapped?(i=a,m=a-k-l,m-=d[1]+d[3],b.css({width:i})):b.panel?(m=a-k-l-f[1]-f[3],b.panel.el.width(a),m-=d[1]+d[3],i=a-f[1]-f[3],b.css({width:i})):(m=a-k-l-e[1]-e[3],c.css("width",a)),m<100&&(m=100),c.select("."+b.centerCls).css("width",m),h.css("width",m),g.css("width",m),b.hasFlexColumns&&(b.reCalcColumnsWidth(),b.columnresizer.updateColumnsWidth()),b.scroller.setScrollBars()},getWidth:function(){var a=this;return a.panel?parseInt(a.panel.css("width")):parseInt(a.css("width"))},getHeight:function(){var a=this;return a.panel?parseInt(a.panel.css("height")):parseInt(a.css("height"))},setHeight:function(a,b){var c=this,d=c.gridBorders,e=c.panelBodyBorders;c.panel&&!1!==b&&c.panel.setHeight(a),c.title&&(a-=c.titleHeight),c.subTitle&&(a-=c.subTitleHeight),c.footer&&(a-=c.barHeight),c.bbar&&(a-=c.barHeight),c.tbar&&(a-=c.barHeight),c.subTBar&&(a-=c.barHeight),c.buttons&&(a-=c.barHeight);var f=a;c.header&&(f-=c.cellHeaderHeight,c.groupheader&&(f-=c.cellHeaderHeight)),c.panel&&(f-=e[0]+e[2]),f-=d[0]+d[2],c.body&&c.body.css("height",f),c.leftBody&&c.leftBody.css("height",f),c.rightBody&&c.rightBody.css("height",f),c.el.css("height",a),c.height=a,c.scroller.update()},find:function(a,b){return this.store.find(a,b)},findItem:function(a,b){return this.store.findItem(a,b)},each:function(a,b){this.store.each(a,b)},onActivate:function(){var a=this,b=Fancy.get(document);setTimeout(function(){b.on("click",a.onDeactivateClick,a)},100)},onDeActivate:function(){var a=this,b=Fancy.get(document);a.activated=!1,b.un("click",a.onDeactivateClick,a)},onDeactivateClick:function(a){for(var b=this,c=0,d=20,e=Fancy.get(a.target);c<d;c++){if(!e.dom)return;if(!e.dom.tagName||"body"===e.dom.tagName.toLocaleLowerCase())return void b.fire("deactivate");if(e.hasCls(b.widgetCls))return;e=e.parent()}},search:function(a,b){this.searching.search(a,b)},stopSelection:function(){var a=this;a.selection&&a.selection.stopSelection()},enableSelection:function(a){var b=this;b.selection&&b.selection.enableSelection(a)},hideColumn:function(a,b){for(var c,d,e=this,f=e.getBody(a),g=e.getHeader(a),h=e.getColumns(a),i=0,j=h.length,k=e.centerEl,l=e.leftEl,m=e.leftHeader,n=e.rightEl,o=e.rightHeader;i<j;i++)if(d=h[i],d.index===b){c=i,d.hidden=!0;break}switch(g.hideCell(c),f.hideColumn(c),e.rowedit&&e.rowedit.hideField(c,a),a){case"left":l.css("width",parseInt(l.css("width"))-d.width),m.css("width",parseInt(m.css("width"))-d.width),k.css("left",parseInt(k.css("left"))-d.width),k.css("width",parseInt(k.css("width"))+d.width),e.body.css("width",parseInt(e.body.css("width"))+d.width),e.header.css("width",parseInt(e.header.css("width"))+d.width);break;case"right":n.css("width",parseInt(n.css("width"))-d.width),o.css("width",parseInt(o.css("width"))-d.width),k.css("width",parseInt(k.css("width"))+d.width),e.body.css("width",parseInt(e.body.css("width"))+d.width),e.header.css("width",parseInt(e.header.css("width"))+d.width)}},showColumn:function(a,b){for(var c,d,e=this,f=e.getBody(a),g=e.getHeader(a),h=e.getColumns(a),i=0,j=h.length,k=e.centerEl,l=e.leftEl,m=e.leftHeader,n=e.rightEl,o=e.rightHeader;i<j;i++)if(d=h[i],d.index===b){c=i,d.hidden=!1;break}switch(g.showCell(c),f.showColumn(c),e.rowedit&&e.rowedit.showField(c,a),a){case"left":l.css("width",parseInt(l.css("width"))+d.width),m.css("width",parseInt(m.css("width"))+d.width),k.css("left",parseInt(k.css("left"))+d.width),k.css("width",parseInt(k.css("width"))-d.width),e.body.css("width",parseInt(e.body.css("width"))-d.width),e.header.css("width",parseInt(e.header.css("width"))-d.width);break;case"right":n.css("width",parseInt(n.css("width"))+d.width),o.css("width",parseInt(o.css("width"))+d.width),k.css("width",parseInt(k.css("width"))-d.width),e.body.css("width",parseInt(e.body.css("width"))-d.width),e.header.css("width",parseInt(e.header.css("width"))-d.width)}},removeColumn:function(a,b){var c,d=this,e=d.leftEl,f=d.leftHeader,g=d.leftBody,h=d.centerEl,i=d.body,j=d.header,k=d.rightEl,l=d.rightBody,m=d.rightHeader;switch(b){case"left":c=d.leftColumns[a],d.leftColumns.splice(a,1),f.removeCell(a),f.reSetIndexes(),g.removeColumn(a),e.css("width",parseInt(e.css("width"))-c.width),h.css("left",parseInt(h.css("left"))-c.width),h.css("width",parseInt(h.css("width"))+c.width),i.css("width",parseInt(i.css("width"))+c.width),j.css("width",parseInt(j.css("width"))+c.width);break;case"center":c=d.columns[a],d.columns.splice(a,1),j.removeCell(a),j.reSetIndexes(),i.removeColumn(a);break;case"right":c=d.rightColumns[a],d.rightColumns.splice(a,1),m.removeCell(a),m.reSetIndexes(),l.removeColumn(a),k.css("right",parseInt(k.css("right"))-c.width),h.css("width",parseInt(h.css("width"))+c.width),j.css("width",parseInt(j.css("width"))+c.width),i.css("width",parseInt(i.css("width"))+c.width)}return c.grouping&&delete c.grouping,d.summary&&d.summary.removeColumn(a,b),c},insertColumn:function(a,b,c,d){var e=this,f=e.leftEl,g=e.leftBody,h=e.leftHeader,i=e.centerEl,j=e.body,k=e.header,l=e.rightEl,m=e.rightBody,n=e.rightHeader;switch(c=c||"center"){case"center":e.columns.splice(b,0,a),k.insertCell(b,a),k.reSetIndexes(),j.insertColumn(b,a);break;case"left":e.leftColumns.splice(b,0,a),h.insertCell(b,a),h.reSetIndexes(),g.insertColumn(b,a),f.css("width",parseInt(f.css("width"))+a.width),i.css("width",parseInt(i.css("width"))-a.width),i.css("left",parseInt(i.css("left"))+a.width),j.el.css("width",parseInt(j.el.css("width"))-a.width),k.el.css("width",parseInt(k.el.css("width"))-a.width);break;case"right":e.rightColumns.splice(b,0,a),n.insertCell(b,a),n.reSetIndexes(),m.insertColumn(b,a),l.css("width",parseInt(l.css("width"))+a.width),i.css("width",parseInt(i.css("width"))-a.width),j.css("width",parseInt(j.css("width"))-a.width),k.css("width",parseInt(k.css("width"))-a.width)}a.menu&&(a.menu=!0),e.grouping&&(e.grouping.updateGroupRows(),e.grouping.setCellsPosition(b,c)),a.rowEditor&&("left"===c&&b--,e.rowedit.moveEditor(a,b,c,d)),e.summary&&e.summary.insertColumn(b,c),e.header.destroyMenus(),e.leftHeader.destroyMenus(),e.rightHeader.destroyMenus()},disableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},c.columns[a].disabled[b]=!0,c.body.updateRows(void 0,a)},enableLegend:function(a,b){var c=this;c.columns[a].disabled=c.columns[a].disabled||{},delete c.columns[a].disabled[b],c.body.updateRows(void 0,a)},fitHeight:function(){var a=this,b=a.store,c=a.panelBodyBorders,d=a.gridBorders,e=b.getLength()*a.cellHeight;a.title&&(e+=a.titleHeight),a.tbar&&(e+=a.barHeight),a.bbar&&(e+=a.barHeight),a.buttons&&(e+=a.barHeight),a.subTBar&&(e+=a.barHeight),a.footer&&(e+=a.barHeight),!1!==a.header&&(e+=a.cellHeaderHeight,a.filter&&a.filter.header&&(e+=a.cellHeaderHeight)),a.panel?e+=c[0]+c[2]+d[0]+d[2]:e+=d[0]+d[2],a.setHeight(e)},addFilter:function(a,b,c){var d=this,e=d.filter.filters[a],c=c||"";if(void 0===e&&(e={}),Fancy.isDate(b)){var f=this.getColumnByIndex(a).format;e.type="date",e.format=f,b=Number(b)}""===b?delete e[c]:e[c]=b,d.filter.filters[a]=e,d.filter.updateStoreFilters(),d.filter.addValuesInColumnFields(a,b,c)},clearFilter:function(a,b){var c=this,d=c.store;void 0===a?(c.filter.filters={},d.filters={}):void 0===b?(c.filter.filters[a]={},d.filters[a]={}):c.filter&&c.filter.filters&&c.filter.filters[a]&&c.filter.filters[a][b]&&(delete c.filter.filters[a][b],delete d.filters[a][b]),d.changeDataView(),c.update(),c.filter&&c.filter.clearColumnsFields(a,b)},showLoadMask:function(a){this.loadmask.showLoadMask(a)},hideLoadMask:function(){this.loadmask.hideLoadMask()},prevPage:function(){this.paging.prevPage()},nextPage:function(){this.paging.nextPage()},setPage:function(a){a--,a<0&&(a=0),this.paging.setPage(a)},firstPage:function(){this.paging.firstPage()},lastPage:function(){this.paging.lastPage()},setPageSize:function(a){this.paging.setPageSize(a)},getPage:function(){return this.store.showPage+1},getPages:function(){return this.store.pages},getPageSize:function(){return this.store.pageSize},refresh:function(){this.paging.refresh()},scroll:function(a,b){var c=this,d=c.scroller;d.scroll(a,b),d.scrollBottomKnob(),d.scrollRightKnob()},getDataFiltered:function(){return this.store.filteredData},reCalcColumnsWidth:function(){var a=this;if(a.hasFlexColumns){var b,c=a.scroller,d=a.getCenterViewWidth(),e=a.columns,f=0,g=0,h=e.length,i=d;for(!1!==a.flexScrollSensitive&&c.isRightScrollable()&&!c.nativeScroller&&(i-=a.bottomScrollHeight);g<h;g++){var j=e[g];j.flex?f+=j.flex:i-=j.width}if(0!==f)for(b=i/f,g=0;g<h;g++){var j=e[g];j.flex&&(j.width=Math.floor(j.flex*b),j.minWidth&&j.width<j.minWidth?j.width=j.minWidth:j.width<a.minColumnWidth&&(j.width=a.minColumnWidth))}}},getDisplayedData:function(){for(var a=this,b=a.getViewTotal(),c=[],d=0,e=a.leftColumns,f=a.columns,g=a.rightColumns;d<b;d++){var h=[];Fancy.each(e,function(b){void 0!==b.index&&h.push(a.get(d,b.index))}),Fancy.each(f,function(b){void 0!==b.index&&h.push(a.get(d,b.index))}),Fancy.each(g,function(b){void 0!==b.index&&h.push(a.get(d,b.index))}),c.push(h)}return c},exportToExcel:function(){var a=this;a.exporter&&a.exporter.exportToExcel()}}),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(a){var b=this;Fancy.applyConfig(b,a),b.Super("const",arguments)},init:function(){},update:function(){var a=this,b=a.widget;b.leftBody.update(),b.body.update(),b.rightBody.update()},updateRow:function(a){var b=this,c=b.widget;c.leftBody.updateRows(a),c.body.updateRows(a),c.rightBody.updateRows(a)}}),function(){var a="fancy-scroll-right-inner",b="fancy-scroll-bottom-inner",c="fancy-scroll-right-hover",d="fancy-scroll-bottom-hover",e="fancy-scroll-right-active",f="fancy-scroll-bottom-active",g=Fancy.HIDDEN_CLS;Fancy.define("Fancy.grid.plugin.Scroller",{extend:Fancy.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget,c=Fancy.getMouseWheelEventName();b.once("render",function(){a.render(),b.leftBody.el.on(c,a.onMouseWheel,a),b.nativeScroller&&(b.leftBody.el.on(c,a.onMouseWheelLeft,a),b.rightBody.el.on(c,a.onMouseWheelRight,a)),b.body.el.on(c,a.onMouseWheel,a),b.rightBody.el.on(c,a.onMouseWheel,a),b.once("init",a.onGridInit,a),b.nativeScroller&&b.body.el.on("scroll",a.onNativeScrollBody,a)}),a.on("render",a.onRender,a),b.store.on("change",a.onChangeStore,a)},destroy:function(){var a=this,b=a.widget,c=b.leftBody,d=b.body,e=b.rightBody,f=Fancy.get(document),g=Fancy.getMouseWheelEventName();f.un("mouseup",a.onMouseUpDoc,a),f.un("mousemove",a.onMouseMoveDoc,a),c.el.un(g,a.onMouseWheel,a),d.el.un(g,a.onMouseWheel,a),e.el.un(g,a.onMouseWheel,a),a.scrollBottomEl.un("mousedown",a.onMouseDownBottomSpin,a),a.scrollRightEl.un("mousedown",a.onMouseDownRightSpin,a),Fancy.isTouch&&(c.el.un("touchstart",a.onBodyTouchStart,a),c.el.un("touchmove",a.onBodyTouchMove,a),d.el.un("touchstart",a.onBodyTouchStart,a),d.el.un("touchmove",a.onBodyTouchMove,a),e.el.un("touchstart",a.onBodyTouchStart,a),e.el.un("touchmove",a.onBodyTouchMove,a),f.un("touchend",a.onMouseUpDoc,a))},onGridInit:function(){var a=this,b=a.widget,c=Fancy.get(document);a.setScrollBars(),c.on("mouseup",a.onMouseUpDoc,a),c.on("mousemove",a.onMouseMoveDoc,a),b.on("columnresize",a.onColumnResize,a),b.on("lockcolumn",a.onLockColumn,a),b.on("rightlockcolumn",a.onRightLockColumn,a),b.on("unlockcolumn",a.onUnLockColumn,a),setTimeout(function(){a.update()},1)},render:function(){var c=this,d=c.widget,e=d.body,f=Fancy.get(document.createElement("div")),h=Fancy.get(document.createElement("div"));d.nativeScroller?d.el.addCls("fancy-grid-native-scroller"):(f.addCls("fancy-scroll-right"),h.addCls("fancy-scroll-bottom",g),f.update(['<div class="'+a+'"></div>'].join(" ")),f.select("."+a).css("margin-top",d.knobOffSet),h.update(['<div class="'+b+'"></div>'].join(" ")),Fancy.get(e.el.append(f.dom)),c.scrollRightEl=e.el.select(".fancy-scroll-right"),Fancy.get(e.el.append(h.dom)),c.scrollBottomEl=e.el.select(".fancy-scroll-bottom")),c.fire("render")},onMouseWheel:function(a){var b=this,c=b.widget,d=Fancy.getWheelDelta(a.originalEvent||a);0!=b.isRightScrollable()&&(c.stopProp&&a.stopPropagation(),c.nativeScroller||(b.scrollDelta(d)&&a.preventDefault(),b.scrollRightKnob()))},onRender:function(){var a=this;!0!==a.widget.nativeScroller&&(a.scrollRightEl.hover(function(){!0!==a.bottomKnobDown&&a.scrollRightEl.addCls(c)},function(){a.scrollRightEl.removeCls(c)}),a.scrollBottomEl.hover(function(){!0!==a.rightKnobDown&&a.scrollBottomEl.addCls(d)},function(){a.scrollBottomEl.removeCls(d)}),a.initRightScroll(),a.initBottomScroll()),Fancy.isTouch&&a.initTouch()},initTouch:function(){var a=this,b=a.widget,c=b.leftBody,d=b.body,e=b.rightBody,f=Fancy.get(document);c.el.on("touchstart",a.onBodyTouchStart,a),c.el.on("touchmove",a.onBodyTouchMove,a),d.el.on("touchstart",a.onBodyTouchStart,a),d.el.on("touchmove",a.onBodyTouchMove,a),e.el.on("touchstart",a.onBodyTouchStart,a),e.el.on("touchmove",a.onBodyTouchMove,a),f.on("touchend",a.onMouseUpDoc,a)},onBodyTouchStart:function(a){var b=this,a=a.originalEvent||a,c=a.changedTouches[0];b.rightKnobDown=!0,b.bottomKnobDown=!0,b.mouseDownXY={x:c.pageX,y:c.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addCls(e),b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addCls(f)},onBodyTouchEnd:function(){this.onMouseUpDoc()},onBodyTouchMove:function(a){var b=this,a=a.originalEvent,c=a.changedTouches[0];!0===b.rightKnobDown&&a.preventDefault(),!0===b.bottomKnobDown&&a.preventDefault(),b.onMouseMoveDoc({pageX:c.pageX,pageY:c.pageY})},initRightScroll:function(){var b=this;b.rightKnob=b.scrollRightEl.select("."+a),b.scrollRightEl.on("mousedown",b.onMouseDownRightSpin,b)},initBottomScroll:function(){var a=this;a.bottomKnob=a.scrollBottomEl.select("."+b),a.scrollBottomEl.on("mousedown",a.onMouseDownBottomSpin,a)},onMouseDownRightSpin:function(a){var b=this;Fancy.isTouch||(a.preventDefault(),b.rightKnobDown=!0,b.mouseDownXY={x:a.pageX,y:a.pageY},b.rightKnobTop=parseInt(b.rightKnob.css("margin-top")),b.scrollRightEl.addCls(e))},onMouseDownBottomSpin:function(a){var b=this;a.preventDefault(),b.bottomKnobDown=!0,b.mouseDownXY={x:a.pageX,y:a.pageY},b.bottomKnobLeft=parseInt(b.bottomKnob.css("margin-left")),b.scrollBottomEl.addCls(f)},onMouseUpDoc:function(){var a=this;!1===a.rightKnobDown&&!1===a.bottomKnobDown||(a.scrollRightEl.removeCls(e),a.scrollBottomEl.removeCls(f),a.rightKnobDown=!1,a.bottomKnobDown=!1)},onMouseMoveDoc:function(a){var b,c,d,e,f=this,g=f.widget,h=!1,i=!1,j=g.knobOffSet,k=a.pageX,l=a.pageY;f.rightKnobDown&&(Fancy.isTouch?(c=f.mouseDownXY.y-l,d=c+f.rightKnobTop):(c=l-f.mouseDownXY.y,d=c+f.rightKnobTop),d<f.knobOffSet&&(d=f.knobOffSet),f.bodyViewHeight<d+f.rightKnobHeight&&(d=f.bodyViewHeight-f.rightKnobHeight),d<f.rightScrollScale&&(d=0),f.rightKnob.css("margin-top",d+j+"px"),h=f.rightScrollScale*d,f.scroll(h)),f.bottomKnobDown&&(Fancy.isTouch?(b=f.mouseDownXY.x-k,c=f.mouseDownXY.y-l,e=b+f.bottomKnobLeft):(b=k-f.mouseDownXY.x,c=l-f.mouseDownXY.y,e=b+f.bottomKnobLeft),e<1&&(e=1),f.bodyViewWidth-2<e+f.bottomKnobWidth&&(e=f.bodyViewWidth-f.bottomKnobWidth-2),f.bottomScrollScale<0&&e<0&&(e=0,f.bottomScrollScale=0),f.bottomKnob.css("margin-left",e+"px"),i=Math.ceil(f.bottomScrollScale*(e-1)),f.scroll(!1,i))},setScrollBars:function(){var a=this,b=a.widget;setTimeout(function(){a.checkRightScroll()},1),a.checkBottomScroll()||a.scrollTop&&b.scroll(!1,0),b.nativeScroller||(a.checkCorner(),a.setRightKnobSize(),a.setBottomKnobSize())},checkRightScroll:function(){var a=this,b=a.widget,c=b.body,d=b.gridBorders,e=b.getBodyHeight(),f=b.getCellsViewHeight()-d[0]-d[2];b.nativeScroller?e>=f?c.el.css("overflow-y","hidden"):c.el.css("overflow-y","scroll"):e>=f?a.scrollRightEl.addCls(g):a.scrollRightEl.removeCls(g)},isRightScrollable:function(){var a=this,b=a.widget;return b.nativeScroller?"scroll"===b.body.el.css("overflow-y"):!a.scrollRightEl.hasCls(g)},setRightKnobSize:function(){var a=this,b=a.widget;if(!b.nativeScroller){var c=b.getBodyHeight()-(a.corner?a.cornerSize:0)-2,d=b.getCellsViewHeight()-(a.corner?a.cornerSize:0),e=d-c,f=100-e/(c/100),g=c*(f/100),h=b.knobOffSet;g<a.minRightKnobHeight&&(g=a.minRightKnobHeight),!1===a.corner&&(c-=h),a.rightKnob.css("height",g+"px"),a.rightKnobHeight=g,a.bodyViewHeight=c,a.rightScrollScale=(d-c)/(c-g)}},checkBottomScroll:function(){var a,b=this,c=b.widget,d=c.body,e=c.getCenterViewWidth(),f=c.getCenterFullWidth()-2;return c.nativeScroller?e>f?(a=!1,d.el.css("overflow-x","hidden")):(a=!0,d.el.css("overflow-x","scroll")):e>f?(a=!1,b.scrollBottomEl.addCls(g)):(a=!0,b.scrollBottomEl.removeCls(g)),a},checkCorner:function(){var a=this;a.widget.nativeScroller||(a.corner=!a.scrollRightEl.hasCls(g)&&!a.scrollBottomEl.hasCls(g))},setBottomKnobSize:function(){var a=this,b=a.widget;if(!b.nativeScroller){var c=b.getCenterViewWidth()-(a.corner?a.cornerSize:0),d=b.getCenterFullWidth()-(a.corner?a.cornerSize:0),e=d-c,f=100-e/(d/100),g=c*(f/100)-2;g<a.minBottomKnobWidth&&(g=a.minBottomKnobWidth),a.bottomKnob.css("width",g+"px"),a.bottomKnobWidth=g,a.bodyViewWidth=c,a.bottomScrollScale=(c-d)/(c-g-2-1)}},scroll:function(a,b){var c,d=this,e=d.widget;if(e.nativeScroller)return null!==a&&void 0!==a&&(e.body.el.dom.scrollTop=a),null!==b&&void 0!==b&&(e.body.el.dom.scrollLeft=b,e.header&&e.header.scroll(b)),void e.fire("scroll");e.leftBody.scroll(a),c=e.body.scroll(a,b),e.rightBody.scroll(a),void 0!==c.scrollTop&&(d.scrollTop=Math.abs(c.scrollTop)),void 0!==c.scrollLeft&&(d.scrollLeft=Math.abs(c.scrollLeft)),e.fire("scroll")},scrollDelta:function(a){var b,c=this,d=c.widget;return d.leftBody.wheelScroll(a),b=d.body.wheelScroll(a),d.rightBody.wheelScroll(a),c.scrollTop=Math.abs(b.newScroll),c.scrollLeft=Math.abs(b.scrollLeft),d.fire("scroll"),b.scrolled},scrollRightKnob:function(){var a=this,b=a.widget,c=a.getScroll(),d=c/a.rightScrollScale+b.knobOffSet;a.rightKnob&&a.rightKnob.css("margin-top",d+"px")},scrollBottomKnob:function(){var a=this,b=a.widget,c=a.getBottomScroll(),d=c/a.bottomScrollScale+b.knobOffSet;0===c&&(d=-1),a.bottomKnob&&a.bottomKnob.css("margin-left",-d+"px")},getScroll:function(){var a=this,b=a.widget;return Math.abs(parseInt(b.body.el.select("."+b.columnCls).item(0).css("top")))},getBottomScroll:function(){var a=this,b=a.widget;return Math.abs(parseInt(b.body.el.select("."+b.columnCls).item(0).css("left")))},update:function(){var a=this;a.setScrollBars(),a.checkScroll()},onChangeStore:function(){this.update()},onColumnResize:function(){this.setScrollBars()},checkScroll:function(){var a=this,b=a.widget,c=a.getScroll(),d=b.getBodyHeight()-(a.corner?a.cornerSize:0),e=b.getCellsViewHeight()-(a.corner?a.cornerSize:0);c&&e<d&&(a.scroll(0),b.nativeScroller||a.scrollRightKnob())},scrollToCell:function(a){var b=this,c=b.widget,d=c.cellHeight,e=Fancy.get(a),f=e.parent(),g=Number(e.attr("index")),h=Number(f.attr("index")),i=b.getScroll(),j=d*(g+1),k=c.getBodyHeight(),l=b.getBottomScroll(),m=parseInt(c.body.el.css("width")),n=0,o=f.parent().parent().hasCls(c.centerCls);if(!c.nativeScroller){if(0===g&&0===h)return b.scroll(0,0),b.scrollBottomKnob(),void b.scrollRightKnob();if(j-i>k&&(i+=d,b.scroll(i)),o){for(var p=c.columns,q=0;q<=h;q++)n+=p[q].width;n-l>m?p[q]?b.scroll(i,-(l+p[q-1].width)):b.scroll(i,-(n-l-m)):0!==l&&0===h&&b.scroll(i,0),b.scrollBottomKnob()}b.scrollRightKnob()}},onNativeScrollBody:function(){var a=this,b=a.widget,c=b.body.el.dom.scrollTop,d=b.body.el.dom.scrollLeft;b.header&&b.header.scroll(-d),b.leftBody&&(b.leftBody.el.dom.scrollTop=c),b.rightBody&&(b.rightBody.el.dom.scrollTop=c),b.fire("nativescroll")},onMouseWheelLeft:function(a){var b=this,c=b.widget,d=Fancy.getWheelDelta(a.originalEvent||a),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onMouseWheelRight:function(a){var b=this,c=b.widget,d=Fancy.getWheelDelta(a.originalEvent||a),e=d*c.cellHeight;c.leftBody.el.dom.scrollTop-=e,c.body.el.dom.scrollTop-=e,c.rightBody.el.dom.scrollTop-=e},onLockColumn:function(){var a=this,b=a.widget;a.update(),b.setColumnsPosition()},onRightLockColumn:function(){var a=this,b=a.widget;a.update(),b.setColumnsPosition()},onUnLockColumn:function(){var a=this,b=a.widget;a.update(),b.setColumnsPosition()}})}(),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",innerCls:"fancy-loadmask-inner",imageCls:"fancy-loadmask-image",textCls:"fancy-loadmask-text",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget,c=b.store;b.once("render",function(){a.render(),c.loading&&a.onBeforeLoad(),b.on("beforeload",a.onBeforeLoad,a),b.on("load",a.onLoad,a)})},render:function(){var a,b,c=this,d=c.widget,e=d.el,f=e,g=Fancy.get(document.createElement("div")),h=d.lang;d.panel&&(f=d.panel.el),a=f.width(),b=f.height(),g.addCls(c.cls),"default"!==d.theme&&g.addCls("fancy-theme-"+d.theme),g.css({width:a,height:b,opacity:0}),g.update(['<div class="'+c.innerCls+'"><div class="'+c.imageCls+'"></div><div class="'+c.textCls+'">'+h.loadingText+"</div></div>"].join(" ")),c.el=Fancy.get(f.dom.appendChild(g.dom)),c.innerEl=c.el.select("."+c.innerCls),c.textEl=c.el.select("."+c.textCls);var i=c.innerEl.width(),j=c.innerEl.height();c.innerEl.css({left:a/2-i/2,top:b/2-j/2}),!0!==d.store.loading?g.css("display","none"):(g.css("display","block"),c.showLoadMask()),g.css("opacity",1)},onBeforeLoad:function(){this.showLoadMask()},onLoad:function(){this.hideLoadMask()},showLoadMask:function(a){var b=this,c=b.widget,d=c.lang;if(a)return b.textEl.update(a),void b.el.css("display","block");b.loaded=!1,setTimeout(function(){!0!==b.loaded&&(b.textEl.update(d.loadingText),b.el.css("display","block"))},50)},hideLoadMask:function(){var a=this;a.loaded=!0,a.el.css("display","none")}}),Fancy.define("Fancy.grid.plugin.ColumnResizer",{extend:Fancy.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",resizerLeftCls:"fancy-grid-resizer-left",resizerRightCls:"fancy-grid-resizer-right",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.on("render",function(){a.render(),a.ons()})},ons:function(){var a=this,b=a.widget;b.on("headercellmousemove",a.onCellMouseMove,a),b.on("headercellmousedown",a.onHeaderCellMouseDown,a),b.on("docclick",a.onDocClick,a),b.on("docmove",a.onDocMove,a),b.on("docmouseup",a.onDocMouseUp,a)},onCellMouseMove:function(a,b){var c=this,d=c.widget,e=Fancy.FIELD_CLS,f=d.cellHeaderTriggerCls,g=d.cellHeaderTriggerImageCls,h=b.e,i=Fancy.get(b.cell),j=h.offsetX,k=i.width(),l=Fancy.get(h.target),m=l.hasCls(f),n=l.hasCls(g),o=i.select("."+f).item(0),p=i.select("."+g).item(0),q=Fancy.get(h.target).closest("."+e).hasCls(e),r=parseInt(o.css("width")),s=parseInt(p.css("width")),t=k,u=7;if(m&&(t=r),n&&(t=s),!d.startResizing)if("left"===b.side&&b.index===d.leftColumns.length-1&&t-j<u+2&&(u+=2),!m&&!n&&"right"===b.side&&0===b.index&&j<u)c.isColumnResizable(b)&&(q||c.addCellResizeCls(b.cell));else if(!m&&!n&&j<u&&"center"===b.side&&0===b.index&&d.leftColumns.length)b.side="left",b.index=d.leftColumns.length-1,c.isColumnResizable(b)&&(q||c.addCellResizeCls(b.cell));else if(m||n||!(t-j<u||j<u)||0===b.index)t-j<u?n?s-j>2?c.removeCellResizeCls(b.cell):c.addCellResizeCls(b.cell):c.isColumnResizable(b)&&c.addCellResizeCls(b.cell):c.removeCellResizeCls(b.cell);else{var v=j<u;c.isColumnResizable(b,v)&&(q||c.addCellResizeCls(b.cell))}},addCellResizeCls:function(a){var b=this,c=b.widget,d=c.columnResizerCls,e=c.cellHeaderTriggerCls;Fancy.get(a).addCls(d),Fancy.get(a).select("."+e).addCls(d)},removeCellResizeCls:function(a){var b=this,c=b.widget,d=c.columnResizerCls,e=c.cellHeaderTriggerCls;Fancy.get(a).removeClass(d),Fancy.get(a).select("."+e).item(0).removeClass(d)},onHeaderCellMouseDown:function(a,b){var c=this,d=c.widget,e=d.cellHeaderTriggerCls,f=d.cellHeaderTriggerImageCls,a=b.e,g=Fancy.get(a.target),h=Fancy.get(b.cell),i=a.offsetX,j=h.width(),k=h.select("."+Fancy.FIELD_CLS),l=g.hasCls(e),m=g.hasCls(f),n=h.select("."+e).item(0),o=h.select("."+f).item(0),p=parseInt(n.css("width")),q=parseInt(o.css("width")),r=j,s=7;if(l&&(r=p),m)return void(r=q);k.length>0&&k.item(0).within(g.dom)||("left"===b.side&&b.index===d.leftColumns.length-1&&r-i<s+2&&(s+=2),!l&&!m&&"right"===b.side&&0===b.index&&i<s?(d.startResizing=!0,c.cell=b.cell,c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index,c.moveLeftResizer=!0):i<7&&"center"===b.side&&0===b.index&&d.leftColumns.length?(d.startResizing=!0,b.side="left",b.index=d.leftColumns.length-1,c.cell=c.getCell(b),c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index):!l&&!m&&i<s&&0!==b.index?(d.startResizing=!0,c.cell=c.getPrevCell(b),c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index-1):r-i<s&&(d.startResizing=!0,c.cell=b.cell,c.activeSide=b.side,c.clientX=a.clientX,c.columnIndex=b.index),d.startResizing&&c.isColumnResizable())},isColumnResizable:function(a,b){var c,d,e,f=this,g=f.widget;if(a){if(c=g.getColumns(a.side),e=a.index,b&&e--,isNaN(e))return;return d=c[e],!0===d.resizable}c=g.getColumns(f.activeSide),!0!==c[f.columnIndex].resizable&&(g.startResizing=!1,delete f.cell,delete f.activeSide,delete f.clientX,delete f.columnIndex)},getMinColumnWidth:function(){var a,b,c=this,d=c.widget,e=d.minCellWidth;return void 0===c.columnIndex?e:(a=d.getColumns(c.activeSide),b=a[c.columnIndex],b.minWidth?b.minWidth:e)},getMaxColumnWidth:function(){var a,b,c=this,d=c.widget;return void 0!==c.columnIndex&&(a=d.getColumns(c.activeSide),b=a[c.columnIndex],!!b.maxWidth&&b.maxWidth)},onDocClick:function(){this.widget.startResizing=!1},onDocMove:function(a,b){var c=this;c.widget.startResizing&&c.moveResizeEls(b)},render:function(){var a=this,b=a.widget,c=Fancy.get(document.createElement("div")),d=Fancy.get(document.createElement("div"));c.addCls(a.resizerLeftCls),d.addCls(a.resizerRightCls),a.leftEl=Fancy.get(b.el.dom.appendChild(c.dom)),a.rightEl=Fancy.get(b.el.dom.appendChild(d.dom))},moveResizeEls:function(a){var b=this,c=b.widget,d=Fancy.get(b.cell),e=parseInt(d.css("left")),f=b.getMinColumnWidth(),g=b.getMaxColumnWidth();switch(b.activeSide){case"left":break;case"center":e+=parseInt(c.leftEl.css("width"));break;case"right":e+=parseInt(c.leftEl.css("width")),e+=parseInt(c.centerEl.css("width"))}var h=a.clientX,i=h-b.clientX,j=d.width()+i;j<f&&(j=f),g&&j>g&&(j=g),b.deltaWidth=d.width()-j,b.moveLeftResizer?(i=h-b.clientX,j=d.width()-i,j<f&&(j=f),b.deltaWidth=d.width()-j,b.leftEl.css({display:"block",left:e+i+"px"}),b.rightEl.css({display:"block",left:e+d.width()-1+"px"})):(b.leftEl.css({display:"block",left:e+"px"}),b.rightEl.css({display:"block",left:e+j+"px"})),b.cellWidth=j},onDocMouseUp:function(){var a=this,b=a.widget;!1!==b.startResizing&&(a.leftEl.css({display:"none"}),a.rightEl.css({display:"none"}),a.fixSidesWidth(),b.startResizing=!1,a.moveLeftResizer=!1,delete a.cellWidth)},fixSidesWidth:function(){var a,b,c,d,e=this,f=e.widget,g=f.cellHeaderCls,h=f.cellHeaderGroupLevel2,i=f.columnCls,j=e.cellWidth,k=e.columnIndex,l=e.deltaWidth,m=f.leftEl,n=f.centerEl,o=f.rightEl,p=f.leftHeader.el,q=f.header.el,r=f.rightHeader.el,s=f.body.el,t={},u={},v=e.minCenterWidth;if(void 0!==j){var w=1;switch(Fancy.nojQuery&&(w=0),e.activeSide){case"left":if((d=parseInt(n.css("width"))+l+w)<v)return;c=f.leftColumns[k],f.leftColumns[e.columnIndex].width=j,a=f.leftBody.el.select("."+i),b=f.leftHeader.el.select("."+g),a.item(k).css("width",j+"px");for(var x=e.columnIndex+1,y=b.length,z=0,A=x;z<A;z++){var B=b.item(z),C=B.attr("group-index");C&&(u[C]=!0)}for(;x<y;x++){var D=a.item(x),B=b.item(x);D.css("left",parseInt(D.css("left"))-l-w),B.hasCls(h)&&u[B.attr("index")]||B.css("left",parseInt(B.css("left"))-l-w)}m.css("width",parseInt(m.css("width"))-l-w),p.css("width",parseInt(p.css("width"))-l-w+"px"),f.columns.length&&(n.css("left",parseInt(n.css("left"))-l-w),n.css("width",d),q.css("width",parseInt(q.css("width"))+l+w),s.css("width",parseInt(s.css("width"))+l+w));break;case"center":c=f.columns[k],f.columns[e.columnIndex].width=j,a=f.body.el.select("."+i),b=f.header.el.select("."+g),a.item(k).css("width",j+"px");for(var x=e.columnIndex+1,y=b.length,z=0,A=x;z<A;z++){var B=b.item(z),C=B.attr("group-index");C&&(u[C]=!0)}for(;x<y;x++){var D=a.item(x),B=b.item(x),E=parseInt(D.css("left"))-l-w,F=parseInt(B.css("left"))-l-w;B.attr("group-index")&&(t[B.attr("group-index")]={}),D.css("left",E),B.hasCls(h)&&u[B.attr("index")]||B.css("left",F)}break;case"right":if((d=parseInt(n.css("width"))+l+w)<v)return;c=f.rightColumns[k],f.rightColumns[e.columnIndex].width=j,a=f.rightBody.el.select("."+i),b=f.rightHeader.el.select("."+g),a.item(k).css("width",j+"px");for(var x=e.columnIndex+1,y=b.length,z=0,A=x;z<A;z++){var B=b.item(z),C=B.attr("group-index");C&&(u[C]=!0)}for(;x<y;x++){var D=a.item(x),B=b.item(x);D.css("left",parseInt(D.css("left"))-l-w),B.hasCls(h)&&u[B.attr("index")]||B.css("left",parseInt(B.css("left"))-l-w)}o.css("width",parseInt(o.css("width"))-l-w),r.css("width",parseInt(r.css("width"))-l-w+"px"),f.columns.length&&(n.css("width",d),q.css("width",parseInt(q.css("width"))+l+w),s.css("width",parseInt(s.css("width"))+l+w))}var G,H=Fancy.get(e.cell),I=H.attr("group-index");if(H.css("width",j+"px"),I)G=f.el.select("[index='"+I+"']"),G.css("width",parseInt(G.css("width"))-l-w);else for(var J in t)G=f.el.select("[index='"+J+"']"),G.css("left",parseInt(G.css("left"))-t[J].delta-w);if(f.fire("columnresize",{cell:H.dom,width:j}),/sparkline/.test(c.type))switch(e.activeSide){case"left":f.leftBody.updateRows(void 0,k);break;case"center":f.body.updateRows(void 0,k);break;case"right":f.rightBody.updateRows(void 0,k)}}},getPrevCell:function(a){var b,c=this,d=c.widget,e=d.cellHeaderCls;switch(a.side){case"left":b=d.leftHeader;break;case"center":b=d.header;break;case"right":b=d.rightHeader}return b.el.select("."+e).item(a.index-1).dom},getCell:function(a){var b,c=this,d=c.widget,e=d.cellHeaderCls;switch(a.side){case"left":b=d.leftHeader;break;case"center":b=d.header;break;case"right":b=d.rightHeader}return b.el.select("."+e).item(a.index).dom},updateColumnsWidth:function(a){for(var b=this,c=b.widget,a=a||"center",d=c.getHeader(a),e=c.getColumns(a),f=0,g=e.length;f<g;f++){var h=e[f];b.setColumnWidth(f,h.width,a)}d.setCellsPosition()},setColumnWidth:function(a,b,c){var d,e,f=this,g=f.widget,h=g.getColumns(c),i=g.getHeader(c),j=g.getBody(c),k=Fancy.get(j.getDomColumn(a)),l=i.getCell(a),m=parseInt(k.css("left"));k.css("width",b),l.css("width",b),h[a+1]&&(m+=b,e=Fancy.get(j.getDomColumn(a+1)),e.css("left",m),d=i.getCell(a+1),d.css("left",m))}}),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this;a.widget.once("render",function(){a.render()})},render:function(){var a=this,b=a.widget,c=b.body,d=Fancy.get(document.createElement("div"));/fancygrid/.test(location.host)&&!b.watermark||(!0!==a.checkLicence()||b.watermark)&&(d.css({position:"absolute","z-index":2,width:"30px",height:"30px"}),b.nativeScroller?d.css({top:"2px",left:"2px"}):d.css({right:"4px",bottom:"0px"}),d.update('<a href="http://www.fancygrid.com" title="JavaScript Grid - FancyGrid" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPklEQVR42mNgGLGAo+/4f1IwTN+i8y/+k4JHLR61eNTiUYuHgcUjD5AbZORG0ajFoxaPWjxq8RC2eBQMWwAAuxzh7E9tdUsAAAAASUVORK5CYII=);color: #60B3E2;font-size: 25px;line-height: 30px;text-decoration: none;">&nbsp;&nbsp;&nbsp;&nbsp;</a>'),Fancy.get(c.el.append(d.dom)),a.licenceEl=d,b.watermark&&a.configWatermark(),a.showConsoleText())},showConsoleText:function(){window.console&&console.log&&Fancy.isChrome&&console.log("%cFancy%cGrid%c %cTrial%c Version! \nPurchase license for legal usage!\nSales email: sales@fancygrid.com","color:#A2CFE8;font-size: 14px;font-weight: bold;","color:#088EC7;font-size: 14px;font-weight: bold;","font-weight:bold;color: #515151;font-size: 12px;","color: red;font-weight: bold;font-size: 14px;","font-weight:bold;color: #515151;font-size: 12px;")},configWatermark:function(){var a=this,b=a.widget,c=b.watermark;if(c.text){var d=a.licenceEl.firstChild();d.css("background-image","none"),d.css("font-size","11px"),d.update(c.text),a.licenceEl.css("width","initial")}c.style&&a.licenceEl.css(c.style)},checkLicence:function(){var a=this,b="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var c,d,e=String(a.md5(location.host.replace(/^www\./,""),b)),f=Fancy.LICENSE||FancyGrid.LICENSE||[],g=a.md5("UNIVERSAL",b),h=a.md5("SAAS",b),i=a.md5("INTERNAL",b),j=a.md5("OEM",b),k=a.md5("ENTERPRISE",b);for(c=0,d=f.length;c<d;c++)switch(String(f[c])){case e:case g:case h:case i:case j:case k:return!0}return!1},md5:function(a,b,c){var d=function(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(a,b){a[b>>5]|=128<<b%32,a[14+(b+64>>>9<<4)]=b;var c,e,f,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(c=0;c<a.length;c+=16)e=m,f=n,k=o,l=p,m=g(m,n,o,p,a[c],7,-680876936),p=g(p,m,n,o,a[c+1],12,-389564586),o=g(o,p,m,n,a[c+2],17,606105819),n=g(n,o,p,m,a[c+3],22,-1044525330),m=g(m,n,o,p,a[c+4],7,-176418897),p=g(p,m,n,o,a[c+5],12,1200080426),o=g(o,p,m,n,a[c+6],17,-1473231341),n=g(n,o,p,m,a[c+7],22,-45705983),m=g(m,n,o,p,a[c+8],7,1770035416),p=g(p,m,n,o,a[c+9],12,-1958414417),o=g(o,p,m,n,a[c+10],17,-42063),n=g(n,o,p,m,a[c+11],22,-1990404162),m=g(m,n,o,p,a[c+12],7,1804603682),p=g(p,m,n,o,a[c+13],12,-40341101),o=g(o,p,m,n,a[c+14],17,-1502002290),n=g(n,o,p,m,a[c+15],22,1236535329),m=h(m,n,o,p,a[c+1],5,-165796510),p=h(p,m,n,o,a[c+6],9,-1069501632),o=h(o,p,m,n,a[c+11],14,643717713),n=h(n,o,p,m,a[c],20,-373897302),m=h(m,n,o,p,a[c+5],5,-701558691),p=h(p,m,n,o,a[c+10],9,38016083),o=h(o,p,m,n,a[c+15],14,-660478335),n=h(n,o,p,m,a[c+4],20,-405537848),m=h(m,n,o,p,a[c+9],5,568446438),p=h(p,m,n,o,a[c+14],9,-1019803690),o=h(o,p,m,n,a[c+3],14,-187363961),n=h(n,o,p,m,a[c+8],20,1163531501),m=h(m,n,o,p,a[c+13],5,-1444681467),p=h(p,m,n,o,a[c+2],9,-51403784),o=h(o,p,m,n,a[c+7],14,1735328473),n=h(n,o,p,m,a[c+12],20,-1926607734),m=i(m,n,o,p,a[c+5],4,-378558),p=i(p,m,n,o,a[c+8],11,-2022574463),o=i(o,p,m,n,a[c+11],16,1839030562),n=i(n,o,p,m,a[c+14],23,-35309556),m=i(m,n,o,p,a[c+1],4,-1530992060),p=i(p,m,n,o,a[c+4],11,1272893353),o=i(o,p,m,n,a[c+7],16,-155497632),n=i(n,o,p,m,a[c+10],23,-1094730640),m=i(m,n,o,p,a[c+13],4,681279174),p=i(p,m,n,o,a[c],11,-358537222),o=i(o,p,m,n,a[c+3],16,-722521979),n=i(n,o,p,m,a[c+6],23,76029189),m=i(m,n,o,p,a[c+9],4,-640364487),p=i(p,m,n,o,a[c+12],11,-421815835),o=i(o,p,m,n,a[c+15],16,530742520),n=i(n,o,p,m,a[c+2],23,-995338651),m=j(m,n,o,p,a[c],6,-198630844),p=j(p,m,n,o,a[c+7],10,1126891415),o=j(o,p,m,n,a[c+14],15,-1416354905),n=j(n,o,p,m,a[c+5],21,-57434055),m=j(m,n,o,p,a[c+12],6,1700485571),p=j(p,m,n,o,a[c+3],10,-1894986606),o=j(o,p,m,n,a[c+10],15,-1051523),n=j(n,o,p,m,a[c+1],21,-2054922799),m=j(m,n,o,p,a[c+8],6,1873313359),p=j(p,m,n,o,a[c+15],10,-30611744),o=j(o,p,m,n,a[c+6],15,-1560198380),n=j(n,o,p,m,a[c+13],21,1309151649),m=j(m,n,o,p,a[c+4],6,-145523070),p=j(p,m,n,o,a[c+11],10,-1120210379),o=j(o,p,m,n,a[c+2],15,718787259),n=j(n,o,p,m,a[c+9],21,-343485551),m=d(m,e),n=d(n,f),o=d(o,k),p=d(p,l);return[m,n,o,p]},l=function(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c},m=function(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c},n=function(a){return l(k(m(a),8*a.length))},o=function(a,b){var c,d,e=m(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=k(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=k(f.concat(m(b)),512+8*b.length),l(k(g.concat(d),640))},p=function(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e},q=function(a){return unescape(encodeURIComponent(a))},r=function(a){return n(q(a))},s=function(a){return p(r(a))},t=function(a,b){return o(q(a),q(b))},u=function(a,b){return p(t(a,b))};return function(a,b,c){return b?c?t(b,a):u(b,a):c?r(a):s(a)}(a,b,c)}}),Fancy.ns("Fancy.grid.body.mixin"),Fancy.grid.body.mixin.Updater=function(){},Fancy.grid.body.mixin.Updater.prototype={update:function(){var a=this,b=a.widget,c=b.store;a.checkDomColumns(),c.loading||(a.checkDomCells(),a.updateRows(),a.showEmptyText())},checkDomColumns:function(){var a=this,b=a.widget,c=b.columnCls,d=b.columnTextCls,e=b.columnWithEllipsisCls,f=b.columnOrderCls,g=b.columnSelectCls,h=a.el.select("."+c).length,i=a.getColumns(),j=0,k=i.length;if(!(k<=h)){for(;j<k;j++){var l=i[j],m=l.width,n=Fancy.get(document.createElement("div"));if(l.hidden&&n.css("display","none"),n.addCls(c),n.attr("grid",b.id),"$selected"===l.index)n.addCls(g);else switch(l.type){case"order":n.addCls(f)}if(l.cls&&n.addCls(l.cls),"text"===l.type&&n.addCls(d),n.css({width:m+"px"}),n.attr("index",j),l.cellAlign&&n.css("text-align",l.cellAlign),!0===l.ellipsis)switch(l.type){case"string":case"text":case"number":n.addCls(e)}a.el.dom.appendChild(n.dom)}a.fire("adddomcolumns")}},checkDomCells:function(a){var b,c,d=this,e=d.widget,f=e.columnCls,g=e.cellCls,h=e.store,i=0,j=h.dataView.length,k=0;switch(d.side){case"left":c=e.leftColumns;break;case"center":c=e.columns;break;case"right":c=e.rightColumns}b=c.length;var l=d.el.select("."+f),m=h.getLength(),n=d.cellTpl;for(e.cellWrapper&&(n=d.cellWrapperTpl),void 0!==a&&(k=a,b=a);k<b;k++){c[k];var o=l.item(k);i=0;var p=m-o.select("."+g).length;for(i=j-p;i<j;i++){var q=n.getHTML({}),r=Fancy.get(document.createElement("div"));r.css({height:e.cellHeight+"px"}),r.addCls(d.cellCls),r.attr("index",i),i%2!=0&&e.striped&&r.addCls(e.cellEvenCls),r.update(q),o.dom.appendChild(r.dom)}if(e.nativeScroller&&("left"===d.side||"right"===d.side)){o.select("."+d.pseudoCellCls).destroy();var q=n.getHTML({cellValue:"&nbsp;"}),r=Fancy.get(document.createElement("div"));r.css({height:e.cellHeight+"px"}),r.addCls(d.pseudoCellCls),r.update(q),o.dom.appendChild(r.dom)}}},updateRows:function(a,b){var c,d,e=this,f=e.widget,g=0;switch(void 0===a?e.clearDirty():e.clearDirty(a),e.side){case"left":c=f.leftColumns;break;case"center":c=f.columns;break;case"right":c=f.rightColumns}for(d=c.length,void 0!==b&&(g=b,d=b+1);g<d;g++){var h=c[g];switch(h.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":e.renderUniversal(g,a);break;case"order":e.renderOrder(g,a);break;case"expand":e.renderExpand(g,a);break;case"select":e.renderSelect(g,a);break;case"color":e.renderColor(g,a);break;case"checkbox":e.renderCheckbox(g,a);break;case"image":e.renderImage(g,a);break;case"sparklineline":e.renderSparkLine(g,a,"line");break;case"sparklinebar":e.renderSparkLine(g,a,"bar");break;case"sparklinetristate":e.renderSparkLine(g,a,"tristate");break;case"sparklinediscrete":e.renderSparkLine(g,a,"discrete");break;case"sparklinebullet":e.renderSparkLine(g,a,"bullet");break;case"sparklinepie":e.renderSparkLine(g,a,"pie");break;case"sparklinebox":e.renderSparkLine(g,a,"box");break;case"circle":e.renderCircle(g,a);break;case"progressdonut":e.renderProgressDonut(g,a);break;case"progressbar":e.renderProgressBar(g,a);break;case"hbar":e.renderHBar(g,a);break;case"grossloss":e.renderGrossLoss(g,a);break;default:throw new Error("[FancyGrid error] - not existed column type "+h.type)}}e.removeNotUsedCells()},renderUniversal:function(a,b){var c,d,e,f=this,g=f.widget,h=g.columnCls,i=g.lang,j=g.emptyValue,k=g.store,l=f.getColumns(),m=l[a],n=f.el.select("."+h),o=n.item(a),p=o.select("."+g.cellCls),q=o.select("."+g.cellCls+" ."+g.cellInnerCls),r=i.currencySign;for(c=void 0!==m.key?m.key:void 0!==m.index?m.index:"action"===m.type?"none":void 0,void 0!==b?(d=b,e=b+1):(d=0,e=k.getLength());d<e;d++){var s,t=k.get(d),u=k.getId(d),v=q.item(d),w=p.item(d),x={rowIndex:d,data:t,style:{},column:m,id:u,item:k.getItem(d),inner:v,cell:w},y=!1;switch(k.changed[x.id]&&k.changed[x.id][m.index]&&(y=!0),s=m.smartIndexFn?m.smartIndexFn(t):k.get(d,c),x.value=s,m.format&&(x.value=f.format(x.value,m.format),s=x.value),m.type){case"currency":""!==s&&(s=r+s),x.value=s}switch(m.render&&(x=m.render(x),s=x.value),s){case"":case void 0:s=j}g.cellStylingCls&&f.clearCls(w),x.cls&&w.addCls(x.cls),y&&g.dirtyEnabled&&f.enableCellDirty(w),w.css(x.style),x.column.widget||v.update(s)}},renderOrder:function(a){var b=this,c=b.widget,d=c.columnCls,e=c.cellCls,f=c.cellInnerCls,g=c.store,h=b.getColumns(),i=h[a],j=b.el.select("."+d),k=j.item(a),l=k.select("."+e),m=k.select("."+e+" ."+f),n=0,o=g.getLength(),p=0;for(c.paging&&(p+=g.showPage*g.pageSize);n<o;n++){var q=g.get(n),r=g.getId(n),s={rowIndex:n,data:q,style:{},column:i,id:r,item:g.getItem(n)},t=n+1+p;s.value=t,i.render&&(s=i.render(s),t=s.value);var u=l.item(n);c.cellStylingCls&&b.clearCls(u),s.cls&&u.addCls(s.cls),u.css(s.style),m.item(n).update(t)}},renderExpand:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.el.select("."+f.columnCls),i=h.item(a),j=i.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var k,l=j.item(c),m=l.select(".fancy-field-checkbox"),n=0!==m.length,o=f.get(c),p=o.id;!1===n?new Fancy.CheckBox({renderTo:j.item(c).dom,renderId:!0,value:!1,label:!1,expander:!0,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,c){b=a.el.parent().parent().attr("index"),c?f.expander.expand(b):f.expander.collapse(b)}}]}):(k=m.dom.id,m=Fancy.getWidget(k),f.expander._expandedIds[p]?m.set(!0,!1):m.set(!1,!1))}},clearCls:function(a){for(var b=this,c=b.widget,d=c.cellStylingCls,e=0,f=d.length;e<f;e++)a.removeCls(d[e])},renderColor:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=f.columnCls,i=e.getColumns(),j=i[a],k=j.key||j.index,l=e.el.select("."+h),m=l.item(a),n=m.select("."+f.cellCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var o,p=g.get(c),q={rowIndex:c,data:p,style:{},column:j};o=j.smartIndexFn?j.smartIndexFn(p):g.get(c,k),j.render&&(q=j.render(q),o=q.value),q.value=o;var r=n.item(c);r.css(q.style);r.select("."+f.cellInnerCls).update('<div class="fancy-grid-color-cell" style="background: '+o+';"></div>')}},renderCombo:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=f.columnCls,i=f.cellCls,j=e.getColumns(),k=j[a],l=k.key||k.index,m=e.el.select("."+h),n=m.item(a),o=n.select("."+i),p=n.select("."+i+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var q=g.get(c,l),r={rowIndex:c,value:q,style:{}};k.render&&(r=k.render(r),q=r.value),o.item(c).css(r.style),p.item(c).update(q)}},renderCheckbox:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=f.columnCls,i=f.cellCls,j=e.getColumns(),k=j[a],l=k.key||k.index,m=e.el.select("."+h),n=m.item(a),o=n.select("."+i),p=n.select("."+i+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var q,r=g.get(c),s=g.get(c,l),t=p.item(c),u=t.select(".fancy-field-checkbox"),v=0!==u.length,w=!1,x=g.getId(c),y={rowIndex:c,data:r,style:{},column:k,id:x,item:g.getItem(c),value:s};if(g.changed[y.id]&&g.changed[y.id][k.index]&&(w=!0),k.render&&(y=k.render(y),s=y.value),!1===v)if(y.stopped)p.item(c).update(s);else{var z=!0;f.rowEdit&&(z=!1),p.item(c).update(""),new Fancy.CheckBox({renderTo:p.item(c).dom,renderId:!0,value:s,label:!1,editable:z,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(a){"$selected"!==k.index&&!0!==k.editable&&(a.canceledChange=!0)}},{change:function(a,b){"$selected"!==k.index&&(f.celledit.checkBoxChangedValue=b)}}]})}else q=u.dom.id,u=Fancy.getWidget(q),y.stopped?(u.destroy(),p.item(c).update(s)):u.set(s,!1);if(w){var A=o.item(c);e.enableCellDirty(A)}}},renderSelect:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select("."+f.columnCls),l=k.item(a),m=l.select("."+f.cellCls+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var n,o=g.get(c,j),p=g.get(c,"id"),q=m.item(c),r=q.select(".fancy-field-checkbox"),s=0!==r.length;f.selection.memory&&(f.selection.memory.all&&!f.selection.memory.except[p]?(o=!0,f.selection.domSelectRow(c)):f.selection.memory.selected[p]?(o=!0,f.selection.domSelectRow(c)):(o=!1,f.selection.domDeSelectRow(c))),!1===s?new Fancy.CheckBox({renderTo:m.item(c).dom,renderId:!0,value:o,label:!1,stopIfCTRL:!0,style:{padding:"0px",display:"inline-block"}}):(n=r.dom.id,r=Fancy.getWidget(n),r.set(o,!1))}},renderImage:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=f.cellCls,i=e.getColumns(),j=i[a],k=j.key||j.index,l=e.el.select("."+f.columnCls),m=l.item(a),n=m.select("."+h),o=m.select("."+h+" ."+f.cellInnerCls);for(void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var p=g.get(c,k),q=g.get(c),r={rowIndex:c,value:p,data:q,style:{}},s="";if(j.render&&(r=j.render(r),p=r.value),r.attr)for(var t in r.attr)s+=t+'="'+r.attr[t]+'"';p="<img "+s+' src="'+r.value+'">',n.item(c).css(r.style),o.item(c).update(p)}},renderSparkLine:function(a,b,c){var d,e,f=this,g=f.widget,h=g.cellHeight,i=g.cellCls,j=g.columnCls,k=g.store,l=f.getColumns(),m=l[a],n=m.width,o=m.key||m.index,p=f.el.select("."+j),q=p.item(a),r=q.select("."+i),s=q.select("."+i+" ."+g.cellInnerCls),t=m.sparkConfig||{};q.addCls(g.columnSparkCls),void 0!==b?(d=b,e=b+1):(d=0,e=k.getLength());var u,v=h-1,w=n-20;switch(c){case"line":case"pie":case"box":u="width";break;case"bullet":u="width",v-=11,q.addCls(g.columnSparkBulletCls);break;case"discrete":u="width",w=n,v-=2;break;case"bar":case"tristate":u="barWidth"}for(;d<e;d++){var x=k.get(d,o),y=k.get(d),z={rowIndex:d,value:x,data:y,style:{}};if(m.render&&(z=m.render(z),x=z.value),Fancy.isArray(m.values)){var A=0,B=m.values.length;for(x=[];A<B;A++)x.push(k.get(d,m.values[A]))}r.item(d).css(z.style);var C=s.item(d).dom,D={type:c,fillColor:"transparent",height:v};Fancy.apply(D,t),"bar"!==c&&"tristate"!==c||(w=n-20,w/=x.length),D[u]=w,Fancy.$(C).sparkline(x,D)}},renderProgressDonut:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=f.columnCls,i=f.cellCls,j=e.getColumns(),k=j[a],l=k.key||k.index,m=e.el.select("."+h),n=m.item(a),o=n.select("."+i),p=n.select("."+i+" ."+f.cellInnerCls);for(n.addCls(f.columnSparkDonutProgressCls),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var q,r=g.get(c),s={rowIndex:c,data:r,style:{},column:k};q=k.smartIndexFn?k.smartIndexFn(r):g.get(c,l),s.value=q,k.format&&(s.value=e.format(s.value,k.format),q=s.value),k.render&&(s=k.render(s),q=s.value),o.item(c).css(s.style);var t=k.sparkConfig||{},u=p.item(c).dom;Fancy.apply(t,{renderTo:u,value:q}),t.size||t.height||t.width||(t.size=f.cellHeaderHeight-6),Fancy.get(u).update(""),new Fancy.spark.ProgressDonut(t)}},renderGrossLoss:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select("."+f.columnCls),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls);l.addCls(f.columnGrossLossCls),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());var o=i.sparkConfig||{};for(o.showOnMax&&(o.maxValue=Math.max.apply(Math,g.getColumnData(j,i.smartIndexFn)));c<d;c++){var p,q=g.get(c),r={rowIndex:c,data:q,style:{},column:i};p=i.smartIndexFn?i.smartIndexFn(q):g.get(c,j),r.value=p,i.format&&(r.value=e.format(r.value,i.format),p=r.value),i.render&&(r=i.render(r),p=r.value),m.item(c).css(r.style),Fancy.apply(o,{renderTo:n.item(c).dom,value:p,column:i}),new Fancy.spark.GrossLoss(o)}},renderProgressBar:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select("."+f.columnCls),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls),o=100;l.addCls(f.columnProgressCls),void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());var p=i.sparkConfig||{};for(!1===p.percents&&(o=Math.max.apply(Math,g.getColumnData(j)));c<d;c++){var q,r=g.get(c),s={rowIndex:c,data:r,style:{},column:i};q=i.smartIndexFn?i.smartIndexFn(r):g.get(c,j),s.value=q,i.format&&(s.value=e.format(s.value,i.format),q=s.value),i.render&&(s=i.render(s),q=s.value),m.item(c).css(s.style);var t=Fancy.get(n.item(c).dom);if(t.select(".fancy-grid-column-progress-bar").length){var u=Fancy.getWidget(t.select(".fancy-grid-column-progress-bar").item(0).attr("id"));u.value=q,u.maxValue=o,u.update()}else Fancy.apply(p,{renderTo:n.item(c).dom,value:q,column:i,maxValue:o}),new Fancy.spark.ProgressBar(p)}},renderHBar:function(a,b){var c,d,e=this,f=e.widget,g=f.store,h=e.getColumns(),i=h[a],j=i.key||i.index,k=e.el.select("."+f.columnCls),l=k.item(a),m=l.select("."+f.cellCls),n=l.select("."+f.cellCls+" ."+f.cellInnerCls),o=i.sparkConfig||{},p=i.disabled||{};l.addCls(f.columnSparkHBarCls);var q,r,s={},a=0,t=Number.MIN_VALUE;if(Fancy.isArray(i.index))for(q=i.index.length;a<q;a++){var u=i.index[a];if(!p[u]){s[u]=g.getColumnData(u);var v=Math.max.apply(Math,s[u]);v>t&&(t=v),r=s[u].length}}else{var w=g.getColumnData(i.index),x=[];for(q=w.length;a<q;a++)for(var y=0,z=w[a].length;y<z;y++)p[y]||(s[y]=s[y]||[],s[y].push(w[a][y]));for(var A in s){var v=Math.max.apply(Math,s[A]);x.push(A),v>t&&(t=v),r=s[A].length}i.fields||(i.fields=x)}for(var B=[],C=0;C<r;C++){B[C]=0;for(var A in s)i.fields&&p[i.index+"."+A]||p[A]||(B[C]+=s[A][C])}for(maxValue=Math.max.apply(Math,B),o.maxItemValue=t,void 0!==b?(c=b,d=b+1):(c=0,d=g.getLength());c<d;c++){var D,w=g.get(c),E={rowIndex:c,data:w,style:{},column:i};D=i.smartIndexFn?i.smartIndexFn(w):g.get(c,j),E.value=D,i.format&&(E.value=e.format(E.value,i.format),D=E.value),i.render&&(E=i.render(E),D=E.value),m.item(c).css(E.style);var F=Fancy.get(n.item(c).dom);if(F.select(".fancy-spark-hbar").length){var G=Fancy.getWidget(F.select(".fancy-spark-hbar").item(0).attr("id"));G.maxValue=maxValue,G.maxItemValue=t,G.update(w)}else Fancy.apply(o,{renderTo:n.item(c).dom,value:D,data:w,column:i,maxValue:maxValue,height:f.cellHeight-1}),new Fancy.spark.HBar(o)}},renderCircle:function(a,b){function c(a,b){var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg:svg");d.setAttribute("width",b),d.setAttribute("height",b),d.setAttribute("viewBox","0 0 "+b+" "+b);var e=document.createElementNS(c,"circle");e.setAttributeNS(null,"cx",b/2),e.setAttributeNS(null,"cy",b/2),e.setAttributeNS(null,"r",b/2);var f="#F0F0F0";b>50&&(f="F0F0F0"),a<0&&(f="#F9DDE0"),e.setAttributeNS(null,"fill",f),d.appendChild(e);var g=document.createElementNS(c,"path"),h=2*Math.PI/100,i=0,j=a*h-.001,k=b/2+b/2*Math.sin(i),l=b/2-b/2*Math.cos(i),m=b/2+b/2*Math.sin(j),n=b/2-b/2*Math.cos(j),o=0;j-i>Math.PI&&(o=1);var p="M "+b/2+","+b/2+" L "+k+","+l+" A "+b/2+","+b/2+" 0 "+o+" 1 "+m+","+n+" Z";g.setAttribute("d",p),a<0?g.setAttribute("fill","#EA7369"):g.setAttribute("fill","#44A4D3"),d.appendChild(g);var q=document.createElementNS(c,"circle");return q.setAttributeNS(null,"cx",b/2),q.setAttributeNS(null,"cy",b/2),q.setAttributeNS(null,"r",.25*b),q.setAttributeNS(null,"fill","#fff"),d.appendChild(q),d}var d,e,f=this,g=f.widget,h=g.store,i=f.getColumns(),j=i[a],k=j.key||j.index,l=f.el.select("."+g.columnCls),m=l.item(a),n=m.select("."+g.cellCls+" ."+g.cellInnerCls),o=g.cellHeight-4;for(m.addCls(g.columnSparkCircleCls),void 0!==b?(d=b,e=b+1):(d=0,e=h.getLength());d<e;d++){var p,q=h.get(d),r={rowIndex:d,data:q,style:{}};p=j.smartIndexFn?j.smartIndexFn(q):h.get(d,k),r.value=p,j.render&&(r=j.render(r),p=r.value);var s=n.item(d).dom;""===s.innerHTML&&s.appendChild(c(p,o))}},removeNotUsedCells:function(){for(var a=this,b=a.widget,c=b.store,d=a.el.select("."+b.columnCls),e=0,f=d.length;e<f;e++)for(var g=d.item(e),h=g.select("."+b.cellCls),i=c.getLength(),j=h.length;i<j;i++)h.item(i).remove()},getFormat:function(a){var b=this,c=b.widget,d=c.lang;switch(a){case"number":return function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,d.thousandSeparator)};case"date":return function(b){var c=Fancy.Date.parse(b,d.date.read,a.mode);return b=Fancy.Date.format(c,d.date.write,a.mode)}}switch(a.type){case"date":return function(b){if(0===b.length)return"";var c=Fancy.Date.parse(b,a.read,a.mode);return b=Fancy.Date.format(c,a.write,void 0,a.mode)}}if(a.inputFn)return a.inputFn},format:function(a,b){switch(Fancy.typeOf(b)){case"string":a=this.getFormat(b)(a);break;case"function":a=b(a);break;case"object":a=b.inputFn?b.inputFn(a):this.getFormat(b)(a)}return a},enableCellDirty:function(a){a.hasCls("fancy-grid-cell-dirty")||(a.addCls("fancy-grid-cell-dirty"),a.append('<div class="fancy-grid-cell-dirty-el"></div>'))},clearDirty:function(a){var b=this;if(void 0!==a)return b.el.select('.fancy-grid-cell[index="'+a+'"] .fancy-grid-cell-dirty-el').destroy(),void b.el.select('.fancy-grid-cell-dirty[index="'+a+'"]').removeCls("fancy-grid-cell-dirty");b.el.select(".fancy-grid-cell-dirty-el").destroy(),b.el.select(".fancy-grid-cell-dirty").removeCls("fancy-grid-cell-dirty")},showEmptyText:function(){var a=this,b=a.widget,c=b.store;if("center"===a.side&&(a.emptyTextEl&&(a.emptyTextEl.destroy(),delete a.emptyTextEl),0===c.dataView.length)){var d=Fancy.get(document.createElement("div"));d.addCls("fancy-grid-empty-text"),d.update(b.emptyText),a.emptyTextEl=Fancy.get(a.el.dom.appendChild(d.dom))}}},Fancy.define("Fancy.grid.Body",{extend:Fancy.Widget,mixins:[Fancy.grid.body.mixin.Updater],cls:"fancy-grid-body",cellCls:"fancy-grid-cell",pseudoCellCls:"fancy-grid-pseudo-cell",cellTpl:['<div class="fancy-grid-cell-inner">{cellValue}</div>'],cellWrapperTpl:['<div class="fancy-grid-cell-wrapper">','<div class="fancy-grid-cell-inner">{cellValue}</div>',"</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.addEvents("adddomcolumns"),a.initTpl(),a.render(),a.ons()},initTpl:function(){var a=this;a.cellTpl=new Fancy.Template(a.cellTpl),a.cellWrapperTpl=new Fancy.Template(a.cellWrapperTpl)},ons:function(){var a=this,b=a.widget,c=b.cellCls,d=b.columnCls,e=b.id;b.on("afterrender",a.onAfterRender,a);var f="."+d+'[grid="'+e+'"]',g=f+" div."+c;a.el.on("click",a.onCellClick,a,g),a.el.on("dblclick",a.onCellDblClick,a,g),a.el.on("mouseenter",a.onCellMouseEnter,a,g),a.el.on("mouseleave",a.onCellMouseLeave,a,g),a.el.on("mousedown",a.onCellMouseDown,a,g),a.el.on("mouseenter",a.onColumnMouseEnter,a,f),a.el.on("mouseleave",a.onColumnMouseLeave,a,f)},render:function(){var a,b=this,c=b.widget,d=Fancy.get(document.createElement("div"));d.addCls(b.cls),a=c.el.select(".fancy-grid-"+b.side).dom,b.el=Fancy.get(a.appendChild(d.dom))},onAfterRender:function(){var a=this;a.update(),a.setHeight()},setColumnsPosition:function(a){var b=this,c=b.widget,d=c.columnCls,e=b.getColumns(),f=0,g=e.length,h=0,i=b.el.select("."+d+'[grid="'+c.id+'"]'),a=a||b.scrollLeft||0;for(h+=a;f<g;f++){var j=e[f];i.item(f).css({left:h+"px"}),j.hidden||(h+=j.width)}},wheelScroll:function(a){var b=this,c=b.widget,d=c.columnCls,e=c.knobOffSet,f=b.el.select("."+d+'[grid="'+c.id+'"]');if(0!==f.length){for(var g=parseInt(f.item(0).css("top")),h=0,i=f.length,j=c.getBodyHeight(),k=c.getCellsViewHeight(),l=k-j+e,m={oldScroll:parseInt(f.item(0).css("top")),newScroll:parseInt(f.item(0).css("top"))+30*a,deltaScroll:30*a};h<i;h++){var n=f.item(h),o=parseInt(n.css("top"))+30*a;o>0?(o=0,m.newScroll=0):Math.abs(o)>l&&(o=-l-e,m.newScroll=o),n.css("top",o+"px")}return m.scrolled=g!==parseInt(f.item(0).css("top")),m}},scroll:function(a,b){var c=this,d=c.widget,e=d.columnCls,f=c.el.select("."+e+'[grid="'+d.id+'"]'),g=0,h=f.length,i={};if(!1!==a&&null!==a&&void 0!==a)for(i.scrollTop=a;g<h;g++){var j=f.item(g);j.css("top",-a+"px")}return!1!==b&&null!==b&&void 0!==b&&(i.scrollLeft=b,d.header&&d.header.scroll(b),c.scrollLeft=b,d.body.setColumnsPosition(b),"center"===c.side&&(d.grouping&&d.grouping.scrollLeft(b),d.summary&&d.summary.scrollLeft(b))),i},setHeight:function(){var a=this,b=a.widget,c=b.getBodyHeight();a.css("height",c+"px")},onCellClick:function(a){var b=this,c=b.widget;c.fire("cellclick",b.getEventParams(a)),c.fire("rowclick",b.getEventParams(a)),c.fire("columnclick",b.getColumnEventParams(a)),!1===c.activated&&(c.activated=!0,c.fire("activate"))},onCellDblClick:function(a){var b=this,c=b.widget;c.fire("celldblclick",b.getEventParams(a)),c.fire("rowdblclick",b.getEventParams(a)),c.fire("columndblclick",b.getColumnEventParams(a))},getEventParams:function(a){var b=this,c=b.widget,d=c.store,e=b.getColumns(),f=a.currentTarget,g=Fancy.get(a.currentTarget),h=g.parent();if(void 0===g.parent().dom)return!1;if(0===d.getLength())return!1;var i=parseInt(h.attr("index")),j=parseInt(g.attr("index")),k=e[i],l=k.index||k.key,m=d.get(j,l),n=d.getId(j),o=d.get(j),p=d.getById(n);return k.smartIndexFn&&(m=k.smartIndexFn(o)),{e:a,id:n,side:b.side,cell:f,column:k,rowIndex:j,columnIndex:i,value:m,data:o,item:p}},getColumnEventParams:function(a){var b=this,c=b.widget,d=c.store,e=Fancy.get(a.currentTarget),f=e.parent(),g=parseInt(f.attr("index")),h=b.getColumns(),i=h[g],j={e:a,side:b.side,columnIndex:g,column:i,columnDom:f.dom};return c.columnClickData&&(j.data=d.getColumnData(i.index,i.smartIndexFn)),j},getColumnHoverEventParams:function(a){var b=this,c=Fancy.get(a.currentTarget),d=parseInt(c.attr("index")),e=b.getColumns(),f=e[d];return{e:a,side:b.side,columnIndex:d,column:f,columnDom:c.dom}},getColumns:function(){var a=this;return a.widget.getColumns(a.side)},onCellMouseEnter:function(a){var b=this,c=b.widget,d=b.getEventParams(a),e=b.prevCellOver;Fancy.nojQuery&&e&&b.fixZeptoBug&&(d.rowIndex===e.rowIndex&&d.columnIndex===e.columnIndex&&d.side===e.side||(c.fire("cellleave",e),d.rowIndex!==e.rowIndex&&c.fire("rowleave",e))),e?d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("rowenter",d),c.fire("cellenter",d),b.prevCellOver=d},onCellMouseDown:function(a){var b=this,c=b.widget,d=b.getEventParams(a),e={e:d.e,side:d.side,columnDom:Fancy.get(d.cell).parent().dom,column:d.column,columnIndex:d.columnIndex};c.fire("beforecellmousedown",d),c.fire("cellmousedown",d),c.fire("columnmousedown",e)},onCellMouseLeave:function(a){var b=this,c=b.widget,d=b.getEventParams(a),e=b.prevCellOver;if(Fancy.nojQuery){if(void 0===e)return;return void(b.fixZeptoBug=d)}c.fire("rowleave",e),c.fire("cellleave",e),delete b.prevCellOver},onColumnMouseEnter:function(a){var b=this,c=b.widget,d=b.getColumnHoverEventParams(a);b.prevColumnOver?b.prevCellOver&&d.rowIndex!==b.prevCellOver.rowIndex&&c.fire("rowenter",d):c.fire("columnenter",d),b.prevColumnOver=d},onColumnMouseLeave:function(a){var b=this;b.widget.fire("columnleave",b.prevColumnOver),delete b.prevColumnOver},getCell:function(a,b){var c=this,d=c.widget,e=d.cellCls,f=d.columnCls;return c.el.select("."+f+'[index="'+b+'"] .'+e+'[index="'+a+'"]')},getDomCell:function(a,b){var c=this,d=c.widget,e=d.cellCls,f=d.columnCls;return c.el.select("."+f+'[index="'+b+'"][grid="'+d.id+'"] .'+e+'[index="'+a+'"]').dom},getDomColumn:function(a){var b=this,c=b.widget,d=c.columnCls;return b.el.select("."+d+'[index="'+a+'"][grid="'+c.id+'"]').dom},destroy:function(){var a=this,b=a.widget,c=b.columnCls,d=b.cellCls,e="div."+d,f="div."+c;a.el.un("click",a.onCellClick,a,e),a.el.un("dblclick",a.onCellDblClick,a,e),a.el.un("mouseenter",a.onCellMouseEnter,a,e),a.el.un("mouseleave",a.onCellMouseLeave,a,e),a.el.un("mousedown",a.onCellMouseDown,a,e),a.el.un("mouseenter",a.onColumnMouseEnter,a,f),a.el.un("mouseleave",a.onColumnMouseLeave,a,f)},hideColumn:function(a){var b=this,c=b.widget,d=c.columnCls,e=b.el.select("."+d),f=e.item(a),g=parseInt(f.css("width")),h=a+1,i=e.length;for(f.hide();h<i;h++){var j=e.item(h),k=parseInt(j.css("left"))-g;j.css("left",k)}},showColumn:function(a){var b,c=this,d=c.widget,e=d.columnCls,f=c.el.select("."+e),g=f.item(a),h=a+1,i=f.length;for(g.show(),b=parseInt(g.css("width"));h<i;h++){var j=f.item(h),k=parseInt(j.css("left"))+b;j.css("left",k)}},removeColumn:function(a){var b=this,c=b.widget,d=c.columnCls,e=b.el.select("."+d),f=e.item(a),g=parseInt(f.css("width")),h=a+1,i=e.length;for(f.destroy();h<i;h++){var j=e.item(h),k=parseInt(j.css("left"))-g;j.attr("index",h-1),j.css("left",k)}},insertColumn:function(a,b){for(var c=this,d=c.widget,e=d.columnCls,f=d.columnWithEllipsisCls,g=d.columnTextCls,h=d.columnOrderCls,i=d.columnSelectCls,j=c.getColumns(),k=c.el.select("."+e),l=b.width,m=Fancy.get(document.createElement("div")),n=a,o=k.length,p=0,q=0,r=a;q<r;q++)p+=j[q].width;for(;n<o;n++){var s=k.item(n);p=parseInt(s.css("left"))+b.width,s.css("left",p),s.attr("index",n+1)}if(m.addCls(e),m.attr("grid",d.id),"$selected"===b.index)m.addCls(i);else switch(b.type){case"order":m.addCls(h)}if(b.cls&&m.addCls(b.cls),"text"===b.type&&m.addCls(g),m.css({width:l+"px"}),m.attr("index",a),b.cellAlign&&m.css("text-align",b.cellAlign),!0===b.ellipsis)switch(b.type){case"string":case"text":case"number":m.addCls(f)}var t=d.scroller.getScroll();m.css("top",-t),0===a&&k.length?(m.css("left","0px"),c.el.dom.insertBefore(m.dom,k.item(a).dom)):0!==a&&k.length&&(m.css("left",p+"px"),c.el.dom.appendChild(m.dom)),c.checkDomCells(),c.updateRows(void 0,a)}}),Fancy.define("Fancy.grid.Header",{extend:Fancy.Widget,cls:Fancy.GRID_HEADER_CLS,mixins:["Fancy.grid.header.mixin.Menu"],cellTpl:['<div class="fancy-grid-header-cell {cls}" style="display:{display};width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="fancy-grid-header-cell-container" style="height: {height};">','<span class="fancy-grid-header-cell-text">{columnName}</span>','<span class="fancy-grid-header-cell-trigger">','<div class="fancy-grid-header-cell-trigger-image"></div>',"</span>","</div>","</div>"],constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initTpl(),a.render(),a.renderHeaderCheckBox(),a.setAlign(),a.setCellsPosition(),a.ons()},initTpl:function(){var a=this;a.cellTpl=new Fancy.Template(a.cellTpl)},ons:function(){var a=this,b=a.widget,c=b.cellHeaderTriggerCls,d=b.cellHeaderCls,e="div."+d;b.on("render",a.onAfterRender,a),a.el.on("click",a.onTriggerClick,a,"span."+c),a.el.on("click",a.onCellClick,a,e),a.el.on("mousemove",a.onCellMouseMove,a,e),a.el.on("mousedown",a.onCellMouseDown,a,e),a.el.on("mousedown",a.onMouseDown,a)},render:function(){var a,b=this,c=b.widget,d=c.cellHeaderSelectCls,e=c.cellHeaderGroupLevel1,f=b.getColumns(),g=Fancy.get(document.createElement("div")),h="",i=0,j=f.length,k=1,l={},m=0,n=c.filter&&c.filter.header,o="full",p=c.cellHeaderHeight;for(c.groupheader&&(n&&!c.filter.groupHeader?o="small":k=2),n&&k++;i<j;i++){var q=f[i],r=q.title||q.header,s=p,t="",u="";if(1!==k&&(q.grouping?(l[q.grouping]||(l[q.grouping]={width:0,title:q.grouping,left:m}),s=n&&c.filter.groupHeader?2*p+"px":p+"px",q.hidden||(l[q.grouping].width+=q.width),u='group-index="'+q.grouping+'"',t=e):s=k*p+"px"),m+=q.width,"$selected"===q.index&&(t+=" "+d),q.menu||(t+=" fancy-grid-header-cell-trigger-disabled"),q.filter&&q.filter.header)switch(o){case"small":t+=" fancy-grid-header-filter-cell-small";break;case"full":t+=" fancy-grid-header-filter-cell-full"}h+=b.cellTpl.getHTML({cls:t,columnName:r,columnWidth:q.width,index:i,height:s,left:"initial",groupIndex:u,display:q.hidden?"none":""})}g.css({height:p*k+"px",width:b.getColumnsWidth()}),g.addCls(b.cls),c.groupheader&&(g.addCls("fancy-grid-header-grouped"),h+=b.getGroupingCellsHTML(l)),g.update(h),a=c.el.select(".fancy-grid-"+b.side).dom,b.el=Fancy.get(a.appendChild(g.dom))},insertCell:function(a,b){var c=this,d=c.widget,e=d.cellHeaderSelectCls,f=d.cellHeaderCls,g=d.cellHeaderGroupLevel2,h=c.el.select("."+f+":not(."+g+")"),i=c.getColumns(),j="",k=b.title||b.header,l=parseInt(h.item(0).css("height")),m="",n=0;if(d.groupheader){l=2*d.cellHeight;var o=c.el.select("."+g);a!==d.columns.length-1&&o.each(function(a){var c=parseInt(a.css("left")||0)+b.width;a.css("left",c)})}"$selected"===b.index&&(j+=" "+e),b.menu||(j+=" fancy-grid-header-cell-trigger-disabled");for(var p=0,q=a;p<q;p++)n+=i[p].width;for(var r=a,s=i.length-1;r<s;r++){var t=h.item(r),u=parseInt(t.css("left")||0)+b.width;t.css("left",u)}var v=c.cellTpl.getHTML({cls:j,columnName:k,columnWidth:b.width,index:a,height:String(l)+"px",left:String(n)+"px",groupIndex:m});0===a&&h.length?Fancy.get(h.item(0).before(v)):0!==a&&h.length&&c.el.append(v),c.css("width",parseInt(c.css("width"))+b.width)},setAlign:function(){for(var a=this,b=a.getColumns(),c=0,d=b.length;c<d;c++){var e=b[c];e.align&&a.getDomCell(c).css("text-align",e.align)}},onAfterRender:function(){},setCellsPosition:function(){var a=this,b=a.widget,c=b.cellHeaderGroupLevel2,d=b.cellHeaderCls,e=a.getColumns(),f=0,g=a.el.select("."+d);if(f+=a.scrollLeft||0,Fancy.each(e,function(a,c){var d=g.item(c),e="0px";a.grouping&&(e=b.cellHeaderHeight+"px"),d.css({top:e,left:f+"px"}),a.hidden||(f+=a.width)}),b.groupheader){a.el.select("."+c).each(function(b){var c=b.attr("index"),d=a.el.select('[group-index="'+c+'"]'),f=d.item(0).css("left"),g=0;Fancy.each(e,function(a){a.grouping!==c||a.hidden||(g+=a.width)}),b.css("left",f),b.css("width",g)})}},getColumnsWidth:function(){for(var a=this,b=a.getColumns(),c=0,d=0,e=b.length;d<e;d++){c+=b[d].width}return c},getColumns:function(){var a,b=this,c=b.widget;switch(b.side){case"left":a=c.leftColumns;break;case"center":a=c.columns;break;case"right":a=c.rightColumns}return a},getDomCell:function(a){var b=this,c=b.widget;return b.el.select("."+c.cellHeaderCls).item(a)},onCellClick:function(a){var b=this,c=b.widget,d=c.cellHeaderGroupLevel2,e=c.cellHeaderTriggerCls,f=c.cellHeaderTriggerImageCls,g=a.currentTarget,h=Fancy.get(a.target),i=parseInt(Fancy.get(g).attr("index"));h.hasCls(e)||h.hasCls(f)||Fancy.get(g).hasCls(d)||c.fire("headercellclick",{e:a,side:b.side,cell:g,index:i})},onCellMouseMove:function(a){var b=this,c=b.widget,d=c.cellHeaderGroupLevel2,e=a.currentTarget,f=Fancy.get(e),g=f.hasCls(d),h=parseInt(Fancy.get(e).attr("index"));g||c.fire("headercellmousemove",{e:a,side:b.side,cell:e,index:h})},onMouseDown:function(a){"INPUT"===Fancy.get(a.target).prop("tagName")||a.preventDefault()},onCellMouseDown:function(a){var b=this,c=b.widget,d=a.currentTarget,e=parseInt(Fancy.get(d).attr("index"));c.fire("headercellmousedown",{e:a,side:b.side,cell:d,index:e})},scroll:function(a){var b=this;b.scrollLeft=a,b.setCellsPosition()},getGroupingCellsHTML:function(a){var b=this,c=b.widget,d="";return Fancy.each(a,function(a,e){d+=b.cellTpl.getHTML({cls:c.cellHeaderGroupLevel2,columnName:a.title,columnWidth:a.width,index:e,height:c.cellHeaderHeight+"px",left:a.left+"px",groupIndex:""})}),d},destroy:function(){var a=this,b=a.widget,c="div."+b.cellHeaderCls;a.el.un("click",a.onCellClick,a,c),a.el.un("mousemove",a.onCellMouseMove,a,c),a.el.un("mousedown",a.onCellMouseDown,a,c),a.el.un("mousedown",a.onMouseDown,a)},getCell:function(a){var b=this,c=b.widget;return b.el.select("."+c.cellHeaderCls+'[index="'+a+'"]')},onTriggerClick:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.parent().parent(),e=parseInt(d.attr("index")),f=b.getColumns(),g=f[e];a.stopPropagation(),b.showMenu(d,e,g,f)},hideCell:function(a){var b=this,c=b.widget,d=c.cellHeaderCls,e=c.cellHeaderGroupLevel1,f=c.cellHeaderGroupLevel2,g=b.el.select("."+d+":not(."+f+")"),h=g.item(a),i=parseInt(h.css("width")),j=a+1,k=g.length,l=b.getColumns();if(h.hasCls(e)){var m=h.attr("group-index"),n=b.el.select("."+f+'[index="'+m+'"]').item(0),o=parseInt(n.css("width"));n.css("width",o-i)}h.hide();for(var p={};j<k;j++){var q=g.item(j),r=parseInt(q.css("left"))-i,s=l[j];s.grouping&&l[a].grouping!==s.grouping&&(p[s.grouping]=!0),q.css("left",r)}Fancy.each(p,function(a,c){var d=b.el.select("."+f+'[index="'+c+'"]').item(0);d.css("left",parseInt(d.css("left"))-i)})},showCell:function(a){var b,c=this,d=c.widget,e=d.cellHeaderCls,f=d.cellHeaderGroupLevel1,g=d.cellHeaderGroupLevel2,h=c.el.select("."+e+":not(."+g+")"),i=h.item(a),j=a+1,k=h.length,l=c.getColumns();if(i.show(),b=parseInt(i.css("width")),i.hasCls(f)){var m=i.attr("group-index"),n=c.el.select("."+g+'[index="'+m+'"]').item(0),o=parseInt(n.css("width"));n.css("width",o+b)}for(var p={};j<k;j++){var q=h.item(j),r=parseInt(q.css("left"))+b,s=l[j];s.grouping&&l[a].grouping!==s.grouping&&(p[s.grouping]=!0),q.css("left",r)}for(var t in p){var n=c.el.select("."+g+'[index="'+t+'"]').item(0);n.css("left",parseInt(n.css("left"))+b)}},removeCell:function(a){var b=this,c=b.widget,d=c.cellHeaderCls,e=c.cellHeaderGroupLevel2,f=b.el.select("."+d+":not(."+e+")"),g=f.item(a),h=parseInt(g.css("width")),i=a+1,j=f.length,k={},l=!1;for(g.attr("group-index")&&(l=g.attr("group-index"),k[l]=!0),g.destroy();i<j;i++){var m=f.item(i),n=parseInt(m.css("left"))-h;m.attr("group-index")&&(k[m.attr("group-index")]=!0),m.attr("index",i-1),m.css("left",n)}for(var o in k){var p=b.el.select('[index="'+o+'"]'),q=parseInt(p.css("width"))-h,r=parseInt(p.css("left"))-h;l?(p.css("width",q),p.attr("index")!==l&&p.css("left",r)):p.css("left",r)}if(l&&0===b.el.select('[group-index="'+l+'"]').length){var p=b.el.select('[index="'+l+'"]');p.destroy()}"center"!==b.side&&b.css("width",parseInt(b.css("width"))-h)},renderHeaderCheckBox:function(){for(var a=this,b=a.widget,c=a.getColumns(),d=0,e=c.length,f=a.el.select("."+b.cellHeaderCls+":not(."+b.cellHeaderGroupLevel2+")");d<e;d++){var g=c[d];if(!0===g.headerCheckBox){var h=f.item(d),i=h.firstChild(),j=h.select(".fancy-grid-header-cell-text"),k=j.dom.innerHTML,l=k||!1,m=0;h.addCls("fancy-grid-header-cell-checkbox"),j.update(""),l.length&&(m=15*l.width),g.headerCheckBox=new Fancy.CheckBox({renderTo:i.dom,renderId:!0,labelWidth:m,value:!1,label:l,labelAlign:"right",style:{padding:"0px",display:"inline-block"},events:[{change:function(a,c){for(var d=0,e=b.getViewTotal();d<e;d++)b.set(d,g.index,c)}}]})}}},reSetIndexes:function(){var a=this,b=a.widget;a.el.select("."+b.cellHeaderCls+":not(."+b.cellHeaderGroupLevel2+")").each(function(a,b){a.attr("index",b)})}});