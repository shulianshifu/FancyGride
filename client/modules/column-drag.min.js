!function(){var a=Fancy,b=a.get(document),c=a.HIDDEN_CLS,d=a.GRID_HEADER_CELL_CLS,e=a.GRID_HEADER_CELL_TRIGGER_CLS,f=a.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,g=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS;a.define("Fancy.grid.plugin.ColumnDrag",{extend:a.Plugin,ptype:"grid.columndrag",inWidgetName:"columndrag",activeSide:void 0,activeCell:void 0,activeIndex:void 0,activeColumn:void 0,inCell:void 0,inIndex:void 0,inSide:void 0,ok:!1,status:"none",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.on("render",function(){a.ons(),a.initHint()})},ons:function(){var a=this;a.widget.el.on("mousedown",a.onMouseDownCell,a,"div."+d)},onMouseDownCell:function(a){var c=this,e=c.widget,h=Fancy.get(a.currentTarget),i=Number(h.attr("index")),j=c.getSideByCell(h),k=e.getColumns(j),l=k[i];h.hasCls(g)||e.startResizing||(c.activeCellTopGroup||!1!==l.draggable)&&(h.hasCls(f)&&(c.activeUnderGroup=!0),c.activeSide=j,c.inSide=j,c.activeCell=h,c.inCell=h,c.activeIndex=Number(h.attr("index")),c.inIndex=c.activeIndex,c.activeColumn=k[c.activeIndex],c.mouseDownX=a.x,c.mouseDownY=a.y,b.once("mouseup",c.onMouseUp,c),b.on("mousemove",c.onMouseMove,c),e.el.on("mouseleave",c.onMouseLeave,c),e.el.on("mouseenter",c.onMouseEnterCell,c,"div."+d),e.el.on("mousemove",c.onMouseMoveCell,c,"div."+d))},onMouseLeave:function(){this.hideHint()},onMouseUp:function(){var a=this,c=a.widget,e=!1;if(b.un("mousemove",a.onMouseMove,a),c.el.un("mouseleave",a.onMouseLeave,a),c.el.un("mouseenter",a.onMouseEnterCell,a,"div."+d),c.el.un("mousemove",a.onMouseMoveCell,a,"div."+d),a.ok){if(a.inSide===a.activeSide)a.dragColumn(a.inSide);else if("center"===a.activeSide){var f=a.inIndex;"right"===a.okPosition&&f++,c.moveColumn(a.activeSide,a.inSide,a.activeIndex,f)}else{var f=a.inIndex;"right"===a.okPosition&&f++,c.moveColumn(a.activeSide,a.inSide,a.activeIndex,f)}e=!0}delete a.inUpGroupCell,delete a.inUnderGroup,delete a.activeCellTopGroup,delete a.activeUnderGroup,delete a.activeSide,delete a.activeCell,delete a.activeIndex,delete a.activeIndex,delete a.activeColumn,delete a.mouseDownX,delete a.mouseDownY,a.ok=!1,delete a.okPosition,a.tip&&(a.tip.destroy(),delete a.tip),"dragging"===a.status&&setTimeout(function(){a.status="none",e&&(c.fire("columndrag"),c.scroller.update())},10),a.hideHint()},onMouseMove:function(a){var b=this,c=b.widget,d=a.x,e=a.y,f=c.getColumns(b.activeSide);if((Math.abs(d-b.mouseDownX)>10||Math.abs(e-b.mouseDownY))&&!b.tip)b.tip=new Fancy.ToolTip({text:b.activeColumn.title,cls:"fancy-drag-cell"}),b.tip.el.css("display","block");else if(!b.tip)return;if(1===f.length&&"center"===b.activeSide)return void b.tip.destroy();b.tip.show(a.pageX+15,a.pageY+15)},onMouseEnterCell:function(a){var b=this,c=Fancy.get(a.currentTarget),d=b.getSideByCell(c);b.hideHint(),c.hasCls(f)?b.inUnderGroup=!0:delete b.inUnderGroup,c.hasCls(g)?b.inUpGroupCell=c:delete b.inUpGroupCell,b.inSide=d,b.inCell=c,b.inIndex=Number(c.attr("index"))},onMouseMoveCell:function(a){var b=this,c=b.widget,d=b.inCell,f=parseInt(d.css("width")),g=d.select("."+e),h=Fancy.get(a.target),i=g.within(h)||h.hasClass(e),j=b.activeUnderGroup!==b.inUnderGroup&&!0===b.inUnderGroup,k=b.activeUnderGroup!==b.inUnderGroup&&!0===b.activeUnderGroup;if(b.status="dragging",1===c.getColumns(b.activeSide).length&&"center"===b.activeSide)return b.ok=!1,void b.hideHint();if(b.inUpGroupCell){var l=b.getGroupStartEnd(),m=l.start,n=l.end;b.activeSide!==b.inSide?(b.ok=!0,a.offsetX>f/2||i?b.showHint("right"):b.showHint("left")):a.offsetX>f/2?b.activeIndex>n&&b.activeIndex-1===n?b.hideHint():(b.ok=!0,b.showHint("right")):b.activeIndex<m&&b.activeIndex+1===m?b.hideHint():(b.ok=!0,b.showHint("left"))}else b.activeSide!==b.inSide?(b.ok=!0,a.offsetX>f/2||i?b.showHint("right"):b.showHint("left")):b.activeIndex===b.inIndex?b.ok=!1:b.activeIndex<b.inIndex?a.offsetX>f/2||i?(b.ok=!0,b.showHint("right")):a.offsetX<f/2&&b.activeIndex+1!==b.inIndex?(b.ok=!0,b.showHint("left")):b.activeIndex+1===b.inIndex&&(j||k)?(b.ok=!0,b.showHint("left")):(b.ok=!1,b.hideHint()):b.activeIndex>b.inIndex&&(a.offsetX<f/2?i?j||k?(b.ok=!0,b.showHint("right")):b.activeIndex-1===b.inIndex||b.inUpGroupCell?(b.ok=!1,b.hideHint()):(b.ok=!0,b.showHint("right")):(b.ok=!0,b.showHint("left")):a.offsetX>f/2?b.activeIndex-1===b.inIndex&&(j||k)?(b.ok=!0,b.showHint("right")):b.activeIndex-1!==b.inIndex||b.activeUnderGroup?(b.ok=!0,b.showHint("right")):(b.ok=!1,b.hideHint()):(b.ok=!1,b.hideHint()))},showHint:function(a){var b=this,d=b.widget,e=d.cellHeaderHeight,f=b.inCell,g=b.topEl,h=b.bottomEl,i=f.offset(),j=parseInt(f.css("width")),k=parseInt(f.css("height"));b.okPosition=a,g.removeCls(c),h.removeCls(c);var l=0;"right"===a&&(l+=j),g.css({left:i.left+l-Math.ceil(parseInt(g.css("width"))/2),top:i.top-parseInt(g.css("height"))});var m=i.top+k;if(b.inUpGroupCell){var n=d.header.calcRows();m=i.top+n*e}h.css({left:i.left+l-Math.ceil(parseInt(h.css("width"))/2),top:m})},hideHint:function(){var a=this;a.topEl.addCls(c),a.bottomEl.addCls(c)},initHint:function(){var b=this,d=b.widget,e="fancy-theme-"+d.theme,f=a.get(document.body).dom,g=a.get(document.createElement("div")),h=a.get(document.createElement("div"));g.addCls("fancy-drag-hint-top",c,e),h.addCls("fancy-drag-hint-bottom",c,e),b.topEl=a.get(f.appendChild(g.dom)),b.bottomEl=a.get(f.appendChild(h.dom))},dragColumn:function(a){var b=this,c=b.widget,d=c.getHeader(a),e=c.getBody(a),f=b.activeIndex,g=b.inIndex,h=b.okPosition,i=c.getColumns(a),j=i[f],k=d.calcRows();if(b.inUpGroupCell){var l=b.getGroupStartEnd();g=l.start,"right"===h&&(g=l.end+1)}else if("right"===h)if(b.inUnderGroup){var m=i[g].grouping,n=i[g+1];n&&n.grouping===m&&g++}else g++;if(c.groupheader){var o=i[g];o&&o.grouping&&b.inUnderGroup?(j.grouping=o.grouping,j.filter&&j.filter.header&&k<3&&delete j.filter):delete j.grouping}i.splice(f,1),f<g&&g--,i.splice(g,0,j),e.clearColumnsStyles(),d.updateTitles(),d.updateCellsSizes(),c.groupheader&&(c.header.fixGroupHeaderSizing(),c.leftColumns&&c.leftHeader.fixGroupHeaderSizing(),c.rightColumns&&c.rightHeader.fixGroupHeaderSizing(),d.reSetGroupIndexes()),d.reSetColumnsAlign(),e.reSetColumnsAlign(),e.reSetColumnsCls(),e.updateColumnsSizes(),c.update()},getSideByCell:function(a){var b,c=this,d=c.widget;return d.centerEl.within(a)?b="center":d.leftEl.within(a)?b="left":d.rightEl.within(a)&&(b="right"),b},getGroupStartEnd:function(b,c){var d=this,e=d.widget,f=e.getHeader(c||d.inSide),g=(b||d.inUpGroupCell).attr("index"),h=f.el.select('[group-index="'+g+'"]'),i=[];return h.each(function(a){i.push(Number(a.attr("index")))}),{start:a.Array.min(i),end:a.Array.max(i)}}})}(),function(){var a=Fancy,b=a.get(document),c=a.HIDDEN_CLS,d=a.GRID_HEADER_CELL_CLS,e=a.GRID_HEADER_CELL_TRIGGER_CLS,f=a.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,g=a.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS;a.define("Fancy.grid.plugin.ColumnDrag",{extend:a.Plugin,ptype:"grid.columndrag",inWidgetName:"columndrag",activeSide:void 0,activeCell:void 0,activeIndex:void 0,activeColumn:void 0,inCell:void 0,inIndex:void 0,inSide:void 0,ok:!1,status:"none",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.on("render",function(){a.ons(),a.initHint()})},ons:function(){var a=this;a.widget.el.on("mousedown",a.onMouseDownCell,a,"div."+d)},onMouseDownCell:function(a){var c=this,e=c.widget,h=Fancy.get(a.currentTarget),i=Number(h.attr("index")),j=c.getSideByCell(h),k=e.getColumns(j),l=k[i];h.hasCls(g)||e.startResizing||(c.activeCellTopGroup||!1!==l.draggable)&&(h.hasCls(f)&&(c.activeUnderGroup=!0),c.activeSide=j,c.inSide=j,c.activeCell=h,c.inCell=h,c.activeIndex=Number(h.attr("index")),c.inIndex=c.activeIndex,c.activeColumn=k[c.activeIndex],c.mouseDownX=a.x,c.mouseDownY=a.y,b.once("mouseup",c.onMouseUp,c),b.on("mousemove",c.onMouseMove,c),e.el.on("mouseleave",c.onMouseLeave,c),e.el.on("mouseenter",c.onMouseEnterCell,c,"div."+d),e.el.on("mousemove",c.onMouseMoveCell,c,"div."+d))},onMouseLeave:function(){this.hideHint()},onMouseUp:function(){var a=this,c=a.widget,e=!1;if(b.un("mousemove",a.onMouseMove,a),c.el.un("mouseleave",a.onMouseLeave,a),c.el.un("mouseenter",a.onMouseEnterCell,a,"div."+d),c.el.un("mousemove",a.onMouseMoveCell,a,"div."+d),a.ok){if(a.inSide===a.activeSide)a.dragColumn(a.inSide);else if("center"===a.activeSide){var f=a.inIndex;"right"===a.okPosition&&f++,c.moveColumn(a.activeSide,a.inSide,a.activeIndex,f)}else{var f=a.inIndex;"right"===a.okPosition&&f++,c.moveColumn(a.activeSide,a.inSide,a.activeIndex,f)}e=!0}delete a.inUpGroupCell,delete a.inUnderGroup,delete a.activeCellTopGroup,delete a.activeUnderGroup,delete a.activeSide,delete a.activeCell,delete a.activeIndex,delete a.activeIndex,delete a.activeColumn,delete a.mouseDownX,delete a.mouseDownY,a.ok=!1,delete a.okPosition,a.tip&&(a.tip.destroy(),delete a.tip),"dragging"===a.status&&setTimeout(function(){a.status="none",e&&(c.fire("columndrag"),c.scroller.update())},10),a.hideHint()},onMouseMove:function(a){var b=this,c=b.widget,d=a.x,e=a.y,f=c.getColumns(b.activeSide);if((Math.abs(d-b.mouseDownX)>10||Math.abs(e-b.mouseDownY))&&!b.tip)b.tip=new Fancy.ToolTip({text:b.activeColumn.title,cls:"fancy-drag-cell"}),b.tip.el.css("display","block");else if(!b.tip)return;if(1===f.length&&"center"===b.activeSide)return void b.tip.destroy();b.tip.show(a.pageX+15,a.pageY+15)},onMouseEnterCell:function(a){var b=this,c=Fancy.get(a.currentTarget),d=b.getSideByCell(c);b.hideHint(),c.hasCls(f)?b.inUnderGroup=!0:delete b.inUnderGroup,c.hasCls(g)?b.inUpGroupCell=c:delete b.inUpGroupCell,b.inSide=d,b.inCell=c,b.inIndex=Number(c.attr("index"))},onMouseMoveCell:function(a){var b=this,c=b.widget,d=b.inCell,f=parseInt(d.css("width")),g=d.select("."+e),h=Fancy.get(a.target),i=g.within(h)||h.hasClass(e),j=b.activeUnderGroup!==b.inUnderGroup&&!0===b.inUnderGroup,k=b.activeUnderGroup!==b.inUnderGroup&&!0===b.activeUnderGroup;if(b.status="dragging",1===c.getColumns(b.activeSide).length&&"center"===b.activeSide)return b.ok=!1,void b.hideHint();if(b.inUpGroupCell){var l=b.getGroupStartEnd(),m=l.start,n=l.end;b.activeSide!==b.inSide?(b.ok=!0,a.offsetX>f/2||i?b.showHint("right"):b.showHint("left")):a.offsetX>f/2?b.activeIndex>n&&b.activeIndex-1===n?b.hideHint():(b.ok=!0,b.showHint("right")):b.activeIndex<m&&b.activeIndex+1===m?b.hideHint():(b.ok=!0,b.showHint("left"))}else b.activeSide!==b.inSide?(b.ok=!0,a.offsetX>f/2||i?b.showHint("right"):b.showHint("left")):b.activeIndex===b.inIndex?b.ok=!1:b.activeIndex<b.inIndex?a.offsetX>f/2||i?(b.ok=!0,b.showHint("right")):a.offsetX<f/2&&b.activeIndex+1!==b.inIndex?(b.ok=!0,b.showHint("left")):b.activeIndex+1===b.inIndex&&(j||k)?(b.ok=!0,b.showHint("left")):(b.ok=!1,b.hideHint()):b.activeIndex>b.inIndex&&(a.offsetX<f/2?i?j||k?(b.ok=!0,b.showHint("right")):b.activeIndex-1===b.inIndex||b.inUpGroupCell?(b.ok=!1,b.hideHint()):(b.ok=!0,b.showHint("right")):(b.ok=!0,b.showHint("left")):a.offsetX>f/2?b.activeIndex-1===b.inIndex&&(j||k)?(b.ok=!0,b.showHint("right")):b.activeIndex-1!==b.inIndex||b.activeUnderGroup?(b.ok=!0,b.showHint("right")):(b.ok=!1,b.hideHint()):(b.ok=!1,b.hideHint()))},showHint:function(a){var b=this,d=b.widget,e=d.cellHeaderHeight,f=b.inCell,g=b.topEl,h=b.bottomEl,i=f.offset(),j=parseInt(f.css("width")),k=parseInt(f.css("height"));b.okPosition=a,g.removeCls(c),h.removeCls(c);var l=0;"right"===a&&(l+=j),g.css({left:i.left+l-Math.ceil(parseInt(g.css("width"))/2),top:i.top-parseInt(g.css("height"))});var m=i.top+k;if(b.inUpGroupCell){var n=d.header.calcRows();m=i.top+n*e}h.css({left:i.left+l-Math.ceil(parseInt(h.css("width"))/2),top:m})},hideHint:function(){var a=this;a.topEl.addCls(c),a.bottomEl.addCls(c)},initHint:function(){var b=this,d=b.widget,e="fancy-theme-"+d.theme,f=a.get(document.body).dom,g=a.get(document.createElement("div")),h=a.get(document.createElement("div"));g.addCls("fancy-drag-hint-top",c,e),h.addCls("fancy-drag-hint-bottom",c,e),b.topEl=a.get(f.appendChild(g.dom)),b.bottomEl=a.get(f.appendChild(h.dom))},dragColumn:function(a){var b=this,c=b.widget,d=c.getHeader(a),e=c.getBody(a),f=b.activeIndex,g=b.inIndex,h=b.okPosition,i=c.getColumns(a),j=i[f],k=d.calcRows();if(b.inUpGroupCell){var l=b.getGroupStartEnd();g=l.start,"right"===h&&(g=l.end+1)}else if("right"===h)if(b.inUnderGroup){var m=i[g].grouping,n=i[g+1];n&&n.grouping===m&&g++}else g++;if(c.groupheader){var o=i[g];o&&o.grouping&&b.inUnderGroup?(j.grouping=o.grouping,j.filter&&j.filter.header&&k<3&&delete j.filter):delete j.grouping}i.splice(f,1),f<g&&g--,i.splice(g,0,j),e.clearColumnsStyles(),d.updateTitles(),d.updateCellsSizes(),c.groupheader&&(c.header.fixGroupHeaderSizing(),c.leftColumns&&c.leftHeader.fixGroupHeaderSizing(),c.rightColumns&&c.rightHeader.fixGroupHeaderSizing(),d.reSetGroupIndexes()),d.reSetColumnsAlign(),e.reSetColumnsAlign(),e.reSetColumnsCls(),e.updateColumnsSizes(),c.update()},getSideByCell:function(a){var b,c=this,d=c.widget;return d.centerEl.within(a)?b="center":d.leftEl.within(a)?b="left":d.rightEl.within(a)&&(b="right"),b},getGroupStartEnd:function(b,c){var d=this,e=d.widget,f=e.getHeader(c||d.inSide),g=(b||d.inUpGroupCell).attr("index"),h=f.el.select('[group-index="'+g+'"]'),i=[];return h.each(function(a){i.push(Number(a.attr("index")))}),{start:a.Array.min(i),end:a.Array.max(i)}}})}();