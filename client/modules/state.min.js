!function(){var a=Fancy;a.define("Fancy.grid.plugin.State",{extend:a.Plugin,ptype:"grid.state",inWidgetName:"state",constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget;b.on("beforeinit",a.onBeforeInit,a),b.on("sort",a.onSort,a),b.on("filter",a.onFilter,a),b.on("filter",a.onFilter,a),b.on("columnresize",a.onColumnResize,a),b.on("columndrag",a.onColumnDrag,a),b.on("lockcolumn",a.onColumnLock,a),b.on("rightlockcolumn",a.onColumnRightLock,a),b.on("unlockcolumn",a.onColumnUnLock,a),b.on("changepage",a.onChangePage,a)},onSort:function(){var a=this,b=a.widget,c=b.store,d=localStorage.getItem(b.id);d=d?JSON.parse(d):{},d.sorters=JSON.stringify(c.sorters),localStorage.setItem(b.id,JSON.stringify(d)),a.copyColumns()},onFilter:function(){var a=this,b=a.widget,c=b.store,d=localStorage.getItem(b.id);d=d?JSON.parse(d):{},d.filters=JSON.stringify(c.filters),localStorage.setItem(b.id,JSON.stringify(d)),a.copyColumns()},onColumnResize:function(){this.copyColumns()},onColumnDrag:function(){this.copyColumns()},onColumnLock:function(){this.copyColumns()},onColumnRightLock:function(){this.copyColumns()},onColumnUnLock:function(){this.copyColumns()},copyColumns:function(){var b=this,c=b.widget,d=localStorage.getItem(c.id);d=d?JSON.parse(d):{};var e=[].concat(c.leftColumns).concat(c.columns).concat(c.rightColumns),f=[];a.each(e,function(b){var c={};a.each(b,function(b,d){(a.isString(b)||a.isNumber(b)||a.isBoolean(b))&&(c[d]=b)}),f.push(c)}),d.columns=JSON.stringify(f),localStorage.setItem(c.id,JSON.stringify(d))},onBeforeInit:function(){var b=this,c=b.widget,d=localStorage.getItem(c.id);if(d){if(d=JSON.parse(d),d.sorters&&(d.sorters=JSON.parse(d.sorters),a.each(d.sorters,function(a){c.sort(a.key,a.dir)})),d.filters){d.filters=JSON.parse(d.filters);for(var e in d.filters){var f=d.filters[e];for(var g in f)c.addFilter(e,f[g],g)}}d.page&&c.setPage(Number(d.page)+1)}},onChangePage:function(a,b){var c=this,d=c.widget,e=localStorage.getItem(d.id);void 0!==b&&e&&d.inited&&(e=JSON.parse(e),e.page=b,localStorage.setItem(d.id,JSON.stringify(e)))}})}();