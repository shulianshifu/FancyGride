!function(){var a=Fancy;a.define("Fancy.grid.plugin.State",{extend:a.Plugin,ptype:"grid.state",inWidgetName:"state",stateful:!1,$log:{filter:!0,sort:!0,columnresize:!0,columndrag:!0,changepage:!0,columnhide:!0,resize:!0},constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.initLog(),a.ons()},ons:function(){var a=this,b=a.widget;b.on("beforeinit",a.onBeforeInit,a),a.stateful&&(a.log.sort&&b.on("sort",a.onSort,a),a.log.filter&&b.on("filter",a.onFilter,a),a.log.columnresize&&b.on("columnresize",a.onColumnResize,a),a.log.columndrag&&(b.on("columndrag",a.onColumnDrag,a),b.on("lockcolumn",a.onColumnLock,a),b.on("rightlockcolumn",a.onColumnRightLock,a),b.on("unlockcolumn",a.onColumnUnLock,a)),a.log.changepage&&b.on("changepage",a.onChangePage,a),a.log.columnhide&&(b.on("columnhide",a.onColumnHide,a),b.on("columnshow",a.onColumnShow,a)),b.on("init",function(){b.panel&&a.log.resize&&b.panel.on("resize",a.onResize,a)}))},onSort:function(){var a=this,b=a.widget,c=b.store,d=b.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e),e.sorters=JSON.stringify(c.sorters),localStorage.setItem(d,JSON.stringify(e)),a.copyColumns()},onFilter:function(){var a=this,b=a.widget,c=b.store,d=b.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e),e.filters=JSON.stringify(c.filters),localStorage.setItem(d,JSON.stringify(e)),a.copyColumns()},onColumnResize:function(){this.copyColumns()},onColumnDrag:function(){this.copyColumns()},onColumnLock:function(){this.copyColumns()},onColumnRightLock:function(){this.copyColumns()},onColumnUnLock:function(){this.copyColumns()},onColumnHide:function(){this.copyColumns()},onColumnShow:function(){this.copyColumns()},copyColumns:function(){var b=this,c=b.widget,d=c.getStateName(),e=localStorage.getItem(d)||"{}";e=JSON.parse(e);var f=[].concat(c.leftColumns).concat(c.columns).concat(c.rightColumns),g=[];a.each(f,function(b){var c={};a.each(b,function(b,d){(a.isString(b)||a.isNumber(b)||a.isBoolean(b))&&(c[d]=b)}),g.push(c)}),e.columns=JSON.stringify(g),localStorage.setItem(d,JSON.stringify(e))},onBeforeInit:function(){var b=this,c=b.widget,d=c.getStateName(),e=localStorage.getItem(d)||"{}";if(startState=b.startState,startState){if(c.store.loading)return void c.once("load",b.onBeforeInit,b);startState.filters&&setTimeout(function(){for(var a in startState.filters){var b=startState.filters[a];for(var d in b)c.addFilter(a,b[d],d)}},100),startState.sorters&&setTimeout(function(){a.each(startState.sorters,function(a){c.sort(a.key,a.dir)})},100),void 0!==startState.page&&setTimeout(function(){c.setPage(Number(startState.page)+1)},100)}if(e=JSON.parse(e),e.sorters&&(e.sorters=JSON.parse(e.sorters),a.each(e.sorters,function(a){c.sort(a.key,a.dir)})),e.filters){e.filters=JSON.parse(e.filters);for(var f in e.filters){var g=e.filters[f];for(var h in g)c.addFilter(f,g[h],h)}}e.page&&c.setPage(Number(e.page)+1),e.width&&c.setWidth(e.width),e.height&&c.setHeight(e.height)},onChangePage:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";void 0!==b&&f&&d.inited&&(f=JSON.parse(f),f.page=b,localStorage.setItem(e,JSON.stringify(f)))},onResize:function(a,b){var c=this,d=c.widget,e=d.getStateName(),f=localStorage.getItem(e)||"{}";f=JSON.parse(f),f.width=b.width,f.height=b.height,localStorage.setItem(e,JSON.stringify(f))},initLog:function(){var b=this;a.applyIf(b.log,b.$log)}})}();