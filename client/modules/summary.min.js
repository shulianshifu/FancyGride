Fancy.define("Fancy.Summary",{singleton:!0,count:function(a){return a.length},sum:function(a){var b=0,c=a.length,d=0;if(Fancy.isArray(a[0]))for(d=[];b<c;b++)for(var e=0,f=a[b].length;e<f;e++)void 0===d[e]&&(d[e]=0),d[e]+=a[b][e];else for(;b<c;b++)d+=a[b];return d},min:function(a){return Math.min.apply(this,a)},max:function(a){return Math.max.apply(this,a)}}),Fancy.define("Fancy.grid.plugin.Summary",{extend:Fancy.Plugin,ptype:"grid.summary",inWidgetName:"summary",position:"top",sumDisplayed:!0,topOffSet:0,bottomOffSet:0,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.calcOffSets()}),b.once("init",function(){a.render(),a.update(),b.on("update",function(){a.update()})}),b.on("columnresize",a.onColumnResize,a),a.sumDisplayed&&b.on("changepage",a.onChangePage,a)},render:function(){var a,b=this,c=b.widget,d=c.body,e=c.leftBody,f=c.rightBody,g=c.getCenterFullWidth(),h=c.getLeftFullWidth(),i=c.getRightFullWidth(),j="top"===b.position?"before":"after";a=b.generateRow("center"),a.css("width",c.startWidths.center),a.firstChild().css("width",g),a.css("height",c.cellHeight),a.firstChild().css("height",c.cellHeight),b.el=a,d.el[j](a.dom),h&&(a=b.generateRow("left"),a.css("width",h-2),a.firstChild().css("width",h),a.css("height",c.cellHeight),b.leftEl=a,e.el[j](a.dom)),i&&(a=b.generateRow("right"),a.css("width",i-1),a.firstChild().css("width",i),a.css("height",c.cellHeight),b.rightEl=a,f.el[j](a.dom))},generateRow:function(a){for(var b=this,c=b.widget,d=c.cellHeight,e=c.getColumns(a),f=c.getColumnsWidth(a),g=c.clsSummaryRow,h=c.clsSummaryContainer,i=Fancy.get(document.createElement("div")),j=0,k=e.length,l="";j<k;j++){l+=['<div style="width:'+e[j].width+"px;height:"+d+'px;" class="fancy-grid-cell">','<div class="fancy-grid-cell-inner"></div>',"</div>"].join("")}var m=['<div style="position: relative;" class="'+g+'">',l,"</div>"].join("");return i.update(m),i.css("width",f+"columnsWidth"),i.addClass(h),"bottom"===b.position&&i.addClass("fancy-grid-summary-row-bottom"),i},calcPlusScroll:function(){var a=this,b=a.widget;a.plusScroll=a.groups.length*b.groupRowHeight},scrollLeft:function(a){this.el.firstChild().css("left",a)},update:function(){var a=this,b=a.widget;a.updateSide("center"),b.leftColumns.length&&a.updateSide("left"),b.rightColumns.length&&a.updateSide("right")},getEl:function(a){var b=this;switch(a){case"center":return b.el;case"left":return b.leftEl;case"right":return b.rightEl;default:return b.el}},updateSide:function(a){var b=this,c=b.widget,d=c.body,e=c.store,f=c.getColumns(a),g=b.getEl(a).select(".fancy-grid-cell-inner"),h=0,i=f.length,j="data";for(b.sumDisplayed&&(j="dataView");h<i;h++){var k=f[h];if(k.summary){var l=k.index,m=e.getColumnOriginalValues(l,{smartIndexFn:k.smartIndexFn,dataProperty:j}),n="";switch(Fancy.typeOf(k.summary)){case"string":n=Fancy.Summary[k.summary](m);break;case"object":n=Fancy.Summary[k.summary.type](m),k.summary.fn&&(n=k.summary.fn(n));break;case"function":n=k.summary(m)}k.format&&(n=d.format(n,k.format)),g.item(h).update(n)}}},onColumnResize:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right")},updateSizes:function(a){for(var b=this,c=b.widget,d=b.getEl(a),e=d.select(".fancy-grid-cell"),f=c.getColumns(a),g=0,h=f.length,i=0;g<h;g++){var j=f[g],k=e.item(g);i+=j.width,k.css("width",j.width+"px")}switch(d.firstChild().css("width",i),a){case"center":b.el.css("width",c.centerEl.css("width"));break;case"left":b.leftEl.css("width",parseInt(c.leftEl.css("width"))-2);break;case"right":b.rightEl.css("width",parseInt(c.rightEl.css("width"))-1)}},calcOffSets:function(){var a=this,b=a.widget;switch(a.position){case"top":a.topOffSet=b.cellHeight;break;case"bottom":a.bottomOffSet=b.cellHeight;break;case"both":a.topOffSet=b.cellHeight,a.bottomOffSet=b.cellHeight}},removeColumn:function(a,b){var c=this;c.getEl(b).select(".fancy-grid-cell").item(a).destroy(),c.updateSizes(b)},insertColumn:function(a,b){var c=this,d=c.widget,e=d.getColumns(b),f=e[a],g=c.getEl(b),h=g.select(".fancy-grid-cell"),i=h.item(a-1),j=Fancy.get(document.createElement("div"));0===a&&(i=h.item(0)),j.css({width:f.width,height:d.cellHeight}),j.addClass(d.cellCls),j.update('<div class="fancy-grid-cell-inner"></div>'),0===a?i.before(j.dom):i.after(j.dom),c.updateSizes(b),c.updateSide(b)},onChangePage:function(){this.update()}});