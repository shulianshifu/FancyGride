!function(){var a=Fancy,b=Fancy.GRID_CELL_CLS,c=Fancy.GRID_CELL_INNER_CLS,d=Fancy.GRID_ROW_SUMMARY_CLS,e=Fancy.GRID_ROW_SUMMARY_CONTAINER_CLS,f=Fancy.GRID_ROW_SUMMARY_BOTTOM_CLS;a.define("Fancy.grid.plugin.Summary",{extend:a.Plugin,ptype:"grid.summary",inWidgetName:"summary",position:"top",sumDisplayed:!0,topOffSet:0,bottomOffSet:0,constructor:function(a){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.calcOffSets()}),b.once("init",function(){a.render(),a.update(),b.on("update",function(){a.update()}),b.on("set",function(){a.update()})}),b.on("columnresize",a.onColumnResize,a),a.sumDisplayed&&b.on("changepage",a.onChangePage,a)},render:function(){var a,b=this,c=b.widget,d=c.body,e=c.leftBody,f=c.rightBody,g=c.getCenterFullWidth(),h=c.getLeftFullWidth(),i=c.getRightFullWidth(),j="top"===b.position?"before":"after";a=b.generateRow("center"),a.css("width",c.startWidths.center),a.firstChild().css("width",g),a.css("height",c.cellHeight),a.firstChild().css("height",c.cellHeight),b.el=a,d.el[j](a.dom),h&&(a=b.generateRow("left"),a.css("width",h-2),a.firstChild().css("width",h),a.css("height",c.cellHeight),b.leftEl=a,e.el[j](a.dom)),i&&(a=b.generateRow("right"),a.css("width",i-1),a.firstChild().css("width",i),a.css("height",c.cellHeight),b.rightEl=a,f.el[j](a.dom))},generateRow:function(g){var h=this,i=h.widget,j=i.cellHeight,k=i.getColumnsWidth(g),l=a.get(document.createElement("div")),m="";a.each(i.getColumns(g),function(a){m+=['<div style="width:'+a.width+"px;height:"+j+'px;" class="'+b+'">','<div class="'+c+'"></div>',"</div>"].join("")});var n=['<div style="position: relative;" class="'+d+'">',m,"</div>"].join("");return l.update(n),l.css("width",k+"columnsWidth"),l.addCls(e),"bottom"===h.position&&l.addCls(f),l},calcPlusScroll:function(){var a=this,b=a.widget;a.plusScroll=a.groups.length*b.groupRowHeight},scrollLeft:function(a){this.el.firstChild().css("left",a)},update:function(){var a=this,b=a.widget;a.updateSide("center"),b.leftColumns.length&&a.updateSide("left"),b.rightColumns.length&&a.updateSide("right")},getEl:function(a){var b=this;switch(a){case"center":return b.el;case"left":return b.leftEl;case"right":return b.rightEl;default:return b.el}},updateSide:function(b){var d=this,e=d.widget,f=e.body,g=e.store,h=d.getEl(b).select("."+c),i="data";d.sumDisplayed&&(i="dataView"),a.each(e.getColumns(b),function(b,c){if(b.summary){var d=b.index,e=g.getColumnOriginalValues(d,{smartIndexFn:b.smartIndexFn,dataProperty:i}),j="";switch(a.typeOf(b.summary)){case"string":j=a.Array[b.summary](e);break;case"object":j=a.Array[b.summary.type](e),b.summary.fn&&(j=b.summary.fn(j));break;case"function":j=b.summary(e)}b.format&&(j=f.format(j,b.format)),h.item(c).update(j)}})},onColumnResize:function(){var a=this,b=a.widget;a.updateSizes("center"),b.leftColumns.length&&a.updateSizes("left"),b.rightColumns.length&&a.updateSizes("right")},updateSizes:function(c){var d=this,e=d.widget,f=d.getEl(c),g=f.select("."+b),h=0;switch(a.each(e.getColumns(c),function(a,b){h+=a.width,g.item(b).css("width",a.width+"px")}),f.firstChild().css("width",h),c){case"center":d.el.css("width",e.centerEl.css("width"));break;case"left":d.leftEl.css("width",parseInt(e.leftEl.css("width"))-2);break;case"right":d.rightEl.css("width",parseInt(e.rightEl.css("width"))-1)}},calcOffSets:function(){var a=this,b=a.widget;switch(a.position){case"top":a.topOffSet=b.cellHeight;break;case"bottom":a.bottomOffSet=b.cellHeight;break;case"both":a.topOffSet=b.cellHeight,a.bottomOffSet=b.cellHeight}},removeColumn:function(a,c){this.getEl(c).select("."+b).item(a).destroy(),this.updateSizes(c)},insertColumn:function(d,e){var f=this,g=f.widget,h=g.getColumns(e),i=h[d],j=f.getEl(e),k=j.select("."+b),l=k.item(d-1),m=a.get(document.createElement("div"));0===d&&(l=k.item(0)),m.css({width:i.width,height:g.cellHeight}),m.addCls(b),m.update('<div class="'+c+'"></div>'),0===d?l.before(m.dom):l.after(m.dom),f.updateSizes(e),f.updateSide(e)},onChangePage:function(){this.update()}})}();