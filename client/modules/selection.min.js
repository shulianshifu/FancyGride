!function(){var a=Fancy,b=a.FIELD_CHECKBOX_CLS,c=a.GRID_CELL_CLS,d=a.GRID_CELL_OVER_CLS,e=a.GRID_CELL_SELECTED_CLS,f=a.GRID_CELL_ACTIVE_CLS,g=a.GRID_COLUMN_CLS,h=a.GRID_COLUMN_OVER_CLS,i=a.GRID_COLUMN_SELECT_CLS,j=a.GRID_COLUMN_SELECTED_CLS,k=a.GRID_ROW_OVER_CLS,l=(a.GRID_HEADER_CLS,a.GRID_HEADER_CELL_SELECT_CLS),m=a.GRID_HEADER_CELL_TEXT_CLS;a.define("Fancy.grid.plugin.Selection",{extend:a.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,disabled:!1,selectLeafsOnly:!1,keyNavigation:!0,allowDeselect:!1,constructor:function(){this.Super("const",arguments)},init:function(){var a=this,b=a.widget;a.Super("init",arguments),b.store.isTree&&(a.memory=!0),a.memory&&a.initMemory(),a.ons()},ons:function(){var b=this,c=b.widget;c.once("render",function(){b.initTrackOver(),b.initColumnTrackOver(),b.initCellTrackOver(),b.initCellSelection(),b.initRowSelection(),b.initColumnSelection(),b.keyNavigation&&b.initNavigation(),b.initCopyKeys(),c.on("changepage",b.onChangePage,b),c.on("load",b.onLoad,b),a.nojQuery&&b.initFixTrackOver(),b.initCopyEl()}),c.on("sort",b.onSort,b),c.on("columndrag",b.onColumnDrag,b),c.on("lockcolumn",b.onColumnLock,b),c.on("rightlockcolumn",b.onColumnRightLock,b),c.on("unlockcolumn",b.onUnColumnLock,b),c.on("filter",b.onFilter,b),c.on("expand",b.onExpand,b),c.on("collapse",b.onCollapse,b),c.on("dragrows",b.onDragRows,b)},initMemory:function(){var b=this,c=b.widget;b.memory={all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{},setAll:function(){var d=c.store.filteredDataMap;if(d){b.memory.selectedLength=0;for(var e in d)b.memory.add(e);b.memory.excepted={},b.memory.all=!0,b.memory.exceptedLength=0}else a.apply(b.memory,{all:!0,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},clearAll:function(){a.apply(b.memory,{all:!1,exceptedLength:0,selectedLength:0,excepted:{},selected:{}})},add:function(a){b.row&&b.memory.clearAll(),b.memory.selected[a]||(b.memory.selected[a]=!0,b.memory.selectedLength++),!0===b.memory.excepted[a]&&(delete b.memory.excepted[a],b.memory.exceptedLength--)},remove:function(a){!0===b.memory.selected[a]&&(delete b.memory.selected[a],b.memory.selectedLength--),!0===b.memory.all&&(b.memory.excepted[a]||(b.memory.excepted[a]=!0,b.memory.exceptedLength++));var d=c.getTotal();b.memory.exceptedLength===d&&b.memory.clearAll()},has:function(a){return!!b.memory.selected[a]&&!b.memory.excepted[a]}}},initTrackOver:function(){var a=this,b=a.widget;b.on("rowenter",a.onRowEnter,a),b.on("rowleave",a.onRowLeave,a)},initCellTrackOver:function(){var a=this,b=a.widget;b.on("cellenter",a.onCellEnter,a),b.on("cellleave",a.onCellLeave,a)},initColumnTrackOver:function(){var a=this,b=a.widget;b.on("columnenter",a.onColumnEnter,a),b.on("columnleave",a.onColumnLeave,a)},onCellEnter:function(b,c){var e=this.widget;!e.cellTrackOver||e.startResizing||a.isTouch||a.get(c.cell).addCls(d)},onCellLeave:function(b,c){var e=this.widget;e.cellTrackOver&&!e.startResizing&&a.get(c.cell).removeCls(d)},onColumnEnter:function(b,c){var d=this,e=d.widget,f=e.columndrag,g=e.scroller;f&&"dragging"===f.status||a.isTouch||e.startResizing||!e.columnTrackOver||g.bottomKnobDown||g.rightKnobDown||!1===c.column.trackOver||d.keyNavigating||a.get(c.columnDom).addCls(h)},onColumnLeave:function(b,c){var d=this.widget;d.startResizing||d.columnTrackOver&&a.get(c.columnDom).removeCls(h)},onRowEnter:function(b,c){var d=this,e=d.widget,f=e.columndrag,g=e.scroller;if((!f||"dragging"!==f.status)&&!a.isTouch&&!e.startResizing&&!1!==this.enabled&&e.trackOver&&!g.bottomKnobDown&&!g.rightKnobDown&&!d.keyNavigating){var h=e.getDomRow(c.rowIndex);a.each(h,function(b){a.get(b).addCls(k)}),e.fire("rowtrackenter",c)}},onRowLeave:function(b,c){var d=this.widget;if(!d.startResizing&&!1!==this.enabled&&d.trackOver){var e=d.getDomRow(c.rowIndex);a.each(e,function(b){a.get(b).removeCls(k)}),d.fire("rowtrackleave",c)}},onChangePage:function(){this.memory||this.clearSelection()},onLoad:function(){var a=this;a.memory||a.clearSelection()},initCellSelection:function(){var a=this,b=a.widget;b.on("cellclick",a.onCellClick,a),b.on("cellmousedown",a.onCellMouseDownCells,a),b.on("cellenter",a.onCellEnterSelection,a)},initRowSelection:function(){var a=this,b=a.widget;b.checkboxRowSelection&&(a.checkboxRow=!0,setTimeout(function(){"rows"===a.selModel&&a.renderHeaderCheckBox()},1)),b.on("rowclick",a.onRowClick,a),b.on("cellmousedown",a.onCellMouseDownRows,a),b.on("cellclick",a.onCellClickRows,a),b.on("rowenter",a.onRowEnterSelection,a),b.on("columndrag",a.onColumnDrag,a)},onCellMouseDownRows:function(c,d){var g=this,h=g.widget,i=a.get(d.e.target);if(g.stopOneTick&&delete g.stopOneTick,(!g.checkOnly||a.get(d.e.target).hasClass("fancy-field-checkbox-input"))&&!g.disabled){if(g.selectLeafsOnly&&!d.data.leaf)return void(g.stopOneTick=!0);if(g.rows&&g.enabled&&(!g.checkOnly||"$selected"===d.column.index||d.column.select)){if(!g.selectLeafsOnly&&!d.data.leaf&&i.hasClass("fancy-field-checkbox-input")){var j=a.getWidget(i.parent().parent().attr("id")),k=!j.get();g.selectNodesChilds(d.id,k)}document.activeElement&&document.activeElement.blur();var l=d.e,m=l.target,n=l.ctrlKey,o=d.rowIndex,p=h.getDomRow(o);if((n||g.allowDeselect)&&h.multiSelect)a.get(p[0]).hasCls(e)?(g.domDeSelectRow(o),g.checkboxRow&&g.deSelectCheckBox(o)):(g.domSelectRow(o),g.checkboxRow&&g.selectCheckBox(o));else if("$selected"===d.column.index||d.column.select){var q=a.getWidget(a.get(d.cell).select("."+b).attr("id"));q.el.within(m)?!0===q.get()?g.domDeSelectRow(o):g.domSelectRow(o):(g.clearSelection(),g.domSelectRow(o),g.checkboxRow&&g.selectCheckBox(o))}else g.clearSelection(),g.domSelectRow(o),g.checkboxRow&&g.selectCheckBox(o);g.isMouseDown=!0,g.startRowSelection=o,a.$(document).one("mouseup",function(){delete g.isMouseDown,delete g.startCellSelection}),g.clearActiveCell(),a.get(d.cell).addCls(f),h.fire("select",g.getSelection())}}},selectCheckBox:function(d){var e=this,f=e.widget;f.el.select("."+i+" ."+c+'[index="'+d+'"] .'+b).each(function(b){a.getWidget(b.attr("id")).set(!0)}),"rows"===f.selModel&&e.updateHeaderCheckBox()},deSelectCheckBox:function(d){var e=this,f=e.widget,g=f.store,h=f.el.select("."+i+" ."+c+'[index="'+d+'"] .'+b),j=g.get(d,"id");j&&(e.memory&&e.memory.remove(j),h.each(function(b){a.getWidget(b.attr("id")).set(!1)}),e.updateHeaderCheckBox())},domSelectRow:function(b){if(this.widget.inited){var c,d=this,f=d.widget,g=f.store,h=g.get(b,"id"),i=!1;f.startResizing||(d.memory&&(f.sorting||f.filtering||d.deselectingAll||f.draggingRows||d.memory.add(h)),c=f.getDomRow(b),a.each(c,function(b){b=a.get(b),b.hasClass(e)?i=!0:b.addCls(e)}),!1===i&&f.fire("selectrow",b,f.get(b)))}},domDeSelectRow:function(b){if(this.widget.inited){var c,d=this,f=d.widget,g=f.store,h=g.get(b,"id"),i=!0;d.memory&&(f.filtering||d.deselectingAll||f.draggingRows||f.sorting||d.memory.remove(h)),c=f.getDomRow(b),a.each(c,function(b){b=a.get(b),b.hasClass(e)?b.removeCls(e):i=!1}),i&&f.fire("deselectrow",b,f.get(b))}},onColumnEnterSelection:function(b,c){var d=this,e=d.widget;if(d.columns&&!0===d.isMouseDown){var g={columnIndex:d.startColumnColumnIndex,side:d.startColumnSide},h={columnIndex:c.columnIndex,side:c.side};if(g.side===h.side){switch(g.side){case"center":d.clearSelection("right"),d.clearSelection("left");break;case"left":d.clearSelection("center"),d.clearSelection("right");break;case"right":d.clearSelection("center"),d.clearSelection("left")}d.selectColumns(g.columnIndex,h.columnIndex,g.side)}else"center"===g.side&&"right"===h.side?(d.selectColumns(g.columnIndex,e.columns.length,"center"),d.selectColumns(0,h.columnIndex,"right")):"center"===g.side&&"left"===h.side?(d.selectColumns(0,g.columnIndex,"center"),d.selectColumns(h.columnIndex,e.leftColumns.length,"left")):"left"===g.side&&"center"===h.side?(d.clearSelection("right"),d.selectColumns(g.columnIndex,e.leftColumns.length,"left"),d.selectColumns(0,h.columnIndex,"center")):"left"===g.side&&"right"===h.side?(d.selectColumns(g.columnIndex,e.leftColumns.length,"left"),d.selectColumns(0,e.columns.length,"center"),d.selectColumns(0,h.columnIndex,"right")):"right"===g.side&&"center"===h.side?(d.clearSelection("left"),d.selectColumns(0,g.columnIndex,"right"),d.selectColumns(h.columnIndex,e.columns.length,"center")):"right"===g.side&&"left"===h.side&&(d.selectColumns(0,g.columnIndex,"right"),d.selectColumns(0,e.columns.length,"center"),d.selectColumns(h.columnIndex,e.leftColumns.length,"left"));d.clearActiveCell(),a.get(c.cell).addCls(f)}},onRowEnterSelection:function(b,c){var d=this,e=d.widget;if(!e.startResizing&&!1!==d.enabled&&d.rows&&!0===d.isMouseDown&&d.mouseMoveSelection){var g=d.startRowSelection,h=c.rowIndex,i={};g>h&&(g=c.rowIndex,h=d.startRowSelection);for(var j=g,k=h+1;j<k;j++)i[j]=!0;var l=d.getSelectedRowByColumn(c.columnIndex,c.side),m={},n={};for(var o in i)!0!==l[o]&&(m[o]=!0);for(var o in l)!0!==i[o]&&(n[o]=!0);for(var o in m)d.domSelectRow(o),d.checkboxRow&&d.selectCheckBox(o);for(var o in n)d.domDeSelectRow(o),d.checkboxRow&&d.deSelectCheckBox(o);d.clearActiveCell(),a.get(c.cell).addCls(f),e.fire("select",d.getSelection())}},getSelectedRowByColumn:function(a,b){var c,d=this.widget;switch(b){case"left":c=d.leftBody;break;case"center":c=d.body;break;case"right":c=d.rightBody}var f=c.el.select("."+g+'[index="'+a+'"][grid="'+d.id+'"]'),h=f.select("."+e),i={};return h.each(function(a){i[Number(a.attr("index"))]=!0}),i},getSelectedRow:function(){var a=this.widget,b=a.body,c=b.el.select("."+e);return 0===c.length?-1:Number(c.item(0).attr("index"))},getSelectedRows:function(){var a=this.widget,b=a.body,c=b.el.select("."+g+'[index="0"][grid="'+a.id+'"]'),d=c.select("."+e),f=[];return d.each(function(a){f.push(Number(a.attr("index")))}),f},initColumnSelection:function(){var a=this,b=a.widget;a.selectedColumns=[],b.on("columnclick",a.onColumnClick,a),b.on("columnmousedown",a.onColumnMouseDown,a),b.on("columnenter",a.onColumnEnterSelection,a)},onColumnClick:function(b,c){var d=this;if(d.column&&!1!==c.column.selectable){var e=a.get(c.columnDom);d.column&&(d.selectedColumns[0]=c),d.clearSelection(),e.addCls(j),a.get(c.cell).addCls(f)}},onRowClick:function(c,d){var g=this,h=g.widget,i=d.rowIndex,j=a.get(d.e.target);if(!g.disabled&&g.row&&!1!==d&&(!g.checkOnly||"$selected"===d.column.index||d.column.select)&&(!g.selectLeafsOnly||d.data.leaf)){var k=d.column,l=!0;"action"===k.type&&k.items&&a.each(k.items,function(a){"remove"===a.action&&(l=!1)});var m=a.get(d.cell).hasClass(e);if(a.get(d.cell).addCls(f),"$selected"===d.column.index||d.column.select){var n=a.getWidget(a.get(d.cell).select("."+b).attr("id")),o=n.get();if(n.el.within(j))g.clearSelection(),!0===o?(g.selectCheckBox(i),g.domSelectRow(i)):g.deSelectCheckBox(i);else{if(g.checkOnly)return;g.clearSelection(),!0!==o?(g.selectCheckBox(i),g.domSelectRow(i)):g.deSelectCheckBox(i)}h.fire("select",g.getSelection())}else l&&(g.clearSelection(),g.allowDeselect&&m||(g.domSelectRow(i),g.selectCheckBox(i)),h.fire("select",g.getSelection()))}},onCellClickRows:function(c,d){var e=this,f=e.widget;if(!e.disabled&&e.rows&&e.enabled&&(!e.checkOnly||"$selected"===d.column.index||d.column.select)){var g=d.e,h=g.ctrlKey,i=d.rowIndex;if((h||e.allowDeselect)&&f.multiSelect);else if("$selected"===d.column.index||d.column.select){var j=a.getWidget(a.get(d.cell).select("."+b).attr("id"));!0===j.get()?e.selectCheckBox(i):e.deSelectCheckBox(i)}}},selectRow:function(d,e,f){var h=this,i=h.widget,j=i.store,k=i.leftBody,l=i.body,m=i.rightBody;if(void 0===e&&(e=!0),f=f||!1,!i.startResizing){if(!h.row&&!h.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");if(f||h.clearSelection(),e?h.domSelectRow(d):h.domDeSelectRow(d),a.each(i.columns,function(a,f){if("select"===a.type||a.select){var h=l.el.select("."+g+'[index="'+f+'"] .'+c+'[index="'+d+'"] .'+b),i=Fancy.getWidget(h.attr("id"));i&&i.set(e)}}),a.each(i.leftColumns,function(a,f){if("select"===a.type||a.select){var h=k.el.select("."+g+'[index="'+f+'"] .'+c+'[index="'+d+'"] .'+b),i=Fancy.getWidget(h.attr("id"));i&&i.set(e)}}),a.each(i.rightColumns,function(a,f){if("select"===a.type||a.select){var h=m.el.select("."+g+'[index="'+f+'"] .'+c+'[index="'+d+'"] .'+b),i=Fancy.getWidget(h.attr("id"));i&&i.set(e)}}),h.memory){var n=j.get(d,"id");n&&(!0===e||void 0===e?h.memory.add(n):h.memory.remove(n))}i.fire("select",h.getSelection())}},selectById:function(a,b,c){var d=this,e=d.widget,f=e.find("id",String(a))[0];void 0!==f?d.selectRow(f,b,c):(f=e.find("id",Number(a))[0],void 0!==f?d.selectRow(f,b,c):d.memory&&(!0===b||void 0===b?d.memory.add(a):d.memory.remove(a)))},onCellClick:function(b,c){var d=this,g=d.widget;d.cell&&(d.clearSelection(),a.get(c.cell).addCls(e,f),g.fire("select",d.getSelection()))},clearSelection:function(a){var b=this,f=b.widget;if(b.checkboxRow){var g=f.el.select("."+i+" .fancy-checkbox-on"),h={};g.each(function(a){var d=a.closest("."+c).attr("index");h[d]||(h[d]=!0,b.deSelectCheckBox(d))})}if(b.memory&&b.memory.clearAll(),a)switch(a){case"left":f.leftBody.el.select("."+e).removeCls(e),f.leftBody.el.select("."+j).removeCls(j),f.leftBody.el.select("."+d).removeCls(d);break;case"center":f.body.el.select("."+e).removeCls(e),f.body.el.select("."+j).removeCls(j),f.body.el.select("."+d).removeCls(d);break;case"right":f.rightBody.el.select("."+e).removeCls(e),f.rightBody.el.select("."+j).removeCls(j),f.rightBody.el.select("."+d).removeCls(d)}else f.el.select("."+e).removeCls(e),f.el.select("."+j).removeCls(j),f.el.select("."+d).removeCls(d);b.clearActiveCell(),f.fire("clearselect"),f.fire("select",f.getSelection())},onSort:function(){var a=this;a.clearActiveCell(),a.memory||a.clearSelection()},onCellEnterSelection:function(b,c){var d=this,e=d.widget,g=e.columndrag,h=0;if((!g||"dragging"!==g.status)&&d.cells&&!0===d.isMouseDown){d.prevCellsSelection=c.cell,d.prevCellRowIndex=c.rowIndex,d.prevCellColumnIndex=c.columnIndex,d.prevCellSide=c.side;var i={rowIndex:d.startCellRowIndex,columnIndex:d.startCellColumnIndex,side:d.startCellSide},j={rowIndex:c.rowIndex,columnIndex:c.columnIndex,side:c.side};c.rowIndex<d.startCellRowIndex&&(i.rowIndex=c.rowIndex,j.rowIndex=d.startCellRowIndex),d.startCellSide===c.side?(c.columnIndex<d.startCellColumnIndex&&(i.columnIndex=c.columnIndex,j.columnIndex=d.startCellColumnIndex),h=d.selectCells(i,j,i.side),"left"===d.startCellSide?(d.clearSelection("center"),d.clearSelection("right")):"center"===d.startCellSide?(d.clearSelection("left"),d.clearSelection("right")):"right"===d.startCellSide&&(d.clearSelection("left"),d.clearSelection("center"))):"left"===d.startCellSide?(h=d.selectCells(i,{rowIndex:c.rowIndex,columnIndex:e.leftColumns.length-1},"left"),"center"===c.side?(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},j,"center"),d.clearSelection("right")):"right"===c.side&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:e.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},j,"right"))):"center"===d.startCellSide?"left"===c.side?(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{rowIndex:j.rowIndex,columnIndex:i.columnIndex},"center"),h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{rowIndex:j.rowIndex,columnIndex:e.leftColumns.length-1},"left")):"right"===c.side&&(h+=d.selectCells({columnIndex:i.columnIndex,rowIndex:i.rowIndex},{columnIndex:e.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:j.columnIndex,rowIndex:j.rowIndex},"right")):"right"===d.startCellSide&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:i.columnIndex,rowIndex:j.rowIndex},"right"),"center"===c.side?(h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{columnIndex:e.columns.length-1,rowIndex:j.rowIndex},"center"),d.clearSelection("left")):"left"===c.side&&(h+=d.selectCells({columnIndex:0,rowIndex:i.rowIndex},{columnIndex:e.columns.length-1,rowIndex:j.rowIndex},"center"),h+=d.selectCells({columnIndex:j.columnIndex,rowIndex:i.rowIndex},{columnIndex:e.leftColumns.length-1,rowIndex:j.rowIndex},"left"))),d.endCellRowIndex=j.rowIndex,d.clearActiveCell(),a.get(c.cell).addCls(f),e.fire("select",d.getSelection())}},onColumnMouseDown:function(b,c){var d=this,e=d.widget;if(d.columns&&!1!==c.column.selectable&&d.enabled){document.activeElement&&document.activeElement.blur();var g=a.get(c.columnDom);d.isMouseDown=!0,d.startColumnColumnIndex=c.columnIndex,d.startColumnSide=c.side,d.clearSelection(),g.addCls(j),a.$(document).one("mouseup",function(){delete d.isMouseDown}),a.get(c.cell).addCls(f),e.fire("select",d.getSelection())}},onCellMouseDownCells:function(b,c){var d=this,g=d.widget;if(g.celledit&&g.celledit.hideEditor(),d.cells&&d.enabled){document.activeElement&&document.activeElement.blur();var h=a.get(c.cell);d.clearSelection(),g.el.select("."+f).removeCls(f),h.addCls(e,f),d.isMouseDown=!0,d.startCellSelection=c.cell,d.startCellRowIndex=c.rowIndex,d.startCellColumnIndex=c.columnIndex,d.startCellSide=c.side,a.$(document).one("mouseup",function(){delete d.isMouseDown,delete d.startCellSelection}),g.fire("select",d.getSelection())}},selectCells:function(a,b,c){var d,f,g,h=this,i=h.widget,j=i.body,k=i.leftBody,l=i.rightBody,m=a.rowIndex,n=b.rowIndex+1,o=h.getSelectedCells(c||"center"),p={},q={},r={};for(m=a.rowIndex,n=b.rowIndex+1;m<n;m++)for(p[m]=p[m]||{},f=a.columnIndex,g=b.columnIndex+1;f<g;f++)p[m][f]=!0;for(var s in p)if(void 0===o[s])q[s]=p[s];else for(var t in p[s])!0!==o[s][t]&&(q[s]=q[s]||{},q[s][t]=!0);for(var s in o)if(void 0===p[s])r[s]=o[s];else for(var t in o[s])!0!==p[s][t]&&(r[s]=r[s]||{},r[s][t]=!0);switch(c){case"left":d=k;break;case"center":d=j;break;case"right":d=l;break;default:d=j}for(var s in q)for(var t in q[s]){var u=d.getCell(s,t);u.addCls(e)}for(var s in r)for(var t in r[s]){var u=d.getCell(s,t);u.removeCls(e)}},getSelectedCells:function(a){for(var b=this,c=b.widget,d=c.getBody(a||"center"),f=d.el.select("."+e),g={},h=0,i=f.length;h<i;h++){var j=f.item(h),k=Number(j.parent().attr("index")),l=Number(j.attr("index"));g[l]=g[l]||{},g[l][k]=!0}return g},getNumberSelectedCells:function(){return this.widget.el.select("."+e).length},getSelectedColumns:function(a){for(var b=this.widget,c=b.getBody(a),d={},e=c.el.select("."+j),f=0,g=e.length;f<g;f++)d[e.item(f).attr("index")]=!0;return d},selectColumns:function(a,b,c){var d=this,e=d.getSelectedColumns(c||"center"),f={},g={},h={},i=a,j=b;for(j<i&&(i=b,j=a),j++;i<j;i++)f[i]=!0;for(var k in f)!0!==e[k]&&(g[k]=!0);for(var k in e)!0!==f[k]&&(h[k]=!0);for(var k in g)d.selectColumn(k,c);for(var k in h)d.deselectColumn(k,c)},selectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).addCls(j)},deselectColumn:function(b,c){var d=this.widget,e=d.getBody(c||"center");a.get(e.getDomColumn(b)).removeCls(j)},getSelection:function(b){var c,d=this,e=d.widget,f=e.store,g={};switch(d.selModel){case"row":g.row=d.getSelectedRow(),-1!==g.row?(g.items=[f.get(g.row)],g.rows=[g.row]):(g.items=[],g.rows=[]);break;case"rows":if(g.rows=d.getSelectedRows(),d.memory&&d.memory.all)c=d.memory.excepted,f.filteredDataMap?g.items=Fancy.Array.copy(f.filteredData):g.items=Fancy.Array.copy(f.data);else if(g.items=[],d.memory&&!Fancy.Object.isEmpty(d.memory.selected)){var h=d.memory.selected;if(f.filteredDataMap)for(var i in h)f.filteredDataMap[i]&&g.items.push(f.getById(i));else for(var i in h)g.items.push(f.getById(i))}else for(var j=0,k=g.rows.length;j<k;j++)g.items.push(f.get(g.rows[j]));break;case"cells":case"cell":g.items=d.getSelectedData()}if(c){var l=[];a.each(g.items,function(b,d){a.isObject(b.data)&&(g.items[d]=b.data);var e=g.items[d].id;c[e]||l.push(g.items[d])}),g.items=l}else a.each(g.items,function(b,c){b&&a.isObject(b.data)&&(g.items[c]=b.data)});return b?g:g.items||[]},renderHeaderCheckBox:function(){var a=this,b=this.widget;b.header&&(a._renderHeaderCheckBox(b.leftHeader,b.leftColumns),a._renderHeaderCheckBox(b.header,b.columns),a._renderHeaderCheckBox(b.rightHeader,b.rightColumns))},_renderHeaderCheckBox:function(c,d){var e=this,f=e.widget,g=e.memory,h=f.getSelection();a.each(d,function(d,i){if(("$selected"===d.index||d.select)&&!1!==d.headerCheckBox){var j=c.getCell(i);j.addCls(l);var k=j.firstChild(),n=!e.disabled,o=j.select("."+m);if(d.select?o.update(d.title||""):o.update(""),k.select("."+b).length){a.getWidget(k.select("."+b).item(0).attr("id")).destroy()}var p=!1;e.memory?g.all&&(p=!0):h.length===f.getViewTotal()&&0!==h.length&&(p=!0),d.headerCheckBox=new a.CheckBox({renderTo:k.dom,renderBefore:d.select?o:void 0,renderId:!0,value:p,label:!1,editable:n,disabled:e.disabled,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){b?(g&&g.setAll(),e.selectAll()):(g&&g.clearAll(),e.deSelectAll()),e.updateHeaderCheckBox()}}]})}})},selectAll:function(){var d=this,e=d.widget,f=e.el.select("."+l+" ."+b),g=0,h=e.getViewTotal();for(d.selectingAll=!0;g<h;g++){for(var j=e.el.select("."+i+" ."+c+'[index="'+g+'"] .'+b),k=0,m=j.length;k<m;k++){a.getWidget(j.item(k).attr("id")).setValue(!0)}d.domSelectRow(g)}f.each(function(b){a.getWidget(b.attr("id")).setValue(!0,!1)}),e.fire("select",e.getSelection()),setTimeout(function(){delete d.selectingAll},1)},deSelectAll:function(){var d=this,e=d.widget,f=0,g=e.getViewTotal();for(d.deselectingAll=!0;f<g;f++){e.el.select("."+i+" ."+c+'[index="'+f+'"] .'+b).each(function(b){a.getWidget(b.attr("id")).setValue(!1)}),d.domDeSelectRow(f)}d.updateHeaderCheckBox(),e.fire("clearselect"),e.fire("select",e.getSelection()),delete d.deselectingAll},updateHeaderCheckBox:function(){var c=this,d=c.widget,e=d.getTotal();d.el.select("."+l+" ."+b).each(function(b){var d=a.getWidget(b.attr("id"));c.memory?c.memory.selectedLength>0||c.memory.all?c.memory.selectedLength===e?(d.setValue(!0,!1),d.setMiddle(!1)):c.memory.all&&0===c.memory.exceptedLength?(d.setValue(!0,!1),d.setMiddle(!1)):(d.setMiddle(!0),d.setValue(!1,!1)):(d.setMiddle(!1),d.setValue(!1,!1)):c.selectingAll?d.setValue(!0,!1):d.setValue(!1,!1)})},stopSelection:function(){this.enabled=!1},enableSelection:function(a){var b=this;if(!0===b.disabled&&b.enableHeaderCheckBoxes(),b.disabled=!1,b.disabled=!1,void 0!==a)return void(this.enabled=a);this.enabled=!0},initFixTrackOver:function(){var a=this,b=a.widget;b.columns&&(b.body.el.on("mouseleave",a.onBodyMouseLeave,a),b.body.el.on("mouseenter",a.onBodyMouseEnter,a)),b.leftColumns&&(b.leftBody.el.on("mouseleave",a.onLeftBodyMouseLeave,a),b.leftBody.el.on("mouseenter",a.onLeftBodyMouseEnter,a)),b.rightColumns&&(b.rightBody.el.on("mouseleave",a.onRightBodyMouseLeave,a),b.rightBody.el.on("mouseenter",a.onRightBodyMouseEnter,a))},onBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.body)},onBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onLeftBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.leftBody)},onLeftBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},onRightBodyMouseLeave:function(){var a=this,b=a.widget;a.clearBodyTrackCls(b.rightBody)},onRightBodyMouseEnter:function(){var a=this;a.rowTrackFixInBody=!0,setTimeout(function(){a.rowTrackFixInBody=!1},30)},clearBodyTrackCls:function(a){var b=this,c=b.widget;c.cellTrackOver&&a.el.select("."+d).removeCls(d),c.trackOver&&(delete a.prevCellOver,b.rowTrackFixInterval&&(clearInterval(b.rowTrackFixInterval),delete b.rowTrackFixInterval),b.rowTrackFixInterval=setTimeout(function(){b.rowTrackFixInBody||c.el.select("."+k).removeCls(k)},20))},onColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)},100)},onColumnRightLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();setTimeout(function(){b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)})},100)},onUnColumnLock:function(){var b,c=this,d=c.widget;if(c.cells||c.cell||c.column||c.columns)return void c.clearSelection();setTimeout(function(){b=c.getSelection(!0),a.each(b.rows,function(a){d.selectRow(a,!0,"rows"===d.selModel)})},100)},disableSelection:function(){var a=this;a.disabled=!0,a.enableHeaderCheckBoxes(!1)},enableHeaderCheckBoxes:function(c){var d=this,e=d.widget,f=e.body,h=e.leftBody,i=e.rightBody,j="enable";!1===c&&(j="disable"),a.each(e.columns,function(c,d){"select"===c.type&&c.headerCheckBox&&(c.headerCheckBox[j](),f.el.select("."+g+'[index="'+d+'"] .'+b).each(function(b){a.getWidget(b.attr("id"))[j]()}))}),a.each(e.leftColumns,function(c,d){"select"===c.type&&c.headerCheckBox&&(c.headerCheckBox[j](),h.el.select("."+g+'[index="'+d+'"] .'+b).each(function(b){a.getWidget(b.attr("id"))[j]()}))}),a.each(e.rightColumns,function(c,d){"select"===c.type&&c.headerCheckBox&&(c.headerCheckBox[j](),i.el.select("."+g+'[index="'+d+'"] .'+b).each(function(b){a.getWidget(b.attr("id"))[j]()}))})},onFilter:function(){var b=this,c=b.widget;b.clearActiveCell(),b.memory||b.clearSelection(),"rows"===b.selModel&&(a.each(c.leftColumns,function(d,e){if("select"===d.type){var f=c.leftHeader.getCell(e),g=a.getWidget(f.select(".fancy-field-checkbox").attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}),a.each(c.columns,function(d,e){if("select"===d.type){var f=c.header.getCell(e),g=a.getWidget(f.select(".fancy-field-checkbox").attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}),a.each(c.rightColumns,function(d,e){if("select"===d.type){var f=c.rightHeader.getCell(e),g=a.getWidget(f.select(".fancy-field-checkbox").attr("id"));g&&(b.memory&&b.memory.all||g.set(!1,!1))}}))},onExpand:function(){var a=this;a.clearActiveCell(),a.memory||a.clearSelection()},onCollapse:function(){var a=this;a.clearActiveCell(),a.memory||a.clearSelection()},getActiveCell:function(){var a=this,b=a.widget,c=b.el.select("."+f);return c.dom||(c=b.el.select("."+e).item(0),c.dom||(c=b.body.getCell(0,0))),c},getActiveCellInfo:function(){var a=this,b=a.widget,c=a.getActiveCell();return{side:b.getSideByCell(c),rowIndex:Number(c.attr("index")),columnIndex:Number(c.parent().attr("index"))}},clearActiveCell:function(){this.widget.el.select("."+f).removeCls(f)},initCopyEl:function(){var b=this,c=b.widget,d=a.get(document.createElement("textarea"));d.addCls("fancy-grid-copy-textarea"),b.copyEl=a.get(c.el.dom.appendChild(d.dom))},copy:function(b){var c,d=this,e=d.widget,f=d.copyEl;switch(d.selModel){case"cells":case"cell":var g=d.getSelectedData(b),h="";a.each(g,function(a){h+=a.join("\t")+"\n"}),f.dom.value=h;break;case"rows":case"row":c=d.getSelection();var i=[].concat(e.leftColumns).concat(e.columns).concat(e.rightColumns),h="";if(b){var j=[];a.each(i,function(a){switch(a.index){case"$selected":case"$rowdrag":return}j.push(a.index||"")}),h+=j.join("\t")+"\n"}a.each(c,function(b){var c=[];a.each(i,function(a){switch(a.index){case"$selected":case"$rowdrag":return}a.index&&c.push(b[a.index])}),h+=c.join("\t")+"\n"}),f.dom.value=h;break;case"columns":case"column":var g=[],k=e.getDataView(),l=function(c){var f=e.getColumns(c),h=d.getSelectedColumns(c);for(var i in h){var j=f[i];b&&(g.push([]),g[0].push(j.title||"")),j.index&&a.each(k,function(a,c){b&&c++,void 0===g[c]&&(g[c]=[]),g[c].push(a[j.index])})}};e.leftColumns&&l("left"),e.columns&&l("center"),e.rightColumns&&l("right");var h="";a.each(g,function(a){h+=a.join("\t")+"\n"}),f.dom.value=h}f.dom.select(),f.dom.focus(),document.execCommand("copy")},initCopyKeys:function(){var a=this;Fancy.get(document).on("keydown",a.onKeyDownCopy,a)},onKeyDownCopy:function(a){var b=this,c=b.widget,d=a.keyCode,e=Fancy.key;if(!1!==c.activated&&a.ctrlKey)switch(d){case e.C:if(c.celledit&&c.celledit.activeEditor)return;if(c.textSelection)return;b.copy();break;case e.V:}},onColumnDrag:function(){var a=this;setTimeout(function(){a.renderHeaderCheckBox()},100)},disableSelectionMove:function(){this.mouseMoveSelection=!1},getSelectedData:function(a){var b=this,c=b.widget,d=[],e=function(e){var f=c.getColumns(e),g=b.getSelectedCells(e),h=0,i=!1;for(var j in g){var k=c.get(j),l=g[j];if(!i&&a){d.push([]);for(var m in l){var n=f[m];n.index,d[0].push(n.title||"")}h++,i=!0}for(var m in l){var n=f[m];d[h]||(d[h]=[]),n.index&&d[h].push(k.get(n.index))}h++}};return e("left"),e("center"),e("right"),d},selectNodesChilds:function(b,c){var d=this,e=d.widget,f=e.getById(b);!1===c&&d.memory&&d.memory.remove(b),f.set("$selected",c);var g=function(f){a.each(f,function(a,f){if(a.$selected=c,!a.id)return!0;var h=e.getRowById(a.id);void 0!==h&&e.selectRow(h,c,!0),!1===c&&d.memory&&d.memory.remove(b),a.data&&a.data.child&&g(a.data.child)})};g(f.data.child)},clearOverCells:function(){this.widget.el.select("."+d).removeCls(d)},onDragRows:function(){this.clearActiveCell()}})}(),function(){var a=Fancy,b=a.GRID_CELL_ACTIVE_CLS,c=a.GRID_CELL_SELECTED_CLS;a.Mixin("Fancy.grid.selection.mixin.Navigation",{initNavigation:function(){this.addEvents("up","down","left","right"),this.onsNav()},onsNav:function(){var a=this;Fancy.get(document).on("keydown",a.onKeyDown,a)},onKeyDown:function(b){var c=this,d=c.widget,e=b.keyCode,f=Fancy.key;if(!1!==d.activated){if(!c.keyNavigating){a.get(document).once("keyup",function(){delete c.keyNavigating})}switch(e){case f.TAB:break;case f.UP:c.keyNavigating=!0,b.preventDefault(),c.moveUp();break;case f.DOWN:c.keyNavigating=!0,b.preventDefault(),c.moveDown();break;case f.LEFT:c.keyNavigating=!0,b.preventDefault(),c.moveLeft();break;case f.RIGHT:c.keyNavigating=!0,b.preventDefault(),c.moveRight();break;case f.PAGE_UP:b.preventDefault(),c.scrollPageUP();break;case f.PAGE_DOWN:b.preventDefault(),c.scrollPageDOWN()}}},moveRight:function(){var a,d=this,e=d.widget,f=d.getActiveCellInfo(),g=e.getBody(f.side);if(f.columnIndex++,a=g.getCell(f.rowIndex,f.columnIndex),!a.dom)switch(f.side){case"left":e.columns&&(f.columnIndex=0,g=e.getBody("center"),f.side="center",a=g.getCell(f.rowIndex,f.columnIndex));break;case"center":e.rightColumns&&e.rightColumns.length&&(f.columnIndex=0,g=e.getBody("right"),f.side="right",a=g.getCell(f.rowIndex,f.columnIndex));break;case"right":return}if(a.dom){switch(f.side){case"left":var h=e.leftColumns[f.columnIndex];if(h.hidden){for(var i=f.columnIndex,j=e.leftColumns.length,k=!1;i<j;i++)if(h=e.leftColumns[i],!h.hidden){k=!0,f.columnIndex=i;break}if(!k){f.columnIndex--;for(var i=f.columnIndex,j=e.columns.length,k=!1;i<j;i++)if(h=e.columns[i],!h.hidden){k=!0,f.columnIndex=i;break}k&&(f.side="center",g=e.getBody(f.side))}a=g.getCell(f.rowIndex,f.columnIndex)}break;case"center":var h=e.columns[f.columnIndex];if(h.hidden){for(var i=f.columnIndex,j=e.columns.length,k=!1;i<j;i++)if(h=e.columns[i],!h.hidden){k=!0,f.columnIndex=i;break}k||f.columnIndex--,a=g.getCell(f.rowIndex,f.columnIndex)}break;case"right":var h=e.rightColumns[f.columnIndex];if(h.hidden){for(var i=f.columnIndex,j=e.rightColumns.length,k=!1;i<j;i++)if(h=e.rightColumns[i],!h.hidden){k=!0,f.columnIndex=i;break}k||f.columnIndex--,a=g.getCell(f.rowIndex,f.columnIndex)}}switch(d.selModel){case"cell":case"cells":d.clearSelection(),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0);break;case"column":case"columns":d.clearSelection(),d.selectColumn(f.columnIndex,f.side),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0)}}},moveLeft:function(){var a,d,e=this,f=e.widget,g=e.getActiveCellInfo(),h=f.getBody(g.side);if(--g.columnIndex<0)switch(g.side){case"left":return;case"center":if(!f.leftColumns||!f.leftColumns.length)return;g.columnIndex=f.leftColumns.length-1,h=f.getBody("left"),g.side="left",a=h.getCell(g.rowIndex,g.columnIndex);var i=f.leftColumns[g.columnIndex];if(i.hidden)for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}a=h.getCell(g.rowIndex,g.columnIndex);break;case"right":f.columns&&f.columns.length&&(g.columnIndex=f.columns.length-1,h=f.getBody("center"),g.side="center",a=h.getCell(g.rowIndex,g.columnIndex))}else{switch(g.side){case"left":var i=f.leftColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}k||g.columnIndex++}break;case"center":var i=f.columns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.columns[j],!i.hidden){k=!0,g.columnIndex=j;break}if(!k&&(g.columnIndex++,f.leftColumns)){for(var j=f.leftColumns.length-1,k=!1;j>=0;j--)if(i=f.leftColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}k&&(d="left",h=f.getBody(d))}}break;case"right":var i=f.rightColumns[g.columnIndex];if(i.hidden){for(var j=g.columnIndex-1,k=!1;j>=0;j--)if(i=f.rightColumns[j],!i.hidden){k=!0,g.columnIndex=j;break}if(!k){g.columnIndex++;var j=f.columns.length-1,k=!1;for(d="center",h=f.getBody(d);j>=0;j--)if(i=f.columns[j],!i.hidden){k=!0,g.columnIndex=j;break}}}}a=h.getCell(g.rowIndex,g.columnIndex)}if(a.dom)switch(e.selModel){case"cell":case"cells":e.clearSelection(),a.addCls(b,c),f.scroller.scrollToCell(a.dom,!0);break;case"column":case"columns":e.clearSelection(),e.selectColumn(g.columnIndex,g.side),a.addCls(b,c),f.scroller.scrollToCell(a.dom,!0)}},moveUp:function(){var a,d=this,e=d.widget,f=d.getActiveCellInfo(),g=e.getBody(f.side);if(!(--f.rowIndex<0)&&(a=g.getCell(f.rowIndex,f.columnIndex),a.dom))switch(d.selModel){case"cell":case"cells":d.clearSelection(),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0);break;case"row":case"rows":d.clearSelection(),d.selectRow(f.rowIndex),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0),"rows"===d.selModel&&d.updateHeaderCheckBox()}},moveDown:function(){var a,d=this,e=d.widget,f=d.getActiveCellInfo(),g=e.getBody(f.side);if(f.rowIndex++,a=g.getCell(f.rowIndex,f.columnIndex),a.dom)switch(d.selModel){case"cell":case"cells":d.clearSelection(),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0);break;case"row":case"rows":d.clearSelection(),d.selectRow(f.rowIndex),a.addCls(b,c),e.scroller.scrollToCell(a.dom,!0),"rows"===d.selModel&&d.updateHeaderCheckBox()}},scrollPageUP:function(){var a=this,b=a.widget,c=parseInt(b.body.el.height()),d=b.scroller,e=d.scrollTop-c;e<0&&(e=0),b.scroll(e)},scrollPageDOWN:function(){var a=this,b=a.widget,c=b.gridBorders,d=b.getBodyHeight()-c[0]-c[2],e=b.getCellsViewHeight()-c[0]-c[2],f=b.scroller,g=f.scrollTop+d;g>e-d&&(g=e-d),b.scroll(g)}})}();