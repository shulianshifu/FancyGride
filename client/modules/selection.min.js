!function(){var a=Fancy.FIELD_CHECKBOX_CLS,b=Fancy.GRID_CELL_CLS,c=Fancy.GRID_CELL_OVER_CLS,d=Fancy.GRID_CELL_SELECTED_CLS,e=Fancy.GRID_COLUMN_CLS,f=Fancy.GRID_COLUMN_OVER_CLS,g=Fancy.GRID_COLUMN_SELECT_CLS,h=Fancy.GRID_COLUMN_SELECTED_CLS,i=Fancy.GRID_ROW_OVER_CLS;Fancy.define("Fancy.grid.plugin.Selection",{extend:Fancy.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,checkOnly:!1,memory:!1,constructor:function(a){this.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.memory&&a.initMemory(),a.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.initTrackOver(),a.initColumnTrackOver(),a.initCellTrackOver(),a.initCellSelection(),a.initRowSelection(),a.initColumnSelection(),b.keyNavigation&&a.initNavigation(),b.on("changepage",a.onChangePage,a)}),b.on("sort",a.onSort,a)},initMemory:function(){var a=this;a.memory={all:!1,except:{},selected:{},setAll:function(){Fancy.apply(a.memory,{all:!0,except:{},selected:{}})},clearAll:function(){Fancy.apply(a.memory,{all:!1,except:{},selected:{}})}}},initTrackOver:function(){var a=this,b=a.widget;b.on("rowenter",a.onRowEnter,a),b.on("rowleave",a.onRowLeave,a)},initCellTrackOver:function(){var a=this,b=a.widget;b.on("cellenter",a.onCellEnter,a),b.on("cellleave",a.onCellLeave,a)},initColumnTrackOver:function(){var a=this,b=a.widget;b.on("columnenter",a.onColumnEnter,a),b.on("columnleave",a.onColumnLeave,a)},onCellEnter:function(a,b){this.widget.cellTrackOver&&Fancy.get(b.cell).addCls(c)},onCellLeave:function(a,b){this.widget.cellTrackOver&&Fancy.get(b.cell).removeCls(c)},onColumnEnter:function(a,b){var c=this,d=c.widget,e=d.scroller;!d.columnTrackOver||e.bottomKnobDown||e.rightKnobDown||!1===b.column.trackOver||Fancy.get(b.columnDom).addCls(f)},onColumnLeave:function(a,b){this.widget.columnTrackOver&&Fancy.get(b.columnDom).removeCls(f)},onRowEnter:function(a,b){var c=this,d=c.widget,e=d.scroller;if(!1!==c.enabled&&d.trackOver&&!e.bottomKnobDown&&!e.rightKnobDown){var f=d.getDomRow(b.rowIndex);Fancy.each(f,function(a){Fancy.get(a).addCls(i)}),d.fire("rowtrackenter",b)}},onRowLeave:function(a,b){var c=this,d=c.widget;if(!1!==c.enabled&&d.trackOver){var e=d.getDomRow(b.rowIndex);Fancy.each(e,function(a){Fancy.get(a).removeCls(i)}),d.fire("rowtrackleave",b)}},onChangePage:function(){this.memory||this.clearSelection()},initCellSelection:function(){var a=this,b=a.widget;b.on("cellclick",a.onCellClick,a),b.on("cellmousedown",a.onCellMouseDownCells,a),b.on("cellenter",a.onCellEnterSelection,a)},initRowSelection:function(){var a=this,b=a.widget;b.checkboxRowSelection&&(a.checkboxRow=!0,setTimeout(function(){"rows"===a.selModel&&a.renderHeaderCheckBox()},1)),b.on("rowclick",a.onRowClick,a),b.on("cellmousedown",a.onCellMouseDownRows,a),b.on("cellclick",a.onCellClickRows,a),b.on("rowenter",a.onRowEnterSelection,a)},onCellMouseDownRows:function(b,c){var e=this,f=e.widget;if(e.rows&&e.enabled&&(!e.checkOnly||"$selected"===c.column.index)){var g=c.e,h=g.target,i=g.ctrlKey,j=c.rowIndex,k=f.getDomRow(j);if(i&&f.multiSelect)Fancy.get(k[0]).hasCls(d)?(e.domDeSelectRow(j),e.checkboxRow&&e.deSelectCheckBox(j)):(e.domSelectRow(j),e.checkboxRow&&e.selectCheckBox(j));else if("$selected"===c.column.index){var l=Fancy.getWidget(Fancy.get(c.cell).select("."+a).attr("id"));l.el.within(h)?(e.domSelectRow(j),!0===l.get()?e.domDeSelectRow(j):e.domSelectRow(j)):(e.clearSelection(),e.domSelectRow(j),e.checkboxRow&&e.selectCheckBox(j))}else e.clearSelection(),e.domSelectRow(j),e.checkboxRow&&e.selectCheckBox(j);e.isMouseDown=!0,e.startRowSelection=j,Fancy.$(document).one("mouseup",function(){delete e.isMouseDown,delete e.startCellSelection}),f.fire("select")}},selectCheckBox:function(c){var d=this,e=d.widget;e.el.select("."+g+" ."+b+'[index="'+c+'"] .'+a).each(function(a){Fancy.getWidget(a.attr("id")).set(!0)}),"rows"===e.selModel&&d.clearHeaderCheckBox()},deSelectCheckBox:function(c){var d=this,e=d.widget,f=e.store,h=e.el.select("."+g+" ."+b+'[index="'+c+'"] .'+a),i=f.get(c,"id");i&&(d.memory&&(d.memory.except[i]=!0,delete d.memory.selected[i]),h.each(function(a){Fancy.getWidget(a.attr("id")).set(!1)}),d.clearHeaderCheckBox())},domSelectRow:function(a){var b=this,c=b.widget,e=c.store,f=c.getDomRow(a),g=e.get(a,"id");b.memory&&(delete b.memory.except[g],b.memory.selected[g]=!0),Fancy.each(f,function(a){Fancy.get(a).addCls(d)})},domDeSelectRow:function(a){var b=this,c=b.widget,e=c.getDomRow(a);Fancy.each(e,function(a){Fancy.get(a).removeCls(d)})},onColumnEnterSelection:function(a,b){var c=this,d=c.widget;if(c.columns&&!0===c.isMouseDown){var e={columnIndex:c.startColumnColumnIndex,side:c.startColumnSide},f={columnIndex:b.columnIndex,side:b.side};if(e.side===f.side){switch(e.side){case"center":c.clearSelection("right"),c.clearSelection("left");break;case"left":c.clearSelection("center"),c.clearSelection("right");break;case"right":c.clearSelection("center"),c.clearSelection("left")}c.selectColumns(e.columnIndex,f.columnIndex,e.side)}else"center"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"center"===e.side&&"left"===f.side?(c.selectColumns(0,e.columnIndex,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left")):"left"===e.side&&"center"===f.side?(c.clearSelection("right"),c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,f.columnIndex,"center")):"left"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"right"===e.side&&"center"===f.side?(c.clearSelection("left"),c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(f.columnIndex,d.columns.length,"center")):"right"===e.side&&"left"===f.side&&(c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left"))}},onRowEnterSelection:function(a,b){var c=this,d=c.widget;if(!1!==c.enabled&&c.rows&&!0===c.isMouseDown){var e=c.startRowSelection,f=b.rowIndex,g={};e>f&&(e=b.rowIndex,f=c.startRowSelection);for(var h=e,i=f+1;h<i;h++)g[h]=!0;var j=c.getSelectedRowByColumn(b.columnIndex,b.side),k={},l={};for(var m in g)!0!==j[m]&&(k[m]=!0);for(var m in j)!0!==g[m]&&(l[m]=!0);for(var m in k)c.domSelectRow(m),c.checkboxRow&&c.selectCheckBox(m);for(var m in l)c.domDeSelectRow(m),c.checkboxRow&&c.deSelectCheckBox(m);d.fire("select")}},getSelectedRowByColumn:function(a,b){var c,f=this,g=f.widget;switch(b){case"left":c=g.leftBody;break;case"center":c=g.body;break;case"right":c=g.rightBody}var h=c.el.select("."+e+'[index="'+a+'"][grid="'+g.id+'"]'),i=h.select("."+d),j={};return i.each(function(a){j[Number(a.attr("index"))]=!0}),j},getSelectedRow:function(){var a=this,b=a.widget,c=b.body,e=c.el.select("."+d);return 0===e.length?-1:Number(e.item(0).attr("index"))},getSelectedRows:function(){var a=this,b=a.widget,c=b.body,f=c.el.select("."+e+'[index="0"][grid="'+b.id+'"]'),g=f.select("."+d),h=[];return g.each(function(a){h.push(Number(a.attr("index")))}),h},initColumnSelection:function(){var a=this,b=a.widget;a.selectedColumns=[],b.on("columnclick",a.onColumnClick,a),b.on("columnmousedown",a.onColumnMouseDown,a),b.on("columnenter",a.onColumnEnterSelection,a)},onColumnClick:function(a,b){var c=this;c.widget;if(c.column&&!1!==b.column.selectable){var d=Fancy.get(b.columnDom);c.column&&(c.selectedColumns[0]=b),c.clearSelection(),d.addCls(h)}},onRowClick:function(b,c){var e=this,f=e.widget,g=c.rowIndex;if(e.row&&!1!==c&&(!e.checkOnly||"$selected"===c.column.index)){var h=c.column,i=!0;"action"===h.type&&h.items&&Fancy.each(h.items,function(a){"remove"===a.action&&(i=!1)}),e.clearSelection();var j=f.getDomRow(g);if("$selected"===c.column.index){!0===Fancy.getWidget(Fancy.get(c.cell).select("."+a).attr("id")).get()?(e.selectCheckBox(g),Fancy.each(j,function(a){Fancy.get(a).addCls(d)})):e.deSelectCheckBox(g)}else i&&(Fancy.each(j,function(a){Fancy.get(a).addCls(d)}),e.selectCheckBox(g),f.fire("select"))}},onCellClickRows:function(b,c){var d=this,e=d.widget;if(d.rows&&d.enabled&&(!d.checkOnly||"$selected"===c.column.index)){var f=c.e,g=f.ctrlKey,h=c.rowIndex;if(g&&e.multiSelect);else if("$selected"===c.column.index){var i=Fancy.getWidget(Fancy.get(c.cell).select("."+a).attr("id"));!0===i.get()?d.selectCheckBox(h):d.deSelectCheckBox(h)}}},selectRow:function(a){var b=this,c=b.widget;if(!b.row&&!b.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");b.clearSelection();var e=c.getDomRow(a);Fancy.each(e,function(a){Fancy.get(a).addCls(d)}),c.fire("select")},onCellClick:function(a,b){var c=this,e=c.widget;c.cell&&(c.clearSelection(),Fancy.get(b.cell).addCls(d),e.fire("select"))},clearSelection:function(a){var b=this,f=b.widget;if(b.checkboxRow){f.body.el.select("."+e+'[index="0"] .'+d).each(function(a){var c=a.attr("index");b.deSelectCheckBox(c)}),b.memory&&b.memory.clearAll()}if(a)switch(a){case"left":f.leftBody.el.select("."+d).removeCls(d),f.leftBody.el.select("."+h).removeCls(h),f.leftBody.el.select("."+c).removeCls(c);break;case"center":f.body.el.select("."+d).removeCls(d),f.body.el.select("."+h).removeCls(h),f.body.el.select("."+c).removeCls(c);break;case"right":f.rightBody.el.select("."+d).removeCls(d),f.rightBody.el.select("."+h).removeCls(h),f.rightBody.el.select("."+c).removeCls(c)}else f.el.select("."+d).removeCls(d),f.el.select("."+h).removeCls(h),f.el.select("."+c).removeCls(c);f.fire("clearselect")},onSort:function(){var a=this;a.memory||a.clearSelection()},onCellEnterSelection:function(a,b){var c=this,d=c.widget,e=0;if(c.cells&&!0===c.isMouseDown){c.prevCellsSelection=b.cell,c.prevCellRowIndex=b.rowIndex,c.prevCellColumnIndex=b.columnIndex,c.prevCellSide=b.side;var f={rowIndex:c.startCellRowIndex,columnIndex:c.startCellColumnIndex,side:c.startCellSide},g={rowIndex:b.rowIndex,columnIndex:b.columnIndex,side:b.side};b.rowIndex<c.startCellRowIndex&&(f.rowIndex=b.rowIndex,g.rowIndex=c.startCellRowIndex),c.startCellSide===b.side?(b.columnIndex<c.startCellColumnIndex&&(f.columnIndex=b.columnIndex,g.columnIndex=c.startCellColumnIndex),e=c.selectCells(f,g,f.side),"left"===c.startCellSide?(c.clearSelection("center"),c.clearSelection("right")):"center"===c.startCellSide?(c.clearSelection("left"),c.clearSelection("right")):"right"===c.startCellSide&&(c.clearSelection("left"),c.clearSelection("center"))):"left"===c.startCellSide?(e=c.selectCells(f,{rowIndex:b.rowIndex,columnIndex:d.leftColumns.length-1},"left"),"center"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"center"),c.clearSelection("right")):"right"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"right"))):"center"===c.startCellSide?"left"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:f.columnIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:d.leftColumns.length-1},"left")):"right"===b.side&&(e+=c.selectCells({columnIndex:f.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:g.columnIndex,rowIndex:g.rowIndex},"right")):"right"===c.startCellSide&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:f.columnIndex,rowIndex:g.rowIndex},"right"),"center"===b.side?(e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),c.clearSelection("left")):"left"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.leftColumns.length-1,rowIndex:g.rowIndex},"left"))),c.endCellRowIndex=g.rowIndex,d.fire("select")}},onColumnMouseDown:function(a,b){var c=this,d=c.widget;if(c.columns&&!1!==b.column.selectable&&c.enabled){var e=Fancy.get(b.columnDom);c.isMouseDown=!0,c.startColumnColumnIndex=b.columnIndex,c.startColumnSide=b.side,c.clearSelection(),e.addCls(h),Fancy.$(document).one("mouseup",function(){delete c.isMouseDown}),d.fire("select")}},onCellMouseDownCells:function(a,b){var c=this,e=c.widget;if(e.celledit&&e.celledit.hideEditor(),c.cells&&c.enabled){var f=Fancy.get(b.cell);c.clearSelection(),f.addCls(d),c.isMouseDown=!0,c.startCellSelection=b.cell,c.startCellRowIndex=b.rowIndex,c.startCellColumnIndex=b.columnIndex,c.startCellSide=b.side,Fancy.$(document).one("mouseup",function(){delete c.isMouseDown,delete c.startCellSelection}),e.fire("select")}},selectCells:function(a,b,c){var e,f,g,h=this,i=h.widget,j=i.body,k=i.leftBody,l=i.rightBody,m=a.rowIndex,n=b.rowIndex+1,o=h.getSelectedCells(c||"center"),p={},q={},r={};for(m=a.rowIndex,n=b.rowIndex+1;m<n;m++)for(p[m]=p[m]||{},f=a.columnIndex,g=b.columnIndex+1;f<g;f++)p[m][f]=!0;for(var s in p)if(void 0===o[s])q[s]=p[s];else for(var t in p[s])!0!==o[s][t]&&(q[s]=q[s]||{},q[s][t]=!0);for(var s in o)if(void 0===p[s])r[s]=o[s];else for(var t in o[s])!0!==p[s][t]&&(r[s]=r[s]||{},r[s][t]=!0);switch(c){case"left":e=k;break;case"center":e=j;break;case"right":e=l;break;default:e=j}for(var s in q)for(var t in q[s]){var u=e.getCell(s,t);u.addCls(d)}for(var s in r)for(var t in r[s]){var u=e.getCell(s,t);u.removeCls(d)}},getSelectedCells:function(a){for(var b=this,c=b.widget,e=c.getBody(a||"center"),f=e.el.select("."+d),g={},h=0,i=f.length;h<i;h++){var j=f.item(h),k=Number(j.parent().attr("index")),l=Number(j.attr("index"));g[l]=g[l]||{},g[l][k]=!0}return g},getNumberSelectedCells:function(){return this.widget.el.select("."+d).length},getSelectedColumns:function(a){for(var b=this,c=b.widget,d=c.getBody(a),e={},f=d.el.select("."+h),g=0,i=f.length;g<i;g++)e[f.item(g).attr("index")]=!0;return e},selectColumns:function(a,b,c){var d=this,e=d.getSelectedColumns(c||"center"),f={},g={},h={},i=a,j=b;for(j<i&&(i=b,j=a),j++;i<j;i++)f[i]=!0;for(var k in f)!0!==e[k]&&(g[k]=!0);for(var k in e)!0!==f[k]&&(h[k]=!0);for(var k in g)d.selectColumn(k,c);for(var k in h)d.deselectColumn(k,c)},selectColumn:function(a,b){var c=this,d=c.widget,e=d.getBody(b||"center");Fancy.get(e.getDomColumn(a)).addCls(h)},deselectColumn:function(a,b){var c=this,d=c.widget,e=d.getBody(b||"center");Fancy.get(e.getDomColumn(a)).removeCls(h)},getSelection:function(a){var b=this,c=b.widget,d=c.store,e={};switch(b.selModel){case"row":e.row=b.getSelectedRow(),-1!==e.row?(e.items=[d.get(e.row)],e.rows=[e.row]):(e.items=[],e.rows=[]);break;case"rows":if(e.rows=b.getSelectedRows(),b.memory&&b.memory.all)e.items=d.data;else{e.items=[];for(var f=0,g=e.rows.length;f<g;f++)e.items.push(d.get(e.rows[f]))}}return a?e:e.items},renderHeaderCheckBox:function(){var a=this,b=a.widget;a._renderHeaderCheckBox(b.leftHeader,b.leftColumns),a._renderHeaderCheckBox(b.header,b.columns),a._renderHeaderCheckBox(b.rightHeader,b.rightColumns)},_renderHeaderCheckBox:function(a,b){var c=this,d=c.memory;Fancy.each(b,function(b,e){if("$selected"===b.index){var f=a.getCell(e).firstChild();b.headerCheckBox=new Fancy.CheckBox({renderTo:f.dom,renderId:!0,value:!1,label:!1,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){b?(c.selectAll(),d&&d.setAll()):(c.deSelectAll(),d&&d.clearAll())}}]})}})},selectAll:function(){for(var c=this,d=c.widget,e=d.cellHeaderSelectCls,f=d.el.select("."+e+" ."+a),h=0,i=d.getViewTotal();h<i;h++){for(var j=d.el.select("."+g+" ."+b+'[index="'+h+'"] .'+a),k=0,l=j.length;k<l;k++){Fancy.getWidget(j.item(k).attr("id")).setValue(!0)}c.domSelectRow(h)}f.each(function(a){Fancy.getWidget(a.attr("id")).setValue(!0,!1)})},deSelectAll:function(){for(var c=this,d=c.widget,e=0,f=d.getViewTotal();e<f;e++){d.el.select("."+g+" ."+b+'[index="'+e+'"] .'+a).each(function(a){Fancy.getWidget(a.attr("id")).setValue(!1)}),c.domDeSelectRow(e)}c.clearHeaderCheckBox()},clearHeaderCheckBox:function(){var b=this,c=b.widget;c.el.select("."+c.cellHeaderSelectCls+" ."+a).each(function(a){Fancy.getWidget(a.attr("id")).setValue(!1,!1)})},stopSelection:function(){this.enabled=!1},enableSelection:function(a){if(void 0!==a)return void(this.enabled=a);this.enabled=!0}})}();